<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LifeLog - ã‚¹ãƒãƒ¼ãƒˆãƒ©ã‚¤ãƒ•ãƒ­ã‚°</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --primary: #000000;
            --text-primary: #000000;
            --text-secondary: #666666;
            --bg-primary: #ffffff;
            --bg-secondary: #fafafa;
            --border-light: #e8e8e8;
            --border-dark: #cccccc;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg-secondary);
            min-height: 100vh;
            padding: 20px;
            color: var(--text-primary);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: var(--bg-primary);
            padding: 50px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            border: 1px solid var(--border-light);
        }
        
        h1 {
            color: var(--text-primary);
            margin-bottom: 40px;
            text-align: center;
            font-size: 1.8em;
            font-weight: 300;
            letter-spacing: 1px;
        }
        
        h2, h3, h4 {
            font-weight: 500;
            color: var(--text-primary);
        }
        
        /* ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ */
        .tab-nav {
            display: flex;
            gap: 0;
            margin-bottom: 40px;
            border-bottom: 1px solid var(--border-light);
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none; /* Firefox */
        }
        
        .tab-nav::-webkit-scrollbar {
            display: none; /* Chrome, Safari */
        }
        
        .tab-button {
            flex-shrink: 0;
            padding: 15px 24px;
            background: none;
            border: none;
            border-bottom: 2px solid transparent;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 0.95em;
            transition: all 0.2s;
            white-space: nowrap;
        }
        
        .tab-button:hover {
            color: var(--text-primary);
            background: var(--bg-secondary);
        }
        
        .tab-button.active {
            color: var(--text-primary);
            border-bottom: 2px solid var(--primary);
            font-weight: 500;
        }
        
        /* ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* å…¥åŠ›ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
        .input-section {
            background: var(--bg-secondary);
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid var(--border-light);
        }
        
        /* éŸ³å£°ãƒœã‚¿ãƒ³ */
        .voice-button {
            width: 100%;
            padding: 20px;
            font-size: 1.1em;
            background: var(--bg-primary);
            color: var(--text-primary);
            border: 2px solid var(--primary);
            cursor: pointer;
            margin-bottom: 20px;
            transition: all 0.3s;
            font-weight: 500;
        }
        
        .voice-button:hover {
            background: var(--primary);
            color: var(--bg-primary);
        }
        
        .voice-button.listening {
            background: var(--primary);
            color: var(--bg-primary);
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        /* ã‚¯ã‚¤ãƒƒã‚¯ãƒœã‚¿ãƒ³ */
        .quick-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .quick-button {
            padding: 12px;
            background: var(--bg-primary);
            border: 1px solid var(--border-dark);
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.2s;
        }
        
        .quick-button:hover {
            background: var(--bg-secondary);
            border-color: var(--primary);
        }
        
        /* å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ */
        .text-input, .number-input, textarea, .category-select {
            width: 100%;
            padding: 12px;
            font-size: 1em;
            border: 1px solid var(--border-dark);
            background: var(--bg-primary);
            margin-bottom: 15px;
            transition: border 0.2s;
        }
        
        .text-input:focus, .number-input:focus, textarea:focus, .category-select:focus {
            outline: none;
            border: 2px solid var(--primary);
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        /* è¿½åŠ ãƒœã‚¿ãƒ³ */
        .add-button {
            width: 100%;
            padding: 15px;
            background: var(--primary);
            color: var(--bg-primary);
            border: none;
            cursor: pointer;
            font-size: 1em;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .add-button:hover {
            background: var(--text-secondary);
        }
        
        /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ */
        .status {
            margin-top: 10px;
            padding: 10px;
            text-align: center;
            font-size: 0.9em;
            color: var(--text-secondary);
        }
        
        /* ãƒ­ã‚°ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
        .logs-section {
            padding: 20px 0;
        }
        
        .section-title {
            font-size: 1.2em;
            font-weight: 500;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-light);
        }
        
        /* ãƒ­ã‚°ã‚¢ã‚¤ãƒ†ãƒ  */
        .log-item, .journal-item {
            background: var(--bg-primary);
            border: 1px solid var(--border-light);
            padding: 20px;
            margin-bottom: 10px;
            transition: all 0.2s;
        }
        
        .log-item:hover, .journal-item:hover {
            border-color: var(--border-dark);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .log-item.ongoing {
            background: #f9f9f9;
            border-left: 4px solid var(--primary);
        }
        
        /* æ„Ÿæƒ…ãƒœã‚¿ãƒ³ */
        .mood-buttons {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            justify-content: center;
        }
        
        .mood-button {
            padding: 15px 25px;
            font-size: 2em;
            background: var(--bg-primary);
            border: 2px solid var(--border-light);
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .mood-button:hover {
            border-color: var(--border-dark);
        }
        
        .mood-button.active {
            border-color: var(--primary);
            background: var(--bg-secondary);
        }
        
        /* ã‚«ãƒ†ã‚´ãƒªã‚¿ã‚° */
        .category-tag {
            display: inline-block;
            padding: 4px 12px;
            font-size: 0.85em;
            background: var(--bg-secondary);
            border: 1px solid var(--border-light);
            color: var(--text-secondary);
            margin-right: 8px;
        }
        
        /* ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ */
        .log-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .edit-button, .delete-button, .end-button {
            padding: 8px 15px;
            font-size: 0.85em;
            border: 1px solid var(--border-dark);
            background: var(--bg-primary);
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .edit-button:hover {
            background: var(--primary);
            color: var(--bg-primary);
            border-color: var(--primary);
        }
        
        .delete-button:hover {
            background: #dc3545;
            color: var(--bg-primary);
            border-color: #dc3545;
        }
        
        .end-button {
            background: var(--primary);
            color: var(--bg-primary);
            border-color: var(--primary);
        }
        
        .end-button:hover {
            background: var(--text-secondary);
        }
        
        /* ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ */
        .calendar-container {
            margin-top: 30px;
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-light);
        }
        
        .calendar-nav-button {
            padding: 8px 15px;
            background: var(--bg-primary);
            border: 1px solid var(--border-dark);
            cursor: pointer;
            font-size: 1em;
            transition: all 0.2s;
        }
        
        .calendar-nav-button:hover {
            background: var(--primary);
            color: var(--bg-primary);
        }
        
        .calendar-title {
            font-size: 1.2em;
            font-weight: 500;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
            background: var(--border-light);
            border: 1px solid var(--border-light);
        }
        
        .calendar-day-header {
            background: var(--bg-secondary);
            padding: 10px;
            text-align: center;
            font-size: 0.85em;
            color: var(--text-secondary);
            font-weight: 500;
        }
        
        .calendar-day {
            background: var(--bg-primary);
            padding: 15px 5px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            min-height: 60px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .calendar-day:hover {
            background: var(--bg-secondary);
        }
        
        .calendar-day.other-month {
            color: var(--text-secondary);
            opacity: 0.4;
        }
        
        .calendar-day.today {
            background: var(--primary);
            color: var(--bg-primary);
            font-weight: bold;
        }
        
        .calendar-day.has-journal {
            background: #f5f5f5;
            border: 1px solid var(--border-dark);
        }
        
        .calendar-day .mood-emoji {
            font-size: 1.5em;
            margin-top: 5px;
        }
        
        /* ãƒ¢ãƒ¼ãƒ€ãƒ« */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            align-items: center;
            justify-content: center;
        }
        
        .modal.show {
            display: flex;
        }
        
        .modal-content {
            background: var(--bg-primary);
            padding: 40px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            border: 1px solid var(--border-light);
        }
        
        .modal-header {
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-light);
        }
        
        .modal-header h2 {
            font-size: 1.5em;
            font-weight: 500;
        }
        
        .modal-actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            justify-content: flex-end;
        }
        
        .modal-button {
            padding: 12px 30px;
            border: 1px solid var(--border-dark);
            background: var(--bg-primary);
            cursor: pointer;
            font-size: 1em;
            transition: all 0.2s;
        }
        
        .modal-button.primary {
            background: var(--primary);
            color: var(--bg-primary);
            border-color: var(--primary);
        }
        
        .modal-button:hover {
            background: var(--primary);
            color: var(--bg-primary);
        }
        
        .modal-button.primary:hover {
            background: var(--text-secondary);
            border-color: var(--text-secondary);
        }
        
        /* ãƒ†ãƒ¼ãƒ–ãƒ« */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        thead {
            background: var(--bg-secondary);
            border-top: 2px solid var(--primary);
            border-bottom: 2px solid var(--primary);
        }
        
        th {
            padding: 12px;
            text-align: left;
            font-weight: 500;
            font-size: 0.9em;
            color: var(--text-primary);
        }
        
        td {
            padding: 12px;
            border-bottom: 1px solid var(--border-light);
        }
        
        tbody tr:hover {
            background: var(--bg-secondary);
        }
        
        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– */
        @media (max-width: 768px) {
            body {
                padding: 0;
            }
            
            .container {
                padding: 20px 15px;
                border: none;
                box-shadow: none;
                border-radius: 0;
            }
            
            h1 {
                font-size: 1.4em;
                margin-bottom: 20px;
            }
            
            .tab-nav {
                margin-left: -15px;
                margin-right: -15px;
                padding: 0 15px;
                margin-bottom: 20px;
                position: sticky;
                top: 0;
                background: var(--bg-primary);
                z-index: 100;
                border-bottom: 2px solid var(--border-light);
            }
            
            .tab-button {
                padding: 12px 16px;
                font-size: 0.85em;
            }
            
            .input-section {
                padding: 20px 15px;
                margin-left: -15px;
                margin-right: -15px;
                border-left: none;
                border-right: none;
            }
            
            .quick-buttons {
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
            }
            
            .quick-button {
                padding: 10px;
                font-size: 0.85em;
            }
            
            .voice-button {
                padding: 16px;
                font-size: 1em;
            }
            
            .add-button {
                padding: 14px;
            }
            
            .calendar-day {
                min-height: 50px;
                font-size: 0.85em;
                padding: 10px 2px;
            }
            
            .calendar-day .mood-emoji {
                font-size: 1.2em !important;
            }
            
            .modal-content {
                width: 95%;
                padding: 25px 20px;
            }
            
            .log-item, .journal-item {
                padding: 15px;
                margin-left: -15px;
                margin-right: -15px;
                border-left: none;
                border-right: none;
                border-radius: 0;
            }
            
            .section-title {
                font-size: 1.1em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>LifeLog</h1>
        
        <div class="tab-nav">
            <button class="tab-button active" onclick="switchTab('activity')">â±ï¸ è¡Œå‹•</button>
            <button class="tab-button" onclick="switchTab('money')">ğŸ’° ãŠé‡‘</button>
            <button class="tab-button" onclick="switchTab('weight')">âš–ï¸ ä½“é‡</button>
            <button class="tab-button" onclick="switchTab('journal')">ğŸ“” ã‚¸ãƒ£ãƒ¼ãƒŠãƒ«</button>
            <button class="tab-button" onclick="switchTab('report')">ğŸ“Š ãƒ¬ãƒãƒ¼ãƒˆ</button>
        </div>

        <!-- è¡Œå‹•ã‚¿ãƒ– -->
        <div id="activityTab" class="tab-content active">
            <div class="input-section">
                <button id="activityVoiceButton" class="voice-button">ğŸ¤ éŸ³å£°å…¥åŠ›ã§è¨˜éŒ²</button>
                <div class="quick-buttons">
                    <button class="quick-button" onclick="quickAddActivity('ä»•äº‹', 'work')">ğŸ’¼ ä»•äº‹</button>
                    <button class="quick-button" onclick="quickAddActivity('å‹‰å¼·', 'study')">ğŸ“š å‹‰å¼·</button>
                    <button class="quick-button" onclick="quickAddActivity('é‹å‹•', 'exercise')">ğŸƒ é‹å‹•</button>
                    <button class="quick-button" onclick="quickAddActivity('é£Ÿäº‹', 'meal')">ğŸ½ï¸ é£Ÿäº‹</button>
                </div>
                <input type="text" id="activityTextInput" class="text-input" placeholder="æ´»å‹•å†…å®¹...">
                <select id="activityCategorySelect" class="category-select">
                    <option value="work">ğŸ’¼ ä»•äº‹</option>
                    <option value="study">ğŸ“š å‹‰å¼·</option>
                    <option value="exercise">ğŸƒ é‹å‹•</option>
                    <option value="meal">ğŸ½ï¸ é£Ÿäº‹</option>
                    <option value="leisure">â˜• å¨¯æ¥½</option>
                    <option value="other">ğŸ“Œ ãã®ä»–</option>
                </select>
                <button id="activityAddButton" class="add-button">â• è¨˜éŒ²</button>
                <div id="activityStatus" class="status"></div>
            </div>
            <div class="logs-section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h2 class="section-title" style="margin-bottom: 0;">ä»Šæ—¥ã®è¡Œå‹•</h2>
                    <button onclick="openCategoryManager('activity')" style="padding: 8px 15px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 0.9em;">âš™ï¸ ã‚«ãƒ†ã‚´ãƒªç®¡ç†</button>
                </div>
                <div id="activityLogsList"></div>
            </div>
        </div>

        <!-- ãŠé‡‘ã‚¿ãƒ– -->
        <div id="moneyTab" class="tab-content">
            <div class="input-section">
                <button id="moneyVoiceButton" class="voice-button">ğŸ¤ éŸ³å£°å…¥åŠ›ã§è¨˜éŒ²</button>
                <div class="quick-buttons">
                    <button class="quick-button" onclick="quickAddMoney('åå…¥', 'income')">ğŸ’° åå…¥</button>
                    <button class="quick-button" onclick="quickAddMoney('æ”¯å‡º', 'expense')">ğŸ’¸ æ”¯å‡º</button>
                    <button class="quick-button" onclick="quickAddMoney('é£Ÿè²»', 'food')">ğŸ½ï¸ é£Ÿè²»</button>
                    <button class="quick-button" onclick="quickAddMoney('äº¤é€šè²»', 'transport')">ğŸšƒ äº¤é€šè²»</button>
                </div>
                <input type="text" id="moneyTextInput" class="text-input" placeholder="å†…å®¹...">
                <div class="input-row">
                    <input type="number" id="moneyAmountInput" class="number-input" placeholder="é‡‘é¡">
                    <select id="moneyTypeSelect" class="category-select">
                        <option value="income">ğŸ’° åå…¥</option>
                        <option value="expense" selected>ğŸ’¸ æ”¯å‡º</option>
                    </select>
                </div>
                <select id="moneyCategorySelect" class="category-select">
                    <option value="food">ğŸ½ï¸ é£Ÿè²»</option>
                    <option value="transport">ğŸšƒ äº¤é€šè²»</option>
                    <option value="shopping">ğŸ›ï¸ è²·ã„ç‰©</option>
                    <option value="entertainment">ğŸ® å¨¯æ¥½</option>
                    <option value="other">ğŸ“Œ ãã®ä»–</option>
                </select>
                <button id="moneyAddButton" class="add-button">â• è¨˜éŒ²</button>
                <div id="moneyStatus" class="status"></div>
            </div>
            <div class="logs-section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h2 class="section-title" style="margin-bottom: 0;">ä»Šæ—¥ã®ãŠé‡‘</h2>
                    <button onclick="openCategoryManager('money')" style="padding: 8px 15px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 0.9em;">âš™ï¸ ã‚«ãƒ†ã‚´ãƒªç®¡ç†</button>
                </div>
                <div id="moneyLogsList"></div>
            </div>
        </div>

        <!-- ä½“é‡ã‚¿ãƒ– -->
        <div id="weightTab" class="tab-content">
            <div class="input-section">
                <button id="weightVoiceButton" class="voice-button">ğŸ¤ éŸ³å£°å…¥åŠ›ã§è¨˜éŒ²</button>
                <input type="number" id="weightInput" class="number-input" placeholder="ä½“é‡ï¼ˆkgï¼‰" step="0.1">
                <button id="weightAddButton" class="add-button">â• è¨˜éŒ²</button>
                <div id="weightStatus" class="status"></div>
            </div>
            <div class="logs-section">
                <h2 class="section-title">ä½“é‡è¨˜éŒ²</h2>
                <div class="weight-history" id="weightHistory"></div>
            </div>
        </div>

        <!-- ã‚¸ãƒ£ãƒ¼ãƒŠãƒ«ã‚¿ãƒ–ï¼ˆæ–°è¦ï¼‰ -->
        <div id="journalTab" class="tab-content">
            <div class="input-section">
                <button id="journalVoiceButton" class="voice-button">ğŸ¤ éŸ³å£°å…¥åŠ›ã§ä»Šæ—¥ã®æŒ¯ã‚Šè¿”ã‚Š</button>
                
                <div class="mood-selector">
                    <button class="mood-button" data-mood="good" onclick="selectMood('good')">ğŸ˜Š</button>
                    <button class="mood-button active" data-mood="normal" onclick="selectMood('normal')">ğŸ˜</button>
                    <button class="mood-button" data-mood="bad" onclick="selectMood('bad')">ğŸ˜¢</button>
                </div>
                
                <textarea id="journalTextInput" class="textarea-input" placeholder="ä»Šæ—¥ã¯ã©ã‚“ãª1æ—¥ã§ã—ãŸã‹ï¼Ÿ&#10;&#10;ä¾‹ï¼š&#10;- æœã‹ã‚‰ã‚¸ãƒ ã«è¡Œã£ã¦æ°—æŒã¡ã‚ˆãæ±—ã‚’æµã—ãŸ&#10;- åˆå¾Œã¯é›†ä¸­ã—ã¦ä»•äº‹ãŒã§ããŸ&#10;- å¤œã¯å‹é”ã¨æ¥½ã—ãé£Ÿäº‹&#10;- æ˜æ—¥ã¯æ—©èµ·ãã—ã¦æ–°ã—ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«å–ã‚Šçµ„ã‚‚ã†"></textarea>
                
                <button id="journalAddButton" class="add-button">ğŸ“ ã‚¸ãƒ£ãƒ¼ãƒŠãƒ«ã‚’ä¿å­˜</button>
                <div id="journalStatus" class="status"></div>
            </div>
            
            <div class="logs-section">
                <!-- æœˆé–“ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ -->
                <div style="margin-bottom: 30px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h2 class="section-title" style="margin-bottom: 0;">ğŸ“… æœˆé–“ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</h2>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <button onclick="changeCalendarMonth(-1)" style="padding: 8px 15px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer;">â—€</button>
                            <span id="calendarMonthYear" style="font-weight: bold; color: #667eea; min-width: 120px; text-align: center;"></span>
                            <button onclick="changeCalendarMonth(1)" style="padding: 8px 15px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer;">â–¶</button>
                        </div>
                    </div>
                    <div id="journalCalendar"></div>
                </div>
                
                <h2 class="section-title">éå»ã®ã‚¸ãƒ£ãƒ¼ãƒŠãƒ«</h2>
                <div id="journalList"></div>
            </div>
        </div>

        <!-- ãƒ¬ãƒãƒ¼ãƒˆã‚¿ãƒ– -->
        <div id="reportTab" class="tab-content">
            <div class="period-selector">
                <button class="period-button" onclick="setPeriod('today')">ä»Šæ—¥</button>
                <button class="period-button active" onclick="setPeriod('week')">é€±é–“</button>
                <button class="period-button" onclick="setPeriod('month')">æœˆé–“</button>
            </div>

            <div id="reportContent">
                <div class="report-summary">
                    <h3>â±ï¸ è¡Œå‹•ã‚µãƒãƒªãƒ¼</h3>
                    <div class="summary-grid" id="activitySummary"></div>
                    <div class="chart-container" style="height: 250px; margin-top: 20px;">
                        <canvas id="reportActivityChart"></canvas>
                    </div>
                </div>

                <div class="report-summary">
                    <h3>ğŸ’° ãŠé‡‘ã‚µãƒãƒªãƒ¼</h3>
                    <div class="summary-grid" id="moneySummary"></div>
                    <div class="chart-container" style="height: 250px; margin-top: 20px;">
                        <canvas id="reportMoneyChart"></canvas>
                    </div>
                </div>

                <div class="report-summary">
                    <h3>âš–ï¸ ä½“é‡ã‚µãƒãƒªãƒ¼</h3>
                    <div class="summary-grid" id="weightSummary"></div>
                    <div class="chart-container" style="height: 250px; margin-top: 20px;">
                        <canvas id="reportWeightChart"></canvas>
                    </div>
                </div>

                <div class="report-summary">
                    <h3>ğŸ“” ã‚¸ãƒ£ãƒ¼ãƒŠãƒ«ã¾ã¨ã‚</h3>
                    <div class="journal-summary-list" id="journalSummaryList"></div>
                </div>

                <div class="ai-advice-section">
                    <button class="ai-advice-button" onclick="generateAdvice()">
                        ğŸ¤– AIã§ç·åˆçš„ãªæŒ¯ã‚Šè¿”ã‚Šåˆ†æã‚’å–å¾—
                    </button>
                    <div class="advice-content" id="adviceContent"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- ã‚«ãƒ†ã‚´ãƒªç®¡ç†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="categoryManagerModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header" id="categoryManagerTitle">âš™ï¸ ã‚«ãƒ†ã‚´ãƒªç®¡ç†</div>
            
            <div style="margin-bottom: 20px;">
                <h3 style="font-size: 1.1em; margin-bottom: 10px; color: #667eea;">æ–°ã—ã„ã‚«ãƒ†ã‚´ãƒªã‚’è¿½åŠ </h3>
                <div style="display: flex; gap: 10px;">
                    <input type="text" id="newCategoryKey" class="text-input" placeholder="IDï¼ˆä¾‹ï¼šhobbyï¼‰" style="flex: 1;">
                    <input type="text" id="newCategoryName" class="text-input" placeholder="åå‰ï¼ˆä¾‹ï¼šè¶£å‘³ï¼‰" style="flex: 1;">
                    <button onclick="addCustomCategory()" class="modal-button primary" style="white-space: nowrap;">â• è¿½åŠ </button>
                </div>
                <small style="color: #999; display: block; margin-top: 5px;">* IDã¯è‹±æ•°å­—ã®ã¿ã€åå‰ã¯æ—¥æœ¬èªå¯</small>
            </div>
            
            <div>
                <h3 style="font-size: 1.1em; margin-bottom: 10px; color: #667eea;">ç¾åœ¨ã®ã‚«ãƒ†ã‚´ãƒª</h3>
                <div id="categoryList" style="max-height: 300px; overflow-y: auto;"></div>
            </div>
            
            <div class="modal-buttons">
                <button class="modal-button secondary" onclick="closeCategoryManager()">é–‰ã˜ã‚‹</button>
            </div>
        </div>
    </div>

    <!-- ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆè¡Œå‹•ï¼‰ -->
    <div id="editActivityModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">âœï¸ è¡Œå‹•ã‚’ç·¨é›†</div>
            
            <label style="font-size: 0.9em; color: #666; margin-bottom: 5px; display: block;">å†…å®¹</label>
            <input type="text" id="editActivityText" class="text-input" placeholder="è¡Œå‹•å†…å®¹">
            
            <label style="font-size: 0.9em; color: #666; margin-bottom: 5px; display: block; margin-top: 15px;">ã‚«ãƒ†ã‚´ãƒª</label>
            <select id="editActivityCategory" class="select-input">
                <option value="work">ğŸ’¼ ä»•äº‹</option>
                <option value="study">ğŸ“š å‹‰å¼·</option>
                <option value="exercise">ğŸ‹ï¸ é‹å‹•</option>
                <option value="meal">ğŸ½ï¸ é£Ÿäº‹</option>
                <option value="leisure">ğŸ® å¨¯æ¥½</option>
                <option value="other">ğŸ“Œ ãã®ä»–</option>
            </select>
            
            <label style="font-size: 0.9em; color: #666; margin-bottom: 5px; display: block; margin-top: 15px;">é–‹å§‹æ™‚åˆ»</label>
            <input type="datetime-local" id="editActivityStartTime" class="time-input">
            
            <label style="font-size: 0.9em; color: #666; margin-bottom: 5px; display: block; margin-top: 15px;">çµ‚äº†æ™‚åˆ»</label>
            <input type="datetime-local" id="editActivityEndTime" class="time-input">
            <small style="color: #999; display: block; margin-top: 5px;">ç¶™ç¶šä¸­ã®å ´åˆã¯ç©ºæ¬„ã«ã—ã¦ãã ã•ã„</small>
            
            <div class="modal-buttons">
                <button class="modal-button secondary" onclick="closeEditActivityModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                <button class="modal-button primary" onclick="saveEditActivity()">ä¿å­˜</button>
            </div>
        </div>
    </div>

    <!-- ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆãŠé‡‘ï¼‰ -->
    <div id="editMoneyModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">âœï¸ ãŠé‡‘ã‚’ç·¨é›†</div>
            
            <label style="font-size: 0.9em; color: #666; margin-bottom: 5px; display: block;">å†…å®¹</label>
            <input type="text" id="editMoneyText" class="text-input" placeholder="å†…å®¹">
            
            <label style="font-size: 0.9em; color: #666; margin-bottom: 5px; display: block; margin-top: 15px;">é‡‘é¡</label>
            <input type="number" id="editMoneyAmount" class="text-input" placeholder="é‡‘é¡">
            
            <label style="font-size: 0.9em; color: #666; margin-bottom: 5px; display: block; margin-top: 15px;">ç¨®é¡</label>
            <select id="editMoneyType" class="select-input">
                <option value="income">åå…¥</option>
                <option value="expense">æ”¯å‡º</option>
            </select>
            
            <label style="font-size: 0.9em; color: #666; margin-bottom: 5px; display: block; margin-top: 15px;">ã‚«ãƒ†ã‚´ãƒª</label>
            <select id="editMoneyCategory" class="select-input">
                <option value="food">ğŸ” é£Ÿè²»</option>
                <option value="transport">ğŸšŒ äº¤é€šè²»</option>
                <option value="shopping">ğŸ›ï¸ è²·ã„ç‰©</option>
                <option value="entertainment">ğŸ¥ å¨¯æ¥½</option>
                <option value="other">ğŸ’µ ãã®ä»–</option>
            </select>
            
            <label style="font-size: 0.9em; color: #666; margin-bottom: 5px; display: block; margin-top: 15px;">æ—¥æ™‚</label>
            <input type="datetime-local" id="editMoneyTime" class="time-input">
            
            <div class="modal-buttons">
                <button class="modal-button secondary" onclick="closeEditMoneyModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                <button class="modal-button primary" onclick="saveEditMoney()">ä¿å­˜</button>
            </div>
        </div>
    </div>

    <!-- ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆä½“é‡ï¼‰ -->
    <div id="editWeightModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">âœï¸ ä½“é‡ã‚’ç·¨é›†</div>
            
            <label style="font-size: 0.9em; color: #666; margin-bottom: 5px; display: block;">ä½“é‡ (kg)</label>
            <input type="number" step="0.1" id="editWeightValue" class="text-input" placeholder="ä½“é‡">
            
            <label style="font-size: 0.9em; color: #666; margin-bottom: 5px; display: block; margin-top: 15px;">æ—¥æ™‚</label>
            <input type="datetime-local" id="editWeightTime" class="time-input">
            
            <div class="modal-buttons">
                <button class="modal-button secondary" onclick="closeEditWeightModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                <button class="modal-button primary" onclick="saveEditWeight()">ä¿å­˜</button>
            </div>
        </div>
    </div>

    <!-- ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆã‚¸ãƒ£ãƒ¼ãƒŠãƒ«ï¼‰ -->
    <div id="editJournalModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">âœï¸ ã‚¸ãƒ£ãƒ¼ãƒŠãƒ«ã‚’ç·¨é›†</div>
            
            <div class="mood-selector">
                <button class="mood-button" data-mood="good" onclick="selectEditMood('good')">ğŸ˜Š</button>
                <button class="mood-button" data-mood="normal" onclick="selectEditMood('normal')">ğŸ˜</button>
                <button class="mood-button" data-mood="bad" onclick="selectEditMood('bad')">ğŸ˜¢</button>
            </div>
            
            <textarea id="editJournalText" class="textarea-input" placeholder="ã‚¸ãƒ£ãƒ¼ãƒŠãƒ«å†…å®¹"></textarea>
            
            <label style="font-size: 0.9em; color: #666; margin-bottom: 5px; display: block;">æ—¥æ™‚</label>
            <input type="datetime-local" id="editJournalTime" class="time-input">
            
            <div class="modal-buttons">
                <button class="modal-button secondary" onclick="closeEditJournalModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                <button class="modal-button primary" onclick="saveEditJournal()">ä¿å­˜</button>
            </div>
        </div>
    </div>

    <script>
        // ãƒ‡ãƒ¼ã‚¿
        let activities = JSON.parse(localStorage.getItem('activities')) || [];
        let moneyRecords = JSON.parse(localStorage.getItem('moneyRecords')) || [];
        let weightRecords = JSON.parse(localStorage.getItem('weightRecords')) || [];
        let journals = JSON.parse(localStorage.getItem('journals')) || [];
        let currentTab = 'activity';
        let currentPeriod = 'week';
        let editingId = null;
        let selectedMood = 'normal';
        let editSelectedMood = 'normal';

        // ã‚«ã‚¹ã‚¿ãƒ ã‚«ãƒ†ã‚´ãƒªï¼ˆlocalStorageã‹ã‚‰èª­ã¿è¾¼ã¿ï¼‰
        let customActivityCategories = JSON.parse(localStorage.getItem('customActivityCategories')) || {};
        let customMoneyCategories = JSON.parse(localStorage.getItem('customMoneyCategories')) || {};

        const defaultActivityCategories = {
            work: 'ä»•äº‹', study: 'å‹‰å¼·', exercise: 'é‹å‹•',
            meal: 'é£Ÿäº‹', leisure: 'å¨¯æ¥½', other: 'ãã®ä»–'
        };

        const defaultMoneyCategories = {
            food: 'é£Ÿè²»', transport: 'äº¤é€šè²»', shopping: 'è²·ã„ç‰©',
            entertainment: 'å¨¯æ¥½', other: 'ãã®ä»–'
        };

        // ã‚«ãƒ†ã‚´ãƒªã‚’ãƒãƒ¼ã‚¸ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ + ã‚«ã‚¹ã‚¿ãƒ ï¼‰
        const activityCategoryNames = { ...defaultActivityCategories, ...customActivityCategories };
        const moneyCategoryNames = { ...defaultMoneyCategories, ...customMoneyCategories };

        const activityKeywords = {
            work: ['ä»•äº‹', 'ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°', 'ä¼šè­°', 'ãƒ¡ãƒ¼ãƒ«'],
            study: ['å‹‰å¼·', 'å­¦ç¿’', 'èª­æ›¸'],
            exercise: ['é‹å‹•', 'ã‚¸ãƒ§ã‚®ãƒ³ã‚°', 'ã‚¸ãƒ '],
            meal: ['é£Ÿäº‹', 'ãƒ©ãƒ³ãƒ', 'æœé£Ÿ', 'å¤•é£Ÿ']
        };

        const moneyKeywords = {
            food: ['é£Ÿäº‹', 'ãƒ©ãƒ³ãƒ', 'ã‚«ãƒ•ã‚§', 'ã‚³ãƒ³ãƒ“ãƒ‹'],
            transport: ['é›»è»Š', 'ãƒã‚¹', 'ã‚¿ã‚¯ã‚·ãƒ¼'],
            shopping: ['è²·ã„ç‰©', 'æœ', 'Amazon'],
            entertainment: ['æ˜ ç”»', 'ã‚²ãƒ¼ãƒ ', 'æœ¬']
        };

        const moodEmojis = {
            good: 'ğŸ˜Š',
            normal: 'ğŸ˜',
            bad: 'ğŸ˜¢'
        };

        // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼é–¢é€£
        let currentCalendarYear = new Date().getFullYear();
        let currentCalendarMonth = new Date().getMonth(); // 0-11

        // ã‚¿ãƒ–åˆ‡æ›¿
        function switchTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            const tabIndex = { activity: 0, money: 1, weight: 2, journal: 3, report: 4 };
            document.querySelectorAll('.tab-button')[tabIndex[tab]].classList.add('active');
            document.getElementById(tab + 'Tab').classList.add('active');
            
            if (tab === 'activity') renderActivityLogs();
            else if (tab === 'money') renderMoneyLogs();
            else if (tab === 'weight') renderWeightHistory();
            else if (tab === 'journal') {
                renderJournalList();
                renderJournalCalendar();
            }
            else if (tab === 'report') renderReport();
        }

        // æœŸé–“è¨­å®š
        function setPeriod(period) {
            currentPeriod = period;
            document.querySelectorAll('.period-button').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            renderReport();
        }

        function getDateRange() {
            const now = new Date();
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            
            if (currentPeriod === 'today') {
                return { start: today, end: now };
            } else if (currentPeriod === 'week') {
                const weekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
                return { start: weekAgo, end: now };
            } else {
                const monthAgo = new Date(today.getTime() - 30 * 24 * 60 * 60 * 1000);
                return { start: monthAgo, end: now };
            }
        }

        function filterByDateRange(records) {
            const { start, end } = getDateRange();
            return records.filter(r => {
                const date = new Date(r.timestamp);
                return date >= start && date <= end;
            });
        }

        // éŸ³å£°èªè­˜ï¼ˆå„ãƒœã‚¿ãƒ³ã”ã¨ã«ç‹¬ç«‹ã—ãŸã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆï¼‰
        const recognitionInstances = {};
        
        function setupVoiceRecognition(buttonId, onResult) {
            const button = document.getElementById(buttonId);
            
            if (!('webkitSpeechRecognition' in window)) {
                button.textContent = 'âš ï¸ éå¯¾å¿œ';
                button.disabled = true;
                return;
            }
            
            // å„ãƒœã‚¿ãƒ³ã”ã¨ã«ç‹¬ç«‹ã—ãŸèªè­˜ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆ
            const recognition = new webkitSpeechRecognition();
            recognition.lang = 'ja-JP';
            recognition.continuous = false;
            recognition.interimResults = false;
            
            // ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä¿å­˜
            recognitionInstances[buttonId] = {
                recognition: recognition,
                isListening: false
            };
            
            button.addEventListener('click', () => {
                const instance = recognitionInstances[buttonId];
                
                // ãƒˆã‚°ãƒ«æ©Ÿèƒ½: éŒ²éŸ³ä¸­ãªã‚‰åœæ­¢ã€åœæ­¢ä¸­ãªã‚‰é–‹å§‹
                if (instance.isListening) {
                    recognition.stop();
                    button.classList.remove('listening');
                    instance.isListening = false;
                } else {
                    try {
                        recognition.start();
                        button.classList.add('listening');
                        instance.isListening = true;
                    } catch (e) {
                        console.error('Recognition start error:', e);
                        button.classList.remove('listening');
                        instance.isListening = false;
                    }
                }
            });
            
            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                onResult(transcript);
                button.classList.remove('listening');
                recognitionInstances[buttonId].isListening = false;
            };
            
            recognition.onerror = (event) => {
                console.error('Recognition error:', event.error);
                button.classList.remove('listening');
                recognitionInstances[buttonId].isListening = false;
            };
            
            recognition.onend = () => {
                button.classList.remove('listening');
                recognitionInstances[buttonId].isListening = false;
            };
        }

        function detectCategory(text, keywords) {
            text = text.toLowerCase();
            for (const [category, words] of Object.entries(keywords)) {
                if (words.some(word => text.includes(word))) return category;
            }
            return 'other';
        }

        function extractNumber(text) {
            const match = text.match(/[\d\.]+/);
            return match ? parseFloat(match[0]) : null;
        }

        // æ™‚é–“æŠ½å‡ºé–¢æ•°ï¼ˆéŸ³å£°å…¥åŠ›ã‹ã‚‰æ™‚é–“ã‚’èªè­˜ï¼‰
        function extractTimeFromText(text) {
            const result = { startTime: null, endTime: null };
            
            // ã€Œæœ7æ™‚ã€ã€Œåˆå‰7æ™‚ã€ã€Œ7æ™‚ã€ãªã©ã®ãƒ‘ã‚¿ãƒ¼ãƒ³
            const timePattern = /(æœ|åˆå‰|åˆå¾Œ)?(\d{1,2})æ™‚(åŠ|30åˆ†?)?/g;
            const matches = [...text.matchAll(timePattern)];
            
            if (matches.length === 0) return result;
            
            // æœ€åˆã®æ™‚é–“ã‚’é–‹å§‹æ™‚é–“ã¨ã—ã¦è¨­å®š
            const first = matches[0];
            let hour1 = parseInt(first[2]);
            const minute1 = first[3] ? 30 : 0;
            
            // åˆå¾Œã®å ´åˆã¯12æ™‚é–“è¿½åŠ ï¼ˆãŸã ã—12æ™‚ã¯é™¤ãï¼‰
            if (first[1] === 'åˆå¾Œ' && hour1 !== 12) hour1 += 12;
            if (first[1] === 'åˆå‰' && hour1 === 12) hour1 = 0;
            
            const today = new Date();
            const startDate = new Date(today.getFullYear(), today.getMonth(), today.getDate(), hour1, minute1);
            result.startTime = startDate.getTime();
            
            // 2ã¤ç›®ã®æ™‚é–“ãŒã‚ã‚Œã°çµ‚äº†æ™‚é–“ã¨ã—ã¦è¨­å®š
            if (matches.length >= 2) {
                const second = matches[1];
                let hour2 = parseInt(second[2]);
                const minute2 = second[3] ? 30 : 0;
                
                if (second[1] === 'åˆå¾Œ' && hour2 !== 12) hour2 += 12;
                if (second[1] === 'åˆå‰' && hour2 === 12) hour2 = 0;
                
                const endDate = new Date(today.getFullYear(), today.getMonth(), today.getDate(), hour2, minute2);
                result.endTime = endDate.getTime();
            }
            
            return result;
        }

        // è¡Œå‹•ãƒ­ã‚°
        function quickAddActivity(name, category) {
            document.getElementById('activityTextInput').value = name;
            document.getElementById('activityCategorySelect').value = category;
        }

        setupVoiceRecognition('activityVoiceButton', (transcript) => {
            document.getElementById('activityTextInput').value = transcript;
            const category = detectCategory(transcript, activityKeywords);
            document.getElementById('activityCategorySelect').value = category;
            
            // æ™‚é–“æƒ…å ±ã‚’æŠ½å‡º
            const timeInfo = extractTimeFromText(transcript);
            if (timeInfo.startTime) {
                // é–‹å§‹æ™‚é–“ãŒèªè­˜ã•ã‚ŒãŸå ´åˆã€æ¬¡ã®è¿½åŠ æ™‚ã«ãã®æ™‚é–“ã‚’ä½¿ç”¨
                window.pendingActivityTime = timeInfo;
            }
        });

        document.getElementById('activityAddButton').addEventListener('click', () => {
            const text = document.getElementById('activityTextInput').value.trim();
            const category = document.getElementById('activityCategorySelect').value;
            
            // éŸ³å£°å…¥åŠ›ã‹ã‚‰æ™‚é–“ãŒæŠ½å‡ºã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ãã‚Œã‚’ä½¿ç”¨
            let startTime = Date.now();
            let endTime = null;
            
            if (window.pendingActivityTime && window.pendingActivityTime.startTime) {
                startTime = window.pendingActivityTime.startTime;
                endTime = window.pendingActivityTime.endTime;
                window.pendingActivityTime = null; // ä½¿ç”¨å¾Œã¯ã‚¯ãƒªã‚¢
            } else {
                // é€šå¸¸ã®å‹•ä½œï¼šå‰ã®æ´»å‹•ã‚’çµ‚äº†
                if (activities.length > 0 && !activities[activities.length - 1].endTime) {
                    activities[activities.length - 1].endTime = Date.now();
                }
            }
            
            const newActivity = {
                id: Date.now(),
                text: text || activityCategoryNames[category],
                category: category,
                timestamp: new Date(startTime).toISOString(),
                startTime: startTime
            };
            
            if (endTime) {
                newActivity.endTime = endTime;
            }
            
            activities.push(newActivity);
            
            localStorage.setItem('activities', JSON.stringify(activities));
            document.getElementById('activityTextInput').value = '';
            document.getElementById('activityStatus').textContent = 'âœ“ è¨˜éŒ²ã—ã¾ã—ãŸ';
            setTimeout(() => document.getElementById('activityStatus').textContent = '', 2000);
            renderActivityLogs();
        });

        function renderActivityLogs() {
            const list = document.getElementById('activityLogsList');
            const today = new Date().toDateString();
            const logs = activities.filter(a => new Date(a.timestamp).toDateString() === today).reverse();
            
            if (logs.length === 0) {
                list.innerHTML = '<div class="empty-state">è¨˜éŒ²ãªã—</div>';
                return;
            }
            
            list.innerHTML = logs.map((a, i) => {
                const time = new Date(a.timestamp).toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' });
                let duration = '';
                let isContinuing = false;
                if (a.endTime) {
                    duration = ` (${Math.round((a.endTime - a.startTime) / 60000)}åˆ†)`;
                } else if (i === 0) {
                    duration = ` (${Math.round((Date.now() - a.startTime) / 60000)}åˆ† ç¶™ç¶šä¸­)`;
                    isContinuing = true;
                }
                
                // ç¶™ç¶šä¸­ã®å ´åˆã¯çµ‚äº†ãƒœã‚¿ãƒ³ã‚’è¿½åŠ 
                const endButton = isContinuing ? 
                    `<button class="edit-button" onclick="endActivity(${a.id})" style="background: #4CAF50;">â¹ï¸ çµ‚äº†</button>` : 
                    '';
                
                return `
                    <div class="log-item" style="${isContinuing ? 'background: #e8f5e9; border-left: 4px solid #4CAF50;' : ''}">
                        <div class="log-text">${a.text} ${isContinuing ? '<span style="color: #4CAF50; font-weight: bold;">ğŸŸ¢</span>' : ''}</div>
                        <div class="log-meta">
                            ${time}${duration}
                            <span class="log-category category-${a.category}">${activityCategoryNames[a.category]}</span>
                        </div>
                        <div class="log-actions">
                            ${endButton}
                            <button class="edit-button" onclick="editActivity(${a.id})">âœï¸ ç·¨é›†</button>
                            <button class="delete-button" onclick="deleteActivity(${a.id})">ğŸ—‘ï¸</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function deleteActivity(id) {
            if (confirm('å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                activities = activities.filter(a => a.id !== id);
                localStorage.setItem('activities', JSON.stringify(activities));
                renderActivityLogs();
            }
        }

        function endActivity(id) {
            const activity = activities.find(a => a.id === id);
            if (!activity) return;
            
            if (confirm('ã€Œ${activity.text}ã€ã‚’çµ‚äº†ã—ã¾ã™ã‹ï¼Ÿ')) {
                activity.endTime = Date.now();
                localStorage.setItem('activities', JSON.stringify(activities));
                renderActivityLogs();
            }
        }

        function editActivity(id) {
            const activity = activities.find(a => a.id === id);
            if (!activity) return;
            
            editingId = id;
            document.getElementById('editActivityText').value = activity.text;
            document.getElementById('editActivityCategory').value = activity.category;
            
            // ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã‚’è€ƒæ…®ã—ãŸæ—¥æ™‚å¤‰æ›
            const startDate = new Date(activity.startTime);
            const startTimeStr = formatDateTimeLocal(startDate);
            document.getElementById('editActivityStartTime').value = startTimeStr;
            
            if (activity.endTime) {
                const endDate = new Date(activity.endTime);
                const endTimeStr = formatDateTimeLocal(endDate);
                document.getElementById('editActivityEndTime').value = endTimeStr;
            } else {
                document.getElementById('editActivityEndTime').value = '';
            }
            
            document.getElementById('editActivityModal').classList.add('show');
        }

        // ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã‚’è€ƒæ…®ã—ãŸdatetime-localå½¢å¼ã¸å¤‰æ›
        function formatDateTimeLocal(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            return `${year}-${month}-${day}T${hours}:${minutes}`;
        }

        function closeEditActivityModal() {
            document.getElementById('editActivityModal').classList.remove('show');
            editingId = null;
        }

        function saveEditActivity() {
            const activity = activities.find(a => a.id === editingId);
            if (!activity) return;
            
            const text = document.getElementById('editActivityText').value.trim();
            const category = document.getElementById('editActivityCategory').value;
            const startTimeStr = document.getElementById('editActivityStartTime').value;
            const endTimeStr = document.getElementById('editActivityEndTime').value;
            
            if (!text || !startTimeStr) {
                alert('å†…å®¹ã¨é–‹å§‹æ™‚åˆ»ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            const startTime = new Date(startTimeStr).getTime();
            const endTime = endTimeStr ? new Date(endTimeStr).getTime() : null;
            
            if (endTime && endTime <= startTime) {
                alert('çµ‚äº†æ™‚åˆ»ã¯é–‹å§‹æ™‚åˆ»ã‚ˆã‚Šå¾Œã«ã—ã¦ãã ã•ã„');
                return;
            }
            
            activity.text = text;
            activity.category = category;
            activity.startTime = startTime;
            activity.timestamp = new Date(startTime).toISOString();
            activity.endTime = endTime;
            
            // æ™‚é–“é †ã«ã‚½ãƒ¼ãƒˆ
            activities.sort((a, b) => a.startTime - b.startTime);
            
            localStorage.setItem('activities', JSON.stringify(activities));
            closeEditActivityModal();
            renderActivityLogs();
        }

        // ãŠé‡‘
        function quickAddMoney(name, category) {
            document.getElementById('moneyTextInput').value = name;
            document.getElementById('moneyCategorySelect').value = category;
        }

        setupVoiceRecognition('moneyVoiceButton', (transcript) => {
            document.getElementById('moneyTextInput').value = transcript;
            const amount = extractNumber(transcript);
            if (amount) document.getElementById('moneyAmountInput').value = amount;
        });

        document.getElementById('moneyAddButton').addEventListener('click', () => {
            const text = document.getElementById('moneyTextInput').value.trim();
            const amount = parseFloat(document.getElementById('moneyAmountInput').value);
            const type = document.getElementById('moneyTypeSelect').value;
            const category = document.getElementById('moneyCategorySelect').value;
            
            if (!amount) {
                document.getElementById('moneyStatus').textContent = 'âŒ é‡‘é¡ã‚’å…¥åŠ›';
                return;
            }
            
            moneyRecords.push({
                id: Date.now(),
                text: text || category,
                amount: amount,
                type: type,
                category: category,
                timestamp: new Date().toISOString()
            });
            
            localStorage.setItem('moneyRecords', JSON.stringify(moneyRecords));
            document.getElementById('moneyTextInput').value = '';
            document.getElementById('moneyAmountInput').value = '';
            document.getElementById('moneyStatus').textContent = 'âœ“ è¨˜éŒ²ã—ã¾ã—ãŸ';
            setTimeout(() => document.getElementById('moneyStatus').textContent = '', 2000);
            renderMoneyLogs();
        });

        function renderMoneyLogs() {
            const list = document.getElementById('moneyLogsList');
            const today = new Date().toDateString();
            const logs = moneyRecords.filter(r => new Date(r.timestamp).toDateString() === today).reverse();
            
            if (logs.length === 0) {
                list.innerHTML = '<div class="empty-state">è¨˜éŒ²ãªã—</div>';
                return;
            }
            
            list.innerHTML = logs.map(r => {
                const time = new Date(r.timestamp).toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' });
                const sign = r.type === 'income' ? '+' : '-';
                const amountClass = r.type === 'income' ? 'amount-income' : 'amount-expense';
                return `
                    <div class="log-item">
                        <div class="log-text">
                            ${r.text}
                            <span class="log-amount ${amountClass}">${sign}${r.amount.toLocaleString()}å††</span>
                        </div>
                        <div class="log-meta">${time}</div>
                        <div class="log-actions">
                            <button class="edit-button" onclick="editMoney(${r.id})">âœï¸ ç·¨é›†</button>
                            <button class="delete-button" onclick="deleteMoney(${r.id})">ğŸ—‘ï¸</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function deleteMoney(id) {
            if (confirm('å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                moneyRecords = moneyRecords.filter(r => r.id !== id);
                localStorage.setItem('moneyRecords', JSON.stringify(moneyRecords));
                renderMoneyLogs();
            }
        }

        function editMoney(id) {
            const money = moneyRecords.find(m => m.id === id);
            if (!money) return;
            
            editingId = id;
            document.getElementById('editMoneyText').value = money.text;
            document.getElementById('editMoneyAmount').value = money.amount;
            document.getElementById('editMoneyType').value = money.type;
            document.getElementById('editMoneyCategory').value = money.category;
            
            // ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã‚’è€ƒæ…®ã—ãŸæ—¥æ™‚å¤‰æ›
            const date = new Date(money.timestamp);
            document.getElementById('editMoneyTime').value = formatDateTimeLocal(date);
            
            document.getElementById('editMoneyModal').classList.add('show');
        }

        function closeEditMoneyModal() {
            document.getElementById('editMoneyModal').classList.remove('show');
            editingId = null;
        }

        function saveEditMoney() {
            const money = moneyRecords.find(m => m.id === editingId);
            if (!money) return;
            
            const text = document.getElementById('editMoneyText').value.trim();
            const amount = parseFloat(document.getElementById('editMoneyAmount').value);
            const type = document.getElementById('editMoneyType').value;
            const category = document.getElementById('editMoneyCategory').value;
            const timeStr = document.getElementById('editMoneyTime').value;
            
            if (!amount || !timeStr) {
                alert('é‡‘é¡ã¨æ—¥æ™‚ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            money.text = text || category;
            money.amount = amount;
            money.type = type;
            money.category = category;
            money.timestamp = new Date(timeStr).toISOString();
            
            // æ™‚é–“é †ã«ã‚½ãƒ¼ãƒˆ
            moneyRecords.sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
            
            localStorage.setItem('moneyRecords', JSON.stringify(moneyRecords));
            closeEditMoneyModal();
            renderMoneyLogs();
        }

        // ä½“é‡
        setupVoiceRecognition('weightVoiceButton', (transcript) => {
            const weight = extractNumber(transcript);
            if (weight) document.getElementById('weightInput').value = weight;
        });

        document.getElementById('weightAddButton').addEventListener('click', () => {
            const weight = parseFloat(document.getElementById('weightInput').value);
            if (!weight) {
                document.getElementById('weightStatus').textContent = 'âŒ ä½“é‡ã‚’å…¥åŠ›';
                return;
            }
            
            weightRecords.push({
                id: Date.now(),
                weight: weight,
                timestamp: new Date().toISOString()
            });
            
            localStorage.setItem('weightRecords', JSON.stringify(weightRecords));
            document.getElementById('weightInput').value = '';
            document.getElementById('weightStatus').textContent = 'âœ“ è¨˜éŒ²ã—ã¾ã—ãŸ';
            setTimeout(() => document.getElementById('weightStatus').textContent = '', 2000);
            renderWeightHistory();
        });

        function renderWeightHistory() {
            const history = document.getElementById('weightHistory');
            const records = [...weightRecords].reverse().slice(0, 10);
            
            if (records.length === 0) {
                history.innerHTML = '<div class="empty-state">è¨˜éŒ²ãªã—</div>';
                return;
            }
            
            history.innerHTML = records.map((r, i) => {
                const date = new Date(r.timestamp).toLocaleDateString('ja-JP', { month: 'short', day: 'numeric' });
                let changeHtml = '';
                if (i < records.length - 1) {
                    const diff = r.weight - records[i + 1].weight;
                    if (diff !== 0) {
                        const cls = diff < 0 ? 'weight-down' : 'weight-up';
                        changeHtml = `<span class="weight-change ${cls}">${diff > 0 ? '+' : ''}${diff.toFixed(1)}kg</span>`;
                    }
                }
                return `
                    <div class="weight-item">
                        <span>${date}</span>
                        <div>
                            <span class="weight-value">${r.weight}kg</span>
                            ${changeHtml}
                        </div>
                        <div>
                            <button class="edit-button" onclick="editWeight(${r.id})" style="margin-right: 5px;">âœï¸</button>
                            <button class="delete-button" onclick="deleteWeight(${r.id})">ğŸ—‘ï¸</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function deleteWeight(id) {
            if (confirm('å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                weightRecords = weightRecords.filter(r => r.id !== id);
                localStorage.setItem('weightRecords', JSON.stringify(weightRecords));
                renderWeightHistory();
            }
        }

        function editWeight(id) {
            const weight = weightRecords.find(w => w.id === id);
            if (!weight) return;
            
            editingId = id;
            document.getElementById('editWeightValue').value = weight.weight;
            
            // ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã‚’è€ƒæ…®ã—ãŸæ—¥æ™‚å¤‰æ›
            const date = new Date(weight.timestamp);
            document.getElementById('editWeightTime').value = formatDateTimeLocal(date);
            
            document.getElementById('editWeightModal').classList.add('show');
        }

        function closeEditWeightModal() {
            document.getElementById('editWeightModal').classList.remove('show');
            editingId = null;
        }

        function saveEditWeight() {
            const weight = weightRecords.find(w => w.id === editingId);
            if (!weight) return;
            
            const weightValue = parseFloat(document.getElementById('editWeightValue').value);
            const timeStr = document.getElementById('editWeightTime').value;
            
            if (!weightValue || !timeStr) {
                alert('ä½“é‡ã¨æ—¥æ™‚ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            weight.weight = weightValue;
            weight.timestamp = new Date(timeStr).toISOString();
            
            // æ™‚é–“é †ã«ã‚½ãƒ¼ãƒˆ
            weightRecords.sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
            
            localStorage.setItem('weightRecords', JSON.stringify(weightRecords));
            closeEditWeightModal();
            renderWeightHistory();
        }

        // ã‚¸ãƒ£ãƒ¼ãƒŠãƒ«
        function selectMood(mood) {
            selectedMood = mood;
            document.querySelectorAll('#journalTab .mood-button').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.mood === mood) btn.classList.add('active');
            });
        }

        function selectEditMood(mood) {
            editSelectedMood = mood;
            document.querySelectorAll('#editJournalModal .mood-button').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.mood === mood) btn.classList.add('active');
            });
        }

        setupVoiceRecognition('journalVoiceButton', (transcript) => {
            const currentText = document.getElementById('journalTextInput').value;
            if (currentText) {
                document.getElementById('journalTextInput').value = currentText + '\n' + transcript;
            } else {
                document.getElementById('journalTextInput').value = transcript;
            }
        });

        document.getElementById('journalAddButton').addEventListener('click', () => {
            const text = document.getElementById('journalTextInput').value.trim();
            
            if (!text) {
                document.getElementById('journalStatus').textContent = 'âŒ å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„';
                return;
            }
            
            // åŒã˜æ—¥ã®ã‚¸ãƒ£ãƒ¼ãƒŠãƒ«ãŒã‚ã‚Œã°ä¸Šæ›¸ãç¢ºèª
            const today = new Date().toDateString();
            const existingIndex = journals.findIndex(j => new Date(j.timestamp).toDateString() === today);
            
            if (existingIndex >= 0) {
                if (!confirm('ä»Šæ—¥ã®ã‚¸ãƒ£ãƒ¼ãƒŠãƒ«ã¯æ—¢ã«å­˜åœ¨ã—ã¾ã™ã€‚ä¸Šæ›¸ãã—ã¾ã™ã‹ï¼Ÿ')) {
                    return;
                }
                journals[existingIndex] = {
                    ...journals[existingIndex],
                    text: text,
                    mood: selectedMood,
                    timestamp: new Date().toISOString()
                };
            } else {
                journals.push({
                    id: Date.now(),
                    text: text,
                    mood: selectedMood,
                    timestamp: new Date().toISOString()
                });
            }
            
            localStorage.setItem('journals', JSON.stringify(journals));
            document.getElementById('journalTextInput').value = '';
            selectedMood = 'normal';
            selectMood('normal');
            document.getElementById('journalStatus').textContent = 'âœ“ ã‚¸ãƒ£ãƒ¼ãƒŠãƒ«ã‚’ä¿å­˜ã—ã¾ã—ãŸ';
            setTimeout(() => document.getElementById('journalStatus').textContent = '', 2000);
            renderJournalList();
            renderJournalCalendar(); // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚‚æ›´æ–°
        });

        function renderJournalList() {
            const list = document.getElementById('journalList');
            const sorted = [...journals].sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            
            if (sorted.length === 0) {
                list.innerHTML = '<div class="empty-state">ã¾ã ã‚¸ãƒ£ãƒ¼ãƒŠãƒ«ãŒã‚ã‚Šã¾ã›ã‚“<br>éŸ³å£°å…¥åŠ›ã§ä»Šæ—¥ã®æŒ¯ã‚Šè¿”ã‚Šã‚’è¨˜éŒ²ã—ã¾ã—ã‚‡ã†ï¼</div>';
                return;
            }
            
            list.innerHTML = sorted.map(j => {
                const date = new Date(j.timestamp).toLocaleDateString('ja-JP', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    weekday: 'short'
                });
                
                return `
                    <div class="journal-item">
                        <div class="journal-header">
                            <div class="journal-date">${date}</div>
                            <div class="journal-mood">${moodEmojis[j.mood]}</div>
                        </div>
                        <div class="journal-content">${j.text}</div>
                        <div class="log-actions">
                            <button class="edit-button" onclick="editJournal(${j.id})">âœï¸ ç·¨é›†</button>
                            <button class="delete-button" onclick="deleteJournal(${j.id})">ğŸ—‘ï¸ å‰Šé™¤</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function editJournal(id) {
            const journal = journals.find(j => j.id === id);
            if (!journal) return;
            
            editingId = id;
            editSelectedMood = journal.mood;
            document.getElementById('editJournalText').value = journal.text;
            
            // ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã‚’è€ƒæ…®ã—ãŸæ—¥æ™‚å¤‰æ›
            const date = new Date(journal.timestamp);
            document.getElementById('editJournalTime').value = formatDateTimeLocal(date);
            
            selectEditMood(journal.mood);
            document.getElementById('editJournalModal').classList.add('show');
        }

        function closeEditJournalModal() {
            document.getElementById('editJournalModal').classList.remove('show');
            editingId = null;
        }

        function saveEditJournal() {
            const text = document.getElementById('editJournalText').value.trim();
            const timestamp = new Date(document.getElementById('editJournalTime').value).toISOString();
            
            if (!text) {
                alert('å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            const journal = journals.find(j => j.id === editingId);
            if (journal) {
                journal.text = text;
                journal.mood = editSelectedMood;
                journal.timestamp = timestamp;
                
                journals.sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
                localStorage.setItem('journals', JSON.stringify(journals));
                renderJournalList();
                renderJournalCalendar(); // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚‚æ›´æ–°
                closeEditJournalModal();
            }
        }

        function deleteJournal(id) {
            if (confirm('ã“ã®ã‚¸ãƒ£ãƒ¼ãƒŠãƒ«ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                journals = journals.filter(j => j.id !== id);
                localStorage.setItem('journals', JSON.stringify(journals));
                renderJournalList();
                renderJournalCalendar(); // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚‚æ›´æ–°
            }
        }

        // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¡¨ç¤º
        function renderJournalCalendar() {
            const year = currentCalendarYear;
            const month = currentCalendarMonth;
            
            // æœˆå¹´è¡¨ç¤ºã‚’æ›´æ–°
            const monthNames = ['1æœˆ', '2æœˆ', '3æœˆ', '4æœˆ', '5æœˆ', '6æœˆ', '7æœˆ', '8æœˆ', '9æœˆ', '10æœˆ', '11æœˆ', '12æœˆ'];
            document.getElementById('calendarMonthYear').textContent = `${year}å¹´ ${monthNames[month]}`;
            
            // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®æ—¥ä»˜ã‚’è¨ˆç®—
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const firstDayOfWeek = firstDay.getDay(); // 0=æ—¥æ›œ
            const daysInMonth = lastDay.getDate();
            
            // å‰æœˆã®æœ€å¾Œã®æ—¥ä»˜
            const prevMonthLastDay = new Date(year, month, 0).getDate();
            
            // ã‚¸ãƒ£ãƒ¼ãƒŠãƒ«ã‚’æ—¥ä»˜ã§ãƒãƒƒãƒ—åŒ–
            const journalsByDate = {};
            journals.forEach(j => {
                const date = new Date(j.timestamp);
                const dateKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
                journalsByDate[dateKey] = j;
            });
            
            // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼HTMLã‚’ç”Ÿæˆ
            let calendarHTML = '<div class="calendar-grid">';
            
            // æ›œæ—¥ãƒ˜ãƒƒãƒ€ãƒ¼
            const dayHeaders = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'];
            dayHeaders.forEach(day => {
                calendarHTML += `<div class="calendar-day-header">${day}</div>`;
            });
            
            // å‰æœˆã®æ—¥ä»˜ã‚’åŸ‹ã‚ã‚‹
            for (let i = firstDayOfWeek - 1; i >= 0; i--) {
                const day = prevMonthLastDay - i;
                calendarHTML += `<div class="calendar-day other-month"><div class="calendar-day-number">${day}</div></div>`;
            }
            
            // ä»Šæ—¥ã®æ—¥ä»˜
            const today = new Date();
            const todayStr = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
            
            // å½“æœˆã®æ—¥ä»˜
            for (let day = 1; day <= daysInMonth; day++) {
                const dateKey = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const journal = journalsByDate[dateKey];
                const isToday = dateKey === todayStr;
                
                let dayClass = 'calendar-day';
                if (isToday) dayClass += ' today';
                if (journal) dayClass += ' has-journal';
                
                let moodEmoji = '';
                if (journal) {
                    moodEmoji = `<div class="calendar-day-mood">${moodEmojis[journal.mood]}</div>`;
                }
                
                const onclick = journal ? `onclick="viewJournalFromCalendar(${journal.id})"` : '';
                
                calendarHTML += `
                    <div class="${dayClass}" ${onclick}>
                        <div class="calendar-day-number">${day}</div>
                        ${moodEmoji}
                    </div>
                `;
            }
            
            // æ¬¡æœˆã®æ—¥ä»˜ã‚’åŸ‹ã‚ã‚‹
            const totalCells = firstDayOfWeek + daysInMonth;
            const remainingCells = 7 - (totalCells % 7);
            if (remainingCells < 7) {
                for (let day = 1; day <= remainingCells; day++) {
                    calendarHTML += `<div class="calendar-day other-month"><div class="calendar-day-number">${day}</div></div>`;
                }
            }
            
            calendarHTML += '</div>';
            document.getElementById('journalCalendar').innerHTML = calendarHTML;
        }

        function changeCalendarMonth(delta) {
            currentCalendarMonth += delta;
            
            if (currentCalendarMonth < 0) {
                currentCalendarMonth = 11;
                currentCalendarYear--;
            } else if (currentCalendarMonth > 11) {
                currentCalendarMonth = 0;
                currentCalendarYear++;
            }
            
            renderJournalCalendar();
        }

        function viewJournalFromCalendar(id) {
            const journal = journals.find(j => j.id === id);
            if (!journal) return;
            
            // ã‚¸ãƒ£ãƒ¼ãƒŠãƒ«ãƒªã‚¹ãƒˆã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
            const journalListSection = document.getElementById('journalList');
            journalListSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
            
            // è©²å½“ã®ã‚¸ãƒ£ãƒ¼ãƒŠãƒ«ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆï¼ˆç°¡æ˜“çš„ãªè¡¨ç¤ºï¼‰
            setTimeout(() => {
                const allJournalItems = document.querySelectorAll('.journal-item');
                allJournalItems.forEach(item => {
                    if (item.innerHTML.includes(`editJournal(${id})`)) {
                        item.style.background = '#fffde7';
                        item.style.border = '2px solid #ffd54f';
                        setTimeout(() => {
                            item.style.background = '';
                            item.style.border = '';
                        }, 2000);
                    }
                });
            }, 500);
        }

        // ãƒ¢ãƒ¼ãƒ€ãƒ«å¤–ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
        document.getElementById('editJournalModal').addEventListener('click', (e) => {
            if (e.target.id === 'editJournalModal') closeEditJournalModal();
        });

        // ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
        function renderReport() {
            const periodActivities = filterByDateRange(activities);
            const periodMoney = filterByDateRange(moneyRecords);
            const periodWeight = filterByDateRange(weightRecords);
            const periodJournals = filterByDateRange(journals);
            
            renderActivitySummary(periodActivities);
            renderMoneySummary(periodMoney);
            renderWeightSummary(periodWeight);
            renderJournalSummary(periodJournals);
            
            document.getElementById('adviceContent').classList.remove('show');
        }

        function renderActivitySummary(data) {
            const categoryTime = {};
            const categoryCount = {};
            let totalMinutes = 0;
            
            data.forEach(a => {
                const endTime = a.endTime || Date.now();
                const minutes = Math.round((endTime - a.startTime) / 60000);
                if (!categoryTime[a.category]) {
                    categoryTime[a.category] = 0;
                    categoryCount[a.category] = 0;
                }
                categoryTime[a.category] += minutes;
                categoryCount[a.category]++;
                totalMinutes += minutes;
            });
            
            const hours = (totalMinutes / 60).toFixed(1);
            const days = currentPeriod === 'today' ? 1 : (currentPeriod === 'week' ? 7 : 30);
            const avgPerDay = (totalMinutes / days / 60).toFixed(1);
            
            // ã‚µãƒãƒªãƒ¼ã‚«ãƒ¼ãƒ‰
            document.getElementById('activitySummary').innerHTML = `
                <div class="summary-item">
                    <div class="summary-item-title">ç·è¨˜éŒ²æ•°</div>
                    <div class="summary-item-value">${data.length}ä»¶</div>
                </div>
                <div class="summary-item">
                    <div class="summary-item-title">åˆè¨ˆæ™‚é–“</div>
                    <div class="summary-item-value">${hours}h</div>
                </div>
                <div class="summary-item">
                    <div class="summary-item-title">1æ—¥å¹³å‡</div>
                    <div class="summary-item-value">${avgPerDay}h</div>
                </div>
            `;
            
            // ã‚«ãƒ†ã‚´ãƒªåˆ¥è©³ç´°è¡¨ã‚’è¿½åŠ 
            if (Object.keys(categoryTime).length > 0) {
                const detailTable = document.createElement('div');
                detailTable.style.cssText = 'margin-top: 20px; overflow-x: auto;';
                
                // æ™‚é–“é †ã«ã‚½ãƒ¼ãƒˆ
                const sortedCategories = Object.entries(categoryTime)
                    .sort((a, b) => b[1] - a[1]);
                
                let tableHTML = `
                    <table style="width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <thead>
                            <tr style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                                <th style="padding: 12px; text-align: left; font-size: 0.9em;">ã‚«ãƒ†ã‚´ãƒª</th>
                                <th style="padding: 12px; text-align: right; font-size: 0.9em;">åˆè¨ˆæ™‚é–“</th>
                                <th style="padding: 12px; text-align: right; font-size: 0.9em;">å‰²åˆ</th>
                                <th style="padding: 12px; text-align: right; font-size: 0.9em;">è¨˜éŒ²æ•°</th>
                                <th style="padding: 12px; text-align: right; font-size: 0.9em;">å¹³å‡/å›</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                sortedCategories.forEach(([category, minutes], index) => {
                    const hours = (minutes / 60).toFixed(1);
                    const percentage = ((minutes / totalMinutes) * 100).toFixed(1);
                    const count = categoryCount[category];
                    const avgMinutes = Math.round(minutes / count);
                    const avgHours = (avgMinutes / 60).toFixed(1);
                    const bgColor = index % 2 === 0 ? '#f8f9ff' : 'white';
                    
                    tableHTML += `
                        <tr style="background: ${bgColor}; border-bottom: 1px solid #e0e0e0;">
                            <td style="padding: 12px; font-weight: 500;">${activityCategoryNames[category] || category}</td>
                            <td style="padding: 12px; text-align: right; font-weight: 600; color: #667eea;">${hours}h (${minutes}åˆ†)</td>
                            <td style="padding: 12px; text-align: right;">${percentage}%</td>
                            <td style="padding: 12px; text-align: right;">${count}å›</td>
                            <td style="padding: 12px; text-align: right; color: #666;">${avgHours}h</td>
                        </tr>
                    `;
                });
                
                tableHTML += `
                        </tbody>
                    </table>
                `;
                
                detailTable.innerHTML = tableHTML;
                document.getElementById('activitySummary').appendChild(detailTable);
            }
            
            // æ—¥åˆ¥ã®å€‹åˆ¥è¨˜éŒ²ä¸€è¦§ã‚’è¿½åŠ 
            if (data.length > 0) {
                const dailyRecords = document.createElement('div');
                dailyRecords.style.cssText = 'margin-top: 30px;';
                
                // æ—¥ä»˜ã”ã¨ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
                const recordsByDate = {};
                data.forEach(a => {
                    const date = new Date(a.timestamp).toLocaleDateString('ja-JP', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric',
                        weekday: 'short'
                    });
                    if (!recordsByDate[date]) recordsByDate[date] = [];
                    recordsByDate[date].push(a);
                });
                
                // æ—¥ä»˜é †ã«ã‚½ãƒ¼ãƒˆï¼ˆæ–°ã—ã„é †ï¼‰
                const sortedDates = Object.keys(recordsByDate).sort((a, b) => {
                    return new Date(recordsByDate[b][0].timestamp) - new Date(recordsByDate[a][0].timestamp);
                });
                
                let dailyHTML = '<div style="margin-bottom: 10px;">';
                dailyHTML += '<h3 style="font-size: 1.2em; color: #667eea; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">';
                dailyHTML += '<span>ğŸ“… æ—¥åˆ¥ã®è¨˜éŒ²</span>';
                dailyHTML += '<button onclick="toggleAllDailyRecords()" id="toggleAllBtn" style="padding: 5px 12px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 0.85em;">ã™ã¹ã¦å±•é–‹</button>';
                dailyHTML += '</h3>';
                
                sortedDates.forEach((date, dateIndex) => {
                    const records = recordsByDate[date];
                    const dailyTotal = records.reduce((sum, a) => {
                        const endTime = a.endTime || Date.now();
                        return sum + Math.round((endTime - a.startTime) / 60000);
                    }, 0);
                    const dailyHours = (dailyTotal / 60).toFixed(1);
                    
                    dailyHTML += `
                        <div style="margin-bottom: 15px; border: 1px solid #e0e0e0; border-radius: 10px; overflow: hidden; background: white; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                            <div onclick="toggleDailyRecord(${dateIndex})" style="padding: 15px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; cursor: pointer; display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <strong style="font-size: 1.05em;">${date}</strong>
                                    <span style="margin-left: 15px; opacity: 0.9;">${records.length}ä»¶ / ${dailyHours}h</span>
                                </div>
                                <span id="arrow-${dateIndex}" style="font-size: 1.2em; transition: transform 0.3s;">â–¼</span>
                            </div>
                            <div id="daily-${dateIndex}" style="display: none; padding: 0;">
                    `;
                    
                    // æ™‚åˆ»é †ã«ã‚½ãƒ¼ãƒˆ
                    const sortedRecords = [...records].sort((a, b) => a.startTime - b.startTime);
                    
                    sortedRecords.forEach((a, recordIndex) => {
                        const startTime = new Date(a.startTime).toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' });
                        const endTime = a.endTime ? new Date(a.endTime).toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' }) : 'ç¶™ç¶šä¸­';
                        const duration = a.endTime ? Math.round((a.endTime - a.startTime) / 60000) : Math.round((Date.now() - a.startTime) / 60000);
                        const hours = (duration / 60).toFixed(1);
                        const bgColor = recordIndex % 2 === 0 ? '#f8f9ff' : 'white';
                        
                        dailyHTML += `
                            <div style="padding: 12px 15px; border-bottom: 1px solid #f0f0f0; background: ${bgColor}; display: flex; justify-content: space-between; align-items: center;">
                                <div style="flex: 1;">
                                    <div style="font-weight: 500; color: #333; margin-bottom: 5px;">${a.text}</div>
                                    <div style="font-size: 0.9em; color: #666;">
                                        <span style="background: #e3f2fd; padding: 3px 8px; border-radius: 4px; margin-right: 10px;">${activityCategoryNames[a.category] || a.category}</span>
                                        <span>â° ${startTime} - ${endTime}</span>
                                        <span style="margin-left: 10px; font-weight: 600; color: #667eea;">(${hours}h)</span>
                                    </div>
                                </div>
                                <div style="display: flex; gap: 5px;">
                                    <button onclick="editActivity(${a.id})" style="padding: 6px 12px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 0.85em;">âœï¸ ç·¨é›†</button>
                                </div>
                            </div>
                        `;
                    });
                    
                    dailyHTML += `
                            </div>
                        </div>
                    `;
                });
                
                dailyHTML += '</div>';
                dailyRecords.innerHTML = dailyHTML;
                document.getElementById('activitySummary').appendChild(dailyRecords);
            }
            
            // ã‚°ãƒ©ãƒ•è¡¨ç¤º
            const ctx = document.getElementById('reportActivityChart').getContext('2d');
            if (window.reportActivityChart) window.reportActivityChart.destroy();
            
            if (Object.keys(categoryTime).length > 0) {
                const colors = { 
                    work: '#1976d2', study: '#7b1fa2', exercise: '#388e3c', 
                    meal: '#f57c00', leisure: '#c2185b', other: '#616161' 
                };
                
                // ã‚«ã‚¹ã‚¿ãƒ ã‚«ãƒ†ã‚´ãƒªã®è‰²ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«ç”Ÿæˆ
                Object.keys(categoryTime).forEach(cat => {
                    if (!colors[cat]) {
                        colors[cat] = `hsl(${Math.random() * 360}, 60%, 50%)`;
                    }
                });
                
                window.reportActivityChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: Object.keys(categoryTime).map(c => activityCategoryNames[c] || c),
                        datasets: [{
                            data: Object.values(categoryTime),
                            backgroundColor: Object.keys(categoryTime).map(c => colors[c])
                        }]
                    },
                    options: { 
                        responsive: true, 
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            }
        }

        function renderMoneySummary(data) {
            let income = 0, expense = 0;
            const categoryExpense = {};
            
            data.forEach(r => {
                if (r.type === 'income') {
                    income += r.amount;
                } else {
                    expense += r.amount;
                    if (!categoryExpense[r.category]) categoryExpense[r.category] = 0;
                    categoryExpense[r.category] += r.amount;
                }
            });
            
            const balance = income - expense;
            const days = currentPeriod === 'today' ? 1 : (currentPeriod === 'week' ? 7 : 30);
            const avgExpensePerDay = (expense / days).toFixed(0);
            
            document.getElementById('moneySummary').innerHTML = `
                <div class="summary-item">
                    <div class="summary-item-title">åå…¥</div>
                    <div class="summary-item-value" style="color: #4CAF50;">+${income.toLocaleString()}å††</div>
                </div>
                <div class="summary-item">
                    <div class="summary-item-title">æ”¯å‡º</div>
                    <div class="summary-item-value" style="color: #f44336;">-${expense.toLocaleString()}å††</div>
                </div>
                <div class="summary-item">
                    <div class="summary-item-title">åæ”¯</div>
                    <div class="summary-item-value" style="color: ${balance >= 0 ? '#4CAF50' : '#f44336'};">${balance >= 0 ? '+' : ''}${balance.toLocaleString()}å††</div>
                </div>
                <div class="summary-item">
                    <div class="summary-item-title">1æ—¥å¹³å‡æ”¯å‡º</div>
                    <div class="summary-item-value">${avgExpensePerDay}å††</div>
                </div>
            `;
            
            const ctx = document.getElementById('reportMoneyChart').getContext('2d');
            if (window.reportMoneyChart) window.reportMoneyChart.destroy();
            
            if (Object.keys(categoryExpense).length > 0) {
                const colors = { food: '#c62828', transport: '#00695c', shopping: '#ad1457', entertainment: '#6a1b9a', other: '#616161' };
                window.reportMoneyChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: Object.keys(categoryExpense),
                        datasets: [{
                            label: 'æ”¯å‡ºï¼ˆå††ï¼‰',
                            data: Object.values(categoryExpense),
                            backgroundColor: Object.keys(categoryExpense).map(c => colors[c] || '#616161')
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: { y: { beginAtZero: true } }
                    }
                });
            }
        }

        function renderWeightSummary(data) {
            if (data.length === 0) {
                document.getElementById('weightSummary').innerHTML = '<div class="empty-state">ãƒ‡ãƒ¼ã‚¿ãªã—</div>';
                return;
            }
            
            const sorted = [...data].sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
            const latest = sorted[sorted.length - 1].weight;
            const oldest = sorted[0].weight;
            const change = latest - oldest;
            const average = (data.reduce((sum, r) => sum + r.weight, 0) / data.length).toFixed(1);
            
            document.getElementById('weightSummary').innerHTML = `
                <div class="summary-item">
                    <div class="summary-item-title">æœ€æ–°ä½“é‡</div>
                    <div class="summary-item-value">${latest}kg</div>
                </div>
                <div class="summary-item">
                    <div class="summary-item-title">å¤‰åŒ–</div>
                    <div class="summary-item-value" style="color: ${change < 0 ? '#4CAF50' : change > 0 ? '#f44336' : '#666'};">${change > 0 ? '+' : ''}${change.toFixed(1)}kg</div>
                </div>
                <div class="summary-item">
                    <div class="summary-item-title">å¹³å‡</div>
                    <div class="summary-item-value">${average}kg</div>
                </div>
            `;
            
            const ctx = document.getElementById('reportWeightChart').getContext('2d');
            if (window.reportWeightChart) window.reportWeightChart.destroy();
            
            window.reportWeightChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: sorted.map(r => new Date(r.timestamp).toLocaleDateString('ja-JP', { month: 'short', day: 'numeric' })),
                    datasets: [{
                        label: 'ä½“é‡ï¼ˆkgï¼‰',
                        data: sorted.map(r => r.weight),
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: { y: { beginAtZero: false } }
                }
            });
        }

        function renderJournalSummary(data) {
            const list = document.getElementById('journalSummaryList');
            
            if (data.length === 0) {
                list.innerHTML = '<div class="empty-state">ã“ã®æœŸé–“ã®ã‚¸ãƒ£ãƒ¼ãƒŠãƒ«ã¯ã‚ã‚Šã¾ã›ã‚“</div>';
                return;
            }
            
            const sorted = [...data].sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            
            list.innerHTML = sorted.map(j => {
                const date = new Date(j.timestamp).toLocaleDateString('ja-JP', {
                    month: 'short',
                    day: 'numeric',
                    weekday: 'short'
                });
                
                const preview = j.text.length > 150 ? j.text.slice(0, 150) + '...' : j.text;
                
                return `
                    <div class="journal-summary-item">
                        <div class="journal-summary-item-date">${moodEmojis[j.mood]} ${date}</div>
                        <div class="journal-summary-item-preview">${preview}</div>
                    </div>
                `;
            }).join('');
        }

        // AIã‚¢ãƒ‰ãƒã‚¤ã‚¹ç”Ÿæˆ
        function generateAdvice() {
            const button = document.querySelector('.ai-advice-button');
            const content = document.getElementById('adviceContent');
            
            button.textContent = 'ğŸ¤– åˆ†æä¸­...';
            button.classList.add('loading');
            
            setTimeout(() => {
                const advice = analyzeData();
                content.innerHTML = advice;
                content.classList.add('show');
                button.textContent = 'ğŸ¤– AIã§ç·åˆçš„ãªæŒ¯ã‚Šè¿”ã‚Šåˆ†æã‚’å–å¾—';
                button.classList.remove('loading');
            }, 1500);
        }

        function analyzeData() {
            const periodActivities = filterByDateRange(activities);
            const periodMoney = filterByDateRange(moneyRecords);
            const periodWeight = filterByDateRange(weightRecords);
            const periodJournals = filterByDateRange(journals);
            
            let advice = '<h4>ğŸ“Š ç·åˆåˆ†æ</h4>';
            
            // ã‚¸ãƒ£ãƒ¼ãƒŠãƒ«åˆ†æ
            if (periodJournals.length > 0) {
                const moodCounts = { good: 0, normal: 0, bad: 0 };
                periodJournals.forEach(j => moodCounts[j.mood]++);
                
                const totalDays = currentPeriod === 'today' ? 1 : (currentPeriod === 'week' ? 7 : 30);
                const journalRate = ((periodJournals.length / totalDays) * 100).toFixed(0);
                
                advice += `<h4>ğŸ“” ã‚¸ãƒ£ãƒ¼ãƒŠãƒ«ã‹ã‚‰è¦‹ãˆã‚‹å¿ƒã®çŠ¶æ…‹</h4><ul>`;
                advice += `<li>ã“ã®æœŸé–“ã«<strong>${periodJournals.length}æ—¥åˆ†</strong>ã®ã‚¸ãƒ£ãƒ¼ãƒŠãƒ«ã‚’è¨˜éŒ²ã—ã¾ã—ãŸï¼ˆè¨˜éŒ²ç‡${journalRate}%ï¼‰ã€‚</li>`;
                
                if (moodCounts.good > moodCounts.bad) {
                    advice += `<li>ğŸ˜Š è‰¯ã„æ—¥ãŒå¤šãã€ãƒã‚¸ãƒ†ã‚£ãƒ–ãªæœŸé–“ã§ã—ãŸã­ï¼</li>`;
                } else if (moodCounts.bad > moodCounts.good) {
                    advice += `<li>ğŸ˜¢ å¤§å¤‰ãªæ—¥ãŒå¤šã‹ã£ãŸã‚ˆã†ã§ã™ã€‚ç„¡ç†ã›ãšä¼‘æ¯ã‚’å–ã‚Šã¾ã—ã‚‡ã†ã€‚</li>`;
                } else {
                    advice += `<li>ğŸ˜ å®‰å®šã—ãŸæ—¥ã€…ã‚’éã”ã›ã¦ã„ã¾ã™ã­ã€‚</li>`;
                }
                
                advice += '</ul>';
            }
            
            // è¡Œå‹•åˆ†æ
            if (periodActivities.length > 0) {
                const categoryTime = {};
                periodActivities.forEach(a => {
                    const minutes = Math.round(((a.endTime || Date.now()) - a.startTime) / 60000);
                    if (!categoryTime[a.category]) categoryTime[a.category] = 0;
                    categoryTime[a.category] += minutes;
                });
                
                const topCategory = Object.keys(categoryTime).reduce((a, b) => categoryTime[a] > categoryTime[b] ? a : b);
                const topHours = (categoryTime[topCategory] / 60).toFixed(1);
                
                advice += `<h4>â±ï¸ è¡Œå‹•ãƒ‘ã‚¿ãƒ¼ãƒ³</h4><ul>`;
                advice += `<li>æœ€ã‚‚æ™‚é–“ã‚’ä½¿ã£ãŸã®ã¯<strong>ã€Œ${activityCategoryNames[topCategory]}ã€</strong>ã§${topHours}æ™‚é–“ã§ã™ã€‚</li>`;
                
                if (categoryTime['exercise'] && categoryTime['exercise'] < 60 * 2) {
                    advice += `<li>ğŸ’ª é‹å‹•æ™‚é–“ãŒå°‘ãªã‚ã§ã™ã€‚1æ—¥30åˆ†ã®é‹å‹•ã‚’ç›®æ¨™ã«ã—ã¾ã—ã‚‡ã†ã€‚</li>`;
                } else if (categoryTime['exercise']) {
                    advice += `<li>ğŸ’ª é‹å‹•ç¿’æ…£ãŒç´ æ™´ã‚‰ã—ã„ã§ã™ï¼ç¶™ç¶šã—ã¾ã—ã‚‡ã†ã€‚</li>`;
                }
                
                advice += '</ul>';
            }
            
            // ãŠé‡‘åˆ†æ
            if (periodMoney.length > 0) {
                let income = 0, expense = 0;
                periodMoney.forEach(r => {
                    if (r.type === 'income') income += r.amount;
                    else expense += r.amount;
                });
                
                const balance = income - expense;
                
                advice += `<h4>ğŸ’° ãŠé‡‘ã®ä½¿ã„æ–¹</h4><ul>`;
                
                if (balance > 0) {
                    advice += `<li>âœ… åæ”¯ãŒãƒ—ãƒ©ã‚¹${balance.toLocaleString()}å††ã§ã™ã€‚è‰¯å¥½ãªçŠ¶æ…‹ã§ã™ã­ï¼</li>`;
                } else if (balance < 0) {
                    advice += `<li>âš ï¸ åæ”¯ãŒãƒã‚¤ãƒŠã‚¹${Math.abs(balance).toLocaleString()}å††ã§ã™ã€‚æ”¯å‡ºã‚’è¦‹ç›´ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</li>`;
                }
                
                advice += '</ul>';
            }
            
            // ä½“é‡åˆ†æ
            if (periodWeight.length > 1) {
                const sorted = [...periodWeight].sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
                const change = sorted[sorted.length - 1].weight - sorted[0].weight;
                
                advice += `<h4>âš–ï¸ ä½“é‡ã®å¤‰åŒ–</h4><ul>`;
                
                if (Math.abs(change) < 0.5) {
                    advice += `<li>âœ… ä½“é‡ãŒå®‰å®šã—ã¦ã„ã¾ã™ã€‚ç¾çŠ¶ç¶­æŒã§ãã¦ã„ã¾ã™ã­ã€‚</li>`;
                } else if (change < 0) {
                    advice += `<li>ğŸ“‰ ${Math.abs(change).toFixed(1)}kgæ¸›å°‘ã—ã¾ã—ãŸã€‚å¥åº·çš„ãªãƒšãƒ¼ã‚¹ã§ã™ï¼</li>`;
                } else {
                    advice += `<li>ğŸ“ˆ ${change.toFixed(1)}kgå¢—åŠ ã—ã¾ã—ãŸã€‚é£Ÿç”Ÿæ´»ã¨é‹å‹•ã‚’è¦‹ç›´ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</li>`;
                }
                
                advice += '</ul>';
            }
            
            // ç·åˆã‚¢ãƒ‰ãƒã‚¤ã‚¹
            advice += `<h4>ğŸ¯ æ¬¡ã®ç›®æ¨™</h4><ul>`;
            
            if (periodJournals.length < 3 && currentPeriod === 'week') {
                advice += `<li>æ¯æ—¥ã®ã‚¸ãƒ£ãƒ¼ãƒŠãƒ«ç¿’æ…£ã‚’ã¤ã‘ã‚‹ã¨ã€è‡ªå·±ç†è§£ãŒæ·±ã¾ã‚Šã¾ã™ã€‚</li>`;
            }
            
            if (!periodActivities.some(a => a.category === 'exercise')) {
                advice += `<li>ã¾ãšã¯é€±ã«3å›ã€30åˆ†ã®é‹å‹•ã‚’ç¿’æ…£åŒ–ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</li>`;
            }
            
            advice += `<li>ã“ã®ãƒšãƒ¼ã‚¹ã§è¨˜éŒ²ã‚’ç¶šã‘ã‚‹ã“ã¨ã§ã€ã‚ˆã‚Šè©³ç´°ãªåˆ†æãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼</li>`;
            advice += '</ul>';
            
            return advice;
        }

        // ã‚«ãƒ†ã‚´ãƒªç®¡ç†
        let currentCategoryType = 'activity';
        let allDailyRecordsExpanded = false;

        function toggleDailyRecord(index) {
            const content = document.getElementById(`daily-${index}`);
            const arrow = document.getElementById(`arrow-${index}`);
            
            if (content.style.display === 'none') {
                content.style.display = 'block';
                arrow.style.transform = 'rotate(180deg)';
            } else {
                content.style.display = 'none';
                arrow.style.transform = 'rotate(0deg)';
            }
        }

        function toggleAllDailyRecords() {
            allDailyRecordsExpanded = !allDailyRecordsExpanded;
            const toggleBtn = document.getElementById('toggleAllBtn');
            
            // ã™ã¹ã¦ã®æ—¥åˆ¥è¨˜éŒ²ã‚’å±•é–‹/æŠ˜ã‚ŠãŸãŸã¿
            const allContents = document.querySelectorAll('[id^="daily-"]');
            const allArrows = document.querySelectorAll('[id^="arrow-"]');
            
            allContents.forEach(content => {
                content.style.display = allDailyRecordsExpanded ? 'block' : 'none';
            });
            
            allArrows.forEach(arrow => {
                arrow.style.transform = allDailyRecordsExpanded ? 'rotate(180deg)' : 'rotate(0deg)';
            });
            
            toggleBtn.textContent = allDailyRecordsExpanded ? 'ã™ã¹ã¦æŠ˜ã‚ŠãŸãŸã‚€' : 'ã™ã¹ã¦å±•é–‹';
        }

        function openCategoryManager(type) {
            currentCategoryType = type;
            document.getElementById('categoryManagerTitle').textContent = 
                type === 'activity' ? 'âš™ï¸ è¡Œå‹•ã‚«ãƒ†ã‚´ãƒªç®¡ç†' : 'âš™ï¸ ãŠé‡‘ã‚«ãƒ†ã‚´ãƒªç®¡ç†';
            renderCategoryList();
            document.getElementById('categoryManagerModal').classList.add('show');
        }

        function closeCategoryManager() {
            document.getElementById('categoryManagerModal').classList.remove('show');
            document.getElementById('newCategoryKey').value = '';
            document.getElementById('newCategoryName').value = '';
        }

        function renderCategoryList() {
            const defaultCategories = currentCategoryType === 'activity' ? 
                defaultActivityCategories : defaultMoneyCategories;
            const customCategories = currentCategoryType === 'activity' ? 
                customActivityCategories : customMoneyCategories;
            const allCategories = { ...defaultCategories, ...customCategories };
            
            let html = '<div style="display: flex; flex-direction: column; gap: 10px;">';
            
            Object.entries(allCategories).forEach(([key, name]) => {
                const isDefault = key in defaultCategories;
                const deleteButton = isDefault ? 
                    '<span style="color: #999; font-size: 0.85em;">ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰</span>' : 
                    `<button onclick="deleteCustomCategory('${key}')" style="padding: 5px 10px; background: #f44336; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 0.85em;">âœ– å‰Šé™¤</button>`;
                
                html += `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: ${isDefault ? '#f0f0f0' : '#e3f2fd'}; border-radius: 8px;">
                        <div>
                            <strong style="color: #667eea;">${name}</strong>
                            <span style="color: #999; margin-left: 10px; font-size: 0.85em;">(${key})</span>
                        </div>
                        ${deleteButton}
                    </div>
                `;
            });
            
            html += '</div>';
            document.getElementById('categoryList').innerHTML = html;
        }

        function addCustomCategory() {
            const key = document.getElementById('newCategoryKey').value.trim();
            const name = document.getElementById('newCategoryName').value.trim();
            
            if (!key || !name) {
                alert('IDã¨åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            // IDã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆè‹±æ•°å­—ã®ã¿ï¼‰
            if (!/^[a-zA-Z0-9_]+$/.test(key)) {
                alert('IDã¯è‹±æ•°å­—ã¨ã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢ã®ã¿ä½¿ç”¨ã§ãã¾ã™');
                return;
            }
            
            // é‡è¤‡ãƒã‚§ãƒƒã‚¯
            const allCategories = currentCategoryType === 'activity' ? 
                { ...defaultActivityCategories, ...customActivityCategories } : 
                { ...defaultMoneyCategories, ...customMoneyCategories };
            
            if (key in allCategories) {
                alert('ã“ã®IDã¯ã™ã§ã«å­˜åœ¨ã—ã¾ã™');
                return;
            }
            
            // è¿½åŠ 
            if (currentCategoryType === 'activity') {
                customActivityCategories[key] = name;
                localStorage.setItem('customActivityCategories', JSON.stringify(customActivityCategories));
                // activityCategoryNamesã‚’æ›´æ–°
                Object.assign(activityCategoryNames, customActivityCategories);
                updateActivityCategorySelects();
            } else {
                customMoneyCategories[key] = name;
                localStorage.setItem('customMoneyCategories', JSON.stringify(customMoneyCategories));
                // moneyCategoryNamesã‚’æ›´æ–°
                Object.assign(moneyCategoryNames, customMoneyCategories);
                updateMoneyCategorySelects();
            }
            
            document.getElementById('newCategoryKey').value = '';
            document.getElementById('newCategoryName').value = '';
            renderCategoryList();
        }

        function deleteCustomCategory(key) {
            if (!confirm(`ã‚«ãƒ†ã‚´ãƒªã€Œ${currentCategoryType === 'activity' ? activityCategoryNames[key] : moneyCategoryNames[key]}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)) {
                return;
            }
            
            if (currentCategoryType === 'activity') {
                delete customActivityCategories[key];
                delete activityCategoryNames[key];
                localStorage.setItem('customActivityCategories', JSON.stringify(customActivityCategories));
                updateActivityCategorySelects();
            } else {
                delete customMoneyCategories[key];
                delete moneyCategoryNames[key];
                localStorage.setItem('customMoneyCategories', JSON.stringify(customMoneyCategories));
                updateMoneyCategorySelects();
            }
            
            renderCategoryList();
        }

        function updateActivityCategorySelects() {
            const selects = ['activityCategorySelect', 'editActivityCategory'];
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (!select) return;
                
                const currentValue = select.value;
                select.innerHTML = '';
                
                // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚«ãƒ†ã‚´ãƒª
                Object.entries(defaultActivityCategories).forEach(([key, name]) => {
                    const option = document.createElement('option');
                    option.value = key;
                    option.textContent = name;
                    select.appendChild(option);
                });
                
                // ã‚«ã‚¹ã‚¿ãƒ ã‚«ãƒ†ã‚´ãƒª
                Object.entries(customActivityCategories).forEach(([key, name]) => {
                    const option = document.createElement('option');
                    option.value = key;
                    option.textContent = `â­ ${name}`;
                    select.appendChild(option);
                });
                
                if (currentValue && activityCategoryNames[currentValue]) {
                    select.value = currentValue;
                }
            });
        }

        function updateMoneyCategorySelects() {
            const selects = ['moneyCategorySelect', 'editMoneyCategory'];
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (!select) return;
                
                const currentValue = select.value;
                select.innerHTML = '';
                
                // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚«ãƒ†ã‚´ãƒª
                Object.entries(defaultMoneyCategories).forEach(([key, name]) => {
                    const option = document.createElement('option');
                    option.value = key;
                    option.textContent = name;
                    select.appendChild(option);
                });
                
                // ã‚«ã‚¹ã‚¿ãƒ ã‚«ãƒ†ã‚´ãƒª
                Object.entries(customMoneyCategories).forEach(([key, name]) => {
                    const option = document.createElement('option');
                    option.value = key;
                    option.textContent = `â­ ${name}`;
                    select.appendChild(option);
                });
                
                if (currentValue && moneyCategoryNames[currentValue]) {
                    select.value = currentValue;
                }
            });
        }

        // åˆæœŸè¡¨ç¤º
        updateActivityCategorySelects();
        updateMoneyCategorySelects();
        renderActivityLogs();
        renderMoneyLogs();
        renderWeightHistory();
        renderJournalList();
        renderJournalCalendar(); // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚‚åˆæœŸè¡¨ç¤º
    </script>
</body>
</html>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                