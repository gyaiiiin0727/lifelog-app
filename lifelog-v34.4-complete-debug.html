<!DOCTYPE html>
<html lang="ja">
<head>
    <!-- „Ç≠„É£„ÉÉ„Ç∑„É•ÁÑ°ÂäπÂåñ -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>„É©„Ç§„Éï„É≠„Ç∞„Ç¢„Éó„É™ v34.4 - ÂÆåÂÖ®„Éá„Éê„ÉÉ„Ç∞Áâà</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Helvetica Neue", Arial, sans-serif;
            background: #ffffff;
            color: #333;
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
        }
        
        button {
            -webkit-tap-highlight-color: rgba(0,0,0,0.1);
            touch-action: manipulation;
            user-select: none;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 1.8em;
            color: #000;
        }
        
        .tab-nav {
            display: flex;
            gap: 0;
            border-bottom: 2px solid #e0e0e0;
            margin-bottom: 30px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .tab-nav::-webkit-scrollbar {
            display: none;
        }
        
        .tab-button {
            flex: 1;
            min-width: 80px;
            padding: 15px 10px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-size: 0.95em;
            color: #666;
            transition: all 0.3s;
        }
        
        .tab-button.active {
            color: #000;
            border-bottom-color: #000;
            font-weight: 600;
        }
        
        .tab-button:active {
            opacity: 0.7;
        }
        
        .tab-content {
            position: relative;
            z-index: 1;
            display: none;
        }
        
        .tab-content.active {
            z-index: 10;
            display: block;
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .voice-button {
            width: 100%;
            padding: 18px;
            background: #fff;
            border: 2px solid #000;
            border-radius: 12px;
            font-size: 1.1em;
            cursor: pointer;
            margin-bottom: 20px;
            transition: all 0.3s;
            font-weight: 600;
        }
        
        .voice-button:hover {
            background: #000;
            color: #fff;
        }
        
        .voice-button:active {
            transform: scale(0.98);
        }
        
        .voice-button.listening {
            background: #000;
            color: #fff;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .quick-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .quick-button {
            padding: 12px 8px;
            background: #fff;
            border: 1px solid #333;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.2s;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }
        
        .quick-button:hover {
            background: #f5f5f5;
            border-color: #000;
        }
        
        .quick-button.selected {
            background: #000;
            color: #fff;
            border-color: #000;
            font-weight: bold;
        }
        
        .quick-button:active {
            background: #000;
            color: #fff;
            transform: scale(0.95);
        }
        
        .text-input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            margin-bottom: 15px;
        }
        
        .text-input:focus {
            outline: none;
            border-color: #000;
            border-width: 2px;
        }
        
        textarea.text-input {
            min-height: 150px;
            resize: vertical;
            font-family: inherit;
        }
        
        .add-button {
            width: 100%;
            padding: 14px;
            background: #000;
            color: #fff;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .add-button:active {
            transform: scale(0.98);
            opacity: 0.9;
        }
        
        .status {
            text-align: center;
            padding: 10px;
            color: #666;
            font-size: 0.9em;
        }
        
        .logs-section {
            margin-top: 30px;
        }
        
        .section-title {
            font-size: 1.2em;
            margin-bottom: 15px;
            color: #000;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .log-item {
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
        }
        
        .log-item:hover {
            border-color: #000;
        }
        
        /* „Ç´„ÉÜ„Ç¥„É™ÁÆ°ÁêÜ„Éú„Çø„É≥ */
        .manage-button {
            padding: 8px 15px;
            background: #fff;
            color: #000;
            border: 1px solid #000;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
        }
        
        .manage-button:hover {
            background: #000;
            color: #fff;
        }
        
        /* Ê∞óÂàÜÈÅ∏Êäû */
        /* „Ç´„ÉÜ„Ç¥„É™ÈÅ∏Êäû„ÇíÈùûË°®Á§∫ */
        .category-selector,
        .category-required-hint,
        .selected-category-display {
            display: none !important;
        }

        /* journal„Çø„Éñ„ÅåÈùû„Ç¢„ÇØ„ÉÜ„Ç£„ÉñÊôÇ„ÅØÂÆåÂÖ®ÈùûË°®Á§∫ */
        .journal-tab:not(.active) {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
            pointer-events: none !important;
        }

        /* „Ç∏„É£„Éº„Éä„É´„Çø„Éñ‰ª•Â§ñ„Åß„ÅØÊ∞óÂàÜÈÅ∏Êäû„ÇíÈùûË°®Á§∫ */
        #reportActivity .mood-selector,
        #reportMoney .mood-selector,
        #goals .mood-selector {
            display: none !important;
        }
        
        /* „Ç∏„É£„Éº„Éä„É´„Çø„Éñ‰ª•Â§ñ„Åß„ÅØÊó•‰ªòÈÅ∏Êäû„Éª„ÉÜ„Ç≠„Çπ„Éà„Ç®„É™„Ç¢„Éª‰øùÂ≠ò„Éú„Çø„É≥„ÇíÈùûË°®Á§∫ */
# 283-293Ë°å„Çí‰øÆÊ≠£
# ‰øÆÊ≠£ÂâçÔºö
#         /* „Ç∏„É£„Éº„Éä„É´„Çø„Éñ‰ª•Â§ñ„Åß„ÅØÊó•‰ªòÈÅ∏Êäû„Éª„ÉÜ„Ç≠„Çπ„Éà„Ç®„É™„Ç¢„Éª‰øùÂ≠ò„Éú„Çø„É≥„ÇíÈùûË°®Á§∫ */
#         #reportActivity .date-selector,
#         #reportMoney .date-selector,
#         #goals .date-selector,
#         #reportActivity textarea,
#         #reportMoney textarea,
#         #goals textarea,
#         #reportActivity .btn-primary,
#         #reportMoney .btn-primary,
#         #goals .btn-primary {
#             display: none !important;
#         }
#
# ‰øÆÊ≠£ÂæåÔºö
        /* „É¨„Éù„Éº„Éà„Çø„Éñ„Åß„ÅØÊó•‰ªòÈÅ∏Êäû„Éª„ÉÜ„Ç≠„Çπ„Éà„Ç®„É™„Ç¢„Éª‰øùÂ≠ò„Éú„Çø„É≥„ÇíÈùûË°®Á§∫ */
        #reportActivity .date-selector,
        #reportMoney .date-selector,
        #reportActivity textarea,
        #reportMoney textarea,
        #reportActivity .btn-primary,
        #reportMoney .btn-primary {
            display: none !important;
        }
        
        /* ÁõÆÊ®ô„Çø„Éñ„Åß„ÅØ btn-primary „ÇíË°®Á§∫ */
        #goals .btn-primary {
            display: block !important;
        }

        .mood-selector {
            margin: 20px 0;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 12px;
            border: 1px solid #e0e0e0;
        }
        
        .mood-selector-title {
            font-size: 1em;
            font-weight: 600;
            margin-bottom: 15px;
            text-align: center;
            color: #000;
        }
        
        .mood-buttons {
            display: flex;
            justify-content: space-around;
            gap: 10px;
        }
        
        .mood-button {
            flex: 1;
            padding: 15px 5px;
            background: #fff;
            border: 2px solid #ddd;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }
        
        .mood-button:hover {
            border-color: #666;
            transform: translateY(-2px);
        }
        
        .mood-button.selected {
            border-color: #000;
            background: #f0f8ff;
            border-width: 3px;
        }
        
        .mood-emoji {
            font-size: 2em;
        }
        
        .mood-label {
            font-size: 0.8em;
            color: #666;
            font-weight: 500;
        }
        
        .mood-button.selected .mood-label {
            color: #000;
            font-weight: 600;
        }
        
        /* „É¢„Éº„ÉÄ„É´ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            overflow-y: auto;
        }
        
        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: #fff;
            border-radius: 12px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-title {
            font-size: 1.5em;
            margin-bottom: 20px;
            color: #000;
        }
        
        .modal-close {
            float: right;
            font-size: 1.5em;
            cursor: pointer;
            color: #666;
        }
        
        .modal-close:hover {
            color: #000;
        }
        
        /* „Ç∏„É£„Éº„Éä„É´Ë¶ÅÁ¥Ñ„Çª„ÇØ„Ç∑„Éß„É≥ */
        .summary-section {
            display: none;
            margin-top: 20px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 12px;
            border: 1px solid #e0e0e0;
        }
        
        .summary-section.active {
            display: block;
        }
        
        .summary-item {
            margin-bottom: 20px;
        }
        
        .summary-label {
            font-weight: 600;
            font-size: 1em;
            margin-bottom: 8px;
            color: #000;
        }
        
        .summary-content {
            padding: 12px;
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 8px;
            min-height: 60px;
            white-space: pre-wrap;
        }
        
        .ai-comment {
            margin-top: 10px;
            padding: 12px;
            background: #f0f8ff;
            border-left: 4px solid #000;
            border-radius: 4px;
            font-size: 0.9em;
            color: #333;
        }
        
        .ai-comment::before {
            content: 'üí¨ AI„Åã„Çâ„ÅÆ„Ç≥„É°„É≥„Éà: ';
            font-weight: 600;
            display: block;
            margin-bottom: 5px;
        }
        
        /* „Ç´„É¨„É≥„ÉÄ„Éº */
        .calendar {
            margin-top: 20px;
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .calendar-nav {
            padding: 8px 15px;
            background: #fff;
            border: 1px solid #000;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
        }
        
        .calendar-nav:active {
            background: #000;
            color: #fff;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }
        
        .calendar-day-header {
            text-align: center;
            font-weight: 600;
            padding: 10px 5px;
            font-size: 0.9em;
            color: #666;
        }
        
        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            background: #fff;
            transition: all 0.2s;
        }
        
        .calendar-day:hover {
            border-color: #000;
        }
        
        .calendar-day.today {
            background: #000;
            color: #fff;
            font-weight: 600;
        }
        
        .calendar-day.has-journal {
            background: #f0f8ff;
            border-color: #666;
        }
        
        .calendar-day.today.has-journal {
            background: #000;
            color: #fff;
        }
        
        .calendar-day.empty {
            background: transparent;
            border: none;
            cursor: default;
        }
        
        .calendar-day-mood {
            font-size: 1.2em;
            margin-top: 2px;
        }
        
        /* „É¨„Éù„Éº„Éà */
        .chart-container {
            margin: 20px 0;
            padding: 20px;
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            padding: 15px;
            background: #f9f9f9;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: 600;
            color: #000;
        }
        
        .stat-label {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }
        
        /* AI„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ */
        .ai-feedback-container {
            margin: 20px 0;
            padding: 25px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 12px;
            border: 2px solid #000;
        }
        
        .ai-feedback-title {
            font-size: 1.5em;
            font-weight: 600;
            margin-bottom: 20px;
            color: #000;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .feedback-section {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #e0e0e0;
        }
        
        .feedback-section h4 {
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 12px;
            color: #000;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .feedback-item {
            padding: 8px 0;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.95em;
        }
        
        .feedback-icon {
            font-size: 1.2em;
        }
        
        .ai-advice-box {
            background: #f0f8ff;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #000;
            margin: 15px 0;
            line-height: 1.8;
        }
        
        .ai-advice-box::before {
            content: 'üí¨ AI„Åã„Çâ„ÅÆ„Ç¢„Éâ„Éê„Ç§„Çπ';
            display: block;
            font-weight: 600;
            margin-bottom: 10px;
            color: #000;
        }
        
        .goals-list {
            list-style: none;
            padding: 0;
        }
        
        .goals-list li {
            padding: 10px;
            margin: 8px 0;
            background: #f9f9f9;
            border-radius: 6px;
            border-left: 3px solid #000;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .goals-list li::before {
            content: '‚Ä¢';
            font-size: 1.5em;
            color: #000;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            h1 {
                font-size: 1.5em;
                margin-bottom: 20px;
            }
            
            .tab-button {
                min-width: 70px;
                padding: 12px 8px;
                font-size: 0.85em;
            }
            
            .voice-button {
                padding: 16px;
                font-size: 1em;
            }
            
            .quick-buttons {
                grid-template-columns: repeat(4, 1fr) !important;
                gap: 8px;
            }
            
            .quick-button {
                padding: 10px 5px;
                font-size: 0.85em;
                min-height: 48px;
            }
            
            .modal-content {
                padding: 20px;
            }
        }

        /* Á∂ôÁ∂ö‰∏≠Ë°®Á§∫„ÅÆ„Çπ„Çø„Ç§„É´ */
        .ongoing-badge {
            display: inline-block;
            padding: 3px 8px;
            background: linear-gradient(90deg, #4ade80, #22c55e);
            color: white;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: bold;
            margin-left: 8px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .log-item.ongoing {
            border-left: 4px solid #22c55e;
            background: linear-gradient(to right, #f0fdf4, #ffffff);
        }

        .log-item {
            padding: 12px;
            margin-bottom: 10px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background: white;
        }

        .log-header {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }

        .log-info {
            display: flex;
            gap: 15px;
            margin-bottom: 8px;
            font-size: 0.9em;
            color: #666;
        }

        .time-display {
            color: #333;
            font-weight: 500;
        }

        .category-badge {
            padding: 2px 8px;
            background: #f0f0f0;
            border-radius: 12px;
            font-size: 0.9em;
        }

        .log-actions {
            display: flex;
            gap: 8px;
        }

        .log-actions button {
            padding: 5px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: white;
            cursor: pointer;
            font-size: 0.9em;
        }

        .log-actions button:hover {
            background: #f5f5f5;
        }

        .end-btn {
            background: #22c55e !important;
            color: white !important;
            border: none !important;
            font-weight: bold;
        }

        .end-btn:hover {
            background: #16a34a !important;
        }
.report-section {
    margin: 20px 0;
    padding: 15px;
    background: #f9f9f9;
    border-radius: 8px;
}

.report-controls {
    margin-bottom: 15px;
    display: flex;
    gap: 10px;
    align-items: center;
}

.report-controls label {
    display: flex;
    gap: 5px;
    align-items: center;
}

.report-controls input[type="month"] {
    padding: 8px;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 14px;
}

.report-controls button {
    padding: 8px 16px;
    background: #4CAF50;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
}

.report-controls button:hover {
    background: #45a049;
}

.category-summary {
    margin: 10px 0;
    padding: 15px;
    background: white;
    border-radius: 8px;
    border: 1px solid #ddd;
    cursor: pointer;
    transition: all 0.2s;
}

.category-summary:hover {
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.category-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-weight: bold;
}

.category-stats {
    display: flex;
    gap: 20px;
    margin-top: 5px;
    font-size: 0.9em;
    color: #666;
}

.category-details {
    margin-top: 15px;
    padding-top: 15px;
    border-top: 1px solid #eee;
    display: none;
}

.category-details.show {
    display: block;
}

.detail-item {
    padding: 10px;
    margin: 5px 0;
    background: #f5f5f5;
    border-radius: 4px;
    font-size: 0.9em;
}

.detail-item strong {
    display: block;
    margin-bottom: 5px;
}

.total-summary {
    margin: 20px 0;
    padding: 15px;
    background: #e3f2fd;
    border-radius: 8px;
    font-weight: bold;
    text-align: center;
}

.btn-icon {
    background: none;
    border: none;
    font-size: 1.2em;
    cursor: pointer;
    padding: 5px;
    opacity: 0.7;
    transition: opacity 0.2s;
}

.btn-icon:hover {
    opacity: 1;
}

.category-badge {
    display: inline-block;
    padding: 2px 8px;
    background: #f0f0f0;
    border-radius: 4px;
    font-size: 0.85em;
    color: #666;
}
/* ÁõÆÊ®ôÊ©üËÉΩ„ÅÆ„Çπ„Çø„Ç§„É´ */
.goals-section {
    background: #f9f9f9;
    padding: 20px;
    border-radius: 8px;
    margin-bottom: 20px;
}

.goals-list-section {
    margin: 20px 0;
}

.goal-item {
    background: white;
    padding: 15px;
    margin: 10px 0;
    border-radius: 8px;
    border: 2px solid #e0e0e0;
    transition: all 0.2s;
}

.goal-item:hover {
    border-color: #4CAF50;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.goal-item.completed {
    opacity: 0.7;
    background: #f0f8f0;
}

.goal-item.completed .goal-text {
    text-decoration: line-through;
    color: #999;
}

.goal-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 10px;
}

.goal-checkbox {
    width: 20px;
    height: 20px;
    cursor: pointer;
}

.goal-text {
    flex: 1;
    font-size: 1.05em;
    font-weight: 500;
}

.goal-meta {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.goal-category {
    padding: 4px 10px;
    background: #f0f0f0;
    border-radius: 4px;
    font-size: 0.9em;
}

.goals-progress-section {
    background: #f9f9f9;
    padding: 20px;
    border-radius: 8px;
    margin: 20px 0;
}

.progress-summary {
    margin-bottom: 20px;
}

.progress-bar-container {
    width: 100%;
    height: 30px;
    background: #e0e0e0;
    border-radius: 15px;
    overflow: hidden;
    margin-bottom: 10px;
}

.progress-bar {
    height: 100%;
    background: linear-gradient(90deg, #4CAF50, #8BC34A);
    transition: width 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: bold;
}

.progress-text {
    text-align: center;
    font-size: 1.2em;
    font-weight: bold;
    color: #4CAF50;
}

.category-progress h4 {
    margin-bottom: 15px;
    color: #333;
}

.category-stat {
    display: flex;
    justify-content: space-between;
    padding: 10px;
    margin: 5px 0;
    background: white;
    border-radius: 4px;
    border-left: 4px solid #4CAF50;
}

.goals-feedback-section {
    margin: 20px 0;
}

.goals-feedback-section h3 {
    margin-bottom: 15px;
}

.feedback-content {
    line-height: 1.8;
}

.feedback-content p {
    margin: 15px 0;
}

.feedback-content ul {
    padding-left: 20px;
}

.feedback-content li {
    margin: 8px 0;
}

.empty-state {
    text-align: center;
    padding: 40px 20px;
    color: #999;
    font-size: 1.1em;
}
/* „Ç∏„É£„Éº„Éä„É´„É≠„Ç∞„ÅÆÊîπÂñÑ„Çπ„Çø„Ç§„É´ */
.journal-log-item {
    background: white;
    border-radius: 12px;
    margin: 15px 0;
    padding: 15px;
    border: 2px solid #e0e0e0;
    transition: all 0.2s;
}

.journal-log-item:hover {
    border-color: #4CAF50;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.journal-log-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
    padding: 5px 0;
}

.journal-date {
    font-weight: 600;
    font-size: 1.05em;
    color: #333;
}

.toggle-icon {
    color: #999;
    font-size: 0.9em;
    transition: transform 0.2s;
}

.journal-summary-preview {
    margin-top: 15px;
    padding-top: 15px;
    border-top: 1px solid #f0f0f0;
}

.summary-preview-item {
    margin: 10px 0;
}

.summary-label-mini {
    display: inline-block;
    font-weight: 600;
    font-size: 0.9em;
    margin-bottom: 5px;
    color: #555;
}

.summary-items {
    margin-left: 10px;
}

.summary-bullet {
    font-size: 0.95em;
    color: #666;
    line-height: 1.6;
    margin: 3px 0;
}

.summary-more {
    font-size: 0.85em;
    color: #999;
    font-style: italic;
    margin-top: 3px;
}

.journal-detail {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease;
}

.journal-detail.show {
    max-height: 2000px;
    margin-top: 15px;
    padding-top: 15px;
    border-top: 2px solid #e0e0e0;
}

.journal-full-text {
    background: #f9f9f9;
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 15px;
}

.journal-full-text strong {
    display: block;
    margin-bottom: 10px;
    color: #333;
}

.journal-full-summary {
    background: #f0f8ff;
    padding: 15px;
    border-radius: 8px;
}

.journal-full-summary > strong {
    display: block;
    margin-bottom: 15px;
    color: #333;
}

.summary-detail-section {
    margin: 15px 0;
}

.summary-detail-label {
    font-weight: 600;
    color: #555;
    margin-bottom: 8px;
}

.summary-detail-item {
    margin: 5px 0;
    padding-left: 10px;
    color: #666;
    line-height: 1.6;
}
/* ÊâãÂãï„Ç´„ÉÜ„Ç¥„É™ÈÅ∏ÊäûUI */
.category-selector {
    margin: 15px 0;
    padding: 15px;
    background: #f8f9fa;
    border-radius: 8px;
    border: 2px solid #e9ecef;
}

.category-selector-title {
    font-size: 14px;
    font-weight: 600;
    color: #495057;
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.category-buttons {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 8px;
    margin-bottom: 10px;
}

.category-btn {
    padding: 12px;
    border: 2px solid #dee2e6;
    background: white;
    border-radius: 8px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 500;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
}

.category-btn:hover {
    background: #f8f9fa;
    transform: translateY(-1px);
}

.category-btn.active {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-color: #667eea;
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
}

.category-btn.good { border-color: #28a745; }
.category-btn.good.active { background: linear-gradient(135deg, #28a745 0%, #20c997 100%); border-color: #28a745; }

.category-btn.more { border-color: #17a2b8; }
.category-btn.more.active { background: linear-gradient(135deg, #17a2b8 0%, #138496 100%); border-color: #17a2b8; }

.category-btn.worry { border-color: #ffc107; }
.category-btn.worry.active { background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%); border-color: #ffc107; color: white; }

.category-btn.task { border-color: #007bff; }
.category-btn.task.active { background: linear-gradient(135deg, #007bff 0%, #0056b3 100%); border-color: #007bff; }

.selected-category-display {
    padding: 8px 12px;
    background: white;
    border-radius: 6px;
    font-size: 13px;
    text-align: center;
    color: #6c757d;
    border: 1px solid #dee2e6;
}

.selected-category-display.has-selection {
    font-weight: 600;
    color: #495057;
}

/* Èü≥Â£∞ÂÖ•Âäõ„Éú„Çø„É≥„ÅÆ„Çπ„Çø„Ç§„É´Ë™øÊï¥ */
.voice-input-section {
    position: relative;
}

.category-required-hint {
    font-size: 12px;
    color: #dc3545;
    margin-top: 5px;
    display: none;
}

.category-required-hint.show {
    display: block;
}

        /* „ÅäÈáë„Çø„Éñ: ÂèéÂÖ•/ÊîØÂá∫„Çø„Éñ */
        .money-type-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .money-type-tab {
            flex: 1;
            padding: 15px;
            font-size: 16px;
            font-weight: bold;
            border: 2px solid #ddd;
            border-radius: 12px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .money-type-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
            transform: scale(1.05);
        }
        
        .money-categories {
            display: none;
            margin-bottom: 20px;
        }
        
        .money-categories.active {
            display: block;
        }
        
        .money-category-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .category-edit-button {
            width: 100%;
            padding: 12px;
            background: #f0f0f0;
            border: 2px dashed #999;
            border-radius: 10px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .category-edit-button:hover {
            background: #e0e0e0;
            border-color: #666;
        }

        /* ‰ªäÊó•„ÅÆ„Çø„Çπ„ÇØË°®Á§∫ */
        .today-tasks-section {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .today-tasks-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .today-tasks-header h3 {
            margin: 0;
            font-size: 18px;
            color: #333;
        }
        
        .refresh-tasks-button {
            padding: 8px 15px;
            background: white;
            border: 2px solid #667eea;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            color: #667eea;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .refresh-tasks-button:hover {
            background: #667eea;
            color: white;
            transform: scale(1.05);
        }
        
        .today-tasks-content {
            background: white;
            border-radius: 12px;
            padding: 15px;
        }
        
        .task-group {
            margin-bottom: 20px;
        }
        
        .task-group:last-child {
            margin-bottom: 0;
        }
        
        .task-group-title {
            font-weight: bold;
            font-size: 16px;
            color: #667eea;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 2px solid #667eea;
        }
        
        .task-item {
            display: flex;
            align-items: center;
            padding: 10px;
            margin-bottom: 8px;
            background: #f9f9f9;
            border-radius: 8px;
            transition: all 0.2s ease;
        }
        
        .task-item:hover {
            background: #f0f0f0;
        }
        
        .task-checkbox {
            width: 20px;
            height: 20px;
            margin-right: 12px;
            cursor: pointer;
        }
        
        .task-label {
            flex: 1;
            font-size: 15px;
            color: #333;
            cursor: pointer;
        }
        
        .task-checkbox:checked + .task-label {
            text-decoration: line-through;
            color: #999;
        }
        
        .loading-tasks,
        .no-tasks {
            text-align: center;
            color: #999;
            padding: 20px;
            font-size: 14px;
        }

        /* ÁõÆÊ®ô„ÅÆÊúàÈÅ∏Êäû */
        .month-selector-section {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 16px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .month-nav-button {
            padding: 10px 20px;
            background: white;
            border: 2px solid white;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            color: #667eea;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .month-nav-button:hover {
            background: #f0f0f0;
            transform: scale(1.05);
        }
        
        .current-month-display {
            font-size: 24px;
            font-weight: bold;
            color: white;
            min-width: 180px;
            text-align: center;
        }

        /* „Ç´„ÉÜ„Ç¥„É™Á∑®ÈõÜ„É¢„Éº„ÉÄ„É´ */
        .category-edit-list {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 20px;
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 10px;
        }
        
        .category-edit-item {
            display: flex;
            align-items: center;
            padding: 12px;
            background: #f9f9f9;
            border-radius: 8px;
            margin-bottom: 8px;
            transition: all 0.2s ease;
        }
        
        .category-edit-item:hover {
            background: #f0f0f0;
        }
        
        .category-edit-emoji {
            font-size: 24px;
            margin-right: 12px;
        }
        
        .category-edit-name {
            flex: 1;
            font-size: 16px;
            font-weight: 500;
        }
        
        .add-category-section {
            background: #f0f7ff;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .add-category-section h4 {
            margin: 0 0 12px 0;
            font-size: 16px;
            color: #333;
        }
        
        .form-row {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .input-field-small {
            width: 60px;
            padding: 10px;
            font-size: 20px;
            text-align: center;
            border: 2px solid #ddd;
            border-radius: 8px;
        }
        
        .btn-primary-small {
            padding: 10px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            white-space: nowrap;
        }
        
        .btn-primary-small:hover {
            transform: scale(1.05);
        }

        /* „É¨„Éù„Éº„ÉàÊ©üËÉΩ„ÅÆ„Çπ„Çø„Ç§„É´ */
        .report-type-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
        }
        
        .report-type-tab {
            flex: 1;
            padding: 15px;
            font-size: 18px;
            font-weight: bold;
            border: 2px solid #ddd;
            border-radius: 12px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .report-type-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
            transform: scale(1.05);
        }
        
        .report-content {
            display: none;
        }
        
        .report-content.active {
            display: block;
        }
        
        .report-month-selector {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 16px;
        }
        
        .month-nav-btn {
            padding: 10px 20px;
            background: white;
            border: 2px solid white;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            color: #667eea;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .month-nav-btn:hover {
            background: #f0f0f0;
            transform: scale(1.05);
        }
        
        .report-current-month {
            font-size: 24px;
            font-weight: bold;
            color: white;
            min-width: 180px;
            text-align: center;
        }
        
        /* „Ç´„É¨„É≥„ÉÄ„Éº */
        .report-calendar {
            margin-bottom: 30px;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            background: #f9f9f9;
            padding: 10px;
            border-radius: 12px;
        }
        
        .calendar-header {
            padding: 10px;
            text-align: center;
            font-weight: bold;
            background: #667eea;
            color: white;
            border-radius: 8px;
        }
        
        .calendar-day {
            aspect-ratio: 1;
            padding: 8px;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .calendar-day.empty {
            background: transparent;
            cursor: default;
        }
        
        .calendar-day.has-records {
            background: linear-gradient(135deg, #e0f7fa 0%, #b2ebf2 100%);
            border: 2px solid #00acc1;
        }
        
        .calendar-day.has-records:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .calendar-day-number {
            font-weight: bold;
            font-size: 16px;
        }
        
        .calendar-day-count {
            font-size: 12px;
            color: #00acc1;
            margin-top: 4px;
        }
        
        .calendar-day-balance {
            font-size: 11px;
            margin-top: 4px;
            font-weight: bold;
        }
        
        .calendar-day-balance.positive {
            color: #4caf50;
        }
        
        .calendar-day-balance.negative {
            color: #f44336;
        }
        
        /* Ê¶ÇË¶Å */
        .report-summary {
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 16px;
        }
        
        .report-summary h3 {
            margin: 0 0 15px 0;
        }
        
        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }
        
        .summary-stat-item {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .summary-stat-item.income {
            border-left: 4px solid #4caf50;
        }
        
        .summary-stat-item.expense {
            border-left: 4px solid #f44336;
        }
        
        .summary-stat-item.positive {
            border-left: 4px solid #4caf50;
        }
        
        .summary-stat-item.negative {
            border-left: 4px solid #f44336;
        }
        
        .summary-stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
        }
        
        .summary-stat-label {
            font-size: 14px;
            color: #666;
        }
        
        /* „Ç∞„É©„Éï */
        .report-chart-section {
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .report-chart-section h3 {
            margin: 0 0 15px 0;
        }
        
        /* Êó•Âà•Ë©≥Á¥∞ */
        .report-details {
            padding: 20px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .report-details h3 {
            margin: 0 0 15px 0;
        }
        
        .daily-detail-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .daily-detail-item {
            display: flex;
            gap: 15px;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }
        
        .daily-detail-item.income {
            border-left-color: #4caf50;
        }
        
        .daily-detail-item.expense {
            border-left-color: #f44336;
        }
        
        .daily-detail-time {
            font-size: 14px;
            color: #999;
            white-space: nowrap;
        }
        
        .daily-detail-content {
            flex: 1;
        }
        
        .daily-detail-category {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }
        
        .daily-detail-text {
            color: #333;
            margin-bottom: 5px;
        }
        
        .daily-detail-amount {
            font-weight: bold;
            font-size: 16px;
        }
        
        .daily-summary {
            padding: 12px;
            background: #f0f7ff;
            border-radius: 8px;
            margin-bottom: 15px;
            text-align: center;
            font-weight: bold;
        }

        /* „Ç∑„É≥„Éó„É´„Å™ÁôΩÈªí„Éì„Ç∏„Éç„Çπ„Éá„Ç∂„Ç§„É≥ */
        .simple-month-selector {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px;
            background: #ffffff;
            border: 2px solid #000000;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        
        .simple-nav-btn {
            padding: 10px 20px;
            background: #000000;
            color: #ffffff;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .simple-nav-btn:hover {
            background: #333333;
        }
        
        .simple-month-display {
            font-size: 24px;
            font-weight: 700;
            color: #000000;
        }
        
        /* „Ç´„É¨„É≥„ÉÄ„Éº */
        .simple-calendar {
            background: #ffffff;
            border: 2px solid #000000;
            border-radius: 4px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
        }
        
        .calendar-header {
            padding: 12px;
            text-align: center;
            font-weight: 700;
            background: #000000;
            color: #ffffff;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .calendar-day {
            min-height: 60px;
            padding: 8px;
            background: #ffffff;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .calendar-day.empty {
            background: #f5f5f5;
            border-color: #f5f5f5;
            cursor: default;
        }
        
        .calendar-day.has-records {
            background: #f9f9f9;
            border: 2px solid #000000;
        }
        
        .calendar-day.has-records:hover {
            background: #e8e8e8;
        }
        
        .calendar-day-number {
            font-weight: 700;
            font-size: 18px;
            color: #000000;
            margin-bottom: 4px;
        }
        
        .calendar-day-count {
            font-size: 12px;
            color: #666666;
            font-weight: 600;
        }
        
        .calendar-day-balance {
            font-size: 11px;
            font-weight: 700;
            margin-top: 4px;
        }
        
        .calendar-day-balance.positive {
            color: #000000;
        }
        
        .calendar-day-balance.negative {
            color: #666666;
        }
        
        /* Ê¶ÇË¶Å */
        .simple-summary {
            background: #ffffff;
            border: 2px solid #000000;
            border-radius: 4px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .simple-summary h3 {
            margin: 0 0 15px 0;
            font-size: 18px;
            font-weight: 700;
            color: #000000;
            border-bottom: 2px solid #000000;
            padding-bottom: 10px;
        }
        
        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }
        
        .summary-stat-item {
            background: #f9f9f9;
            border: 1px solid #000000;
            border-radius: 4px;
            padding: 15px;
            text-align: center;
        }
        
        .summary-stat-item.income {
            border-left: 4px solid #000000;
        }
        
        .summary-stat-item.expense {
            border-left: 4px solid #666666;
        }
        
        .summary-stat-value {
            font-size: 24px;
            font-weight: 700;
            color: #000000;
            margin-bottom: 8px;
        }
        
        .summary-stat-label {
            font-size: 14px;
            color: #666666;
            font-weight: 600;
        }
        
        /* „Ç∞„É©„Éï */
        .simple-chart {
            background: #ffffff;
            border: 2px solid #000000;
            border-radius: 4px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .simple-chart h3 {
            margin: 0 0 15px 0;
            font-size: 18px;
            font-weight: 700;
            color: #000000;
            border-bottom: 2px solid #000000;
            padding-bottom: 10px;
        }
        
        /* Êó•Âà•Ë©≥Á¥∞ */
        .simple-details {
            background: #ffffff;
            border: 2px solid #000000;
            border-radius: 4px;
            padding: 20px;
        }
        
        .simple-details h3 {
            margin: 0 0 15px 0;
            font-size: 18px;
            font-weight: 700;
            color: #000000;
            border-bottom: 2px solid #000000;
            padding-bottom: 10px;
        }
        
        .empty-message {
            text-align: center;
            color: #999999;
            padding: 30px;
            font-size: 14px;
        }
        
        .daily-detail-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .daily-detail-item {
            display: flex;
            gap: 15px;
            padding: 15px;
            background: #f9f9f9;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            border-left: 4px solid #000000;
        }
        
        .daily-detail-item.income {
            border-left-color: #000000;
        }
        
        .daily-detail-item.expense {
            border-left-color: #666666;
        }
        
        .daily-detail-time {
            font-size: 14px;
            color: #666666;
            font-weight: 600;
            white-space: nowrap;
        }
        
        .daily-detail-content {
            flex: 1;
        }
        
        .daily-detail-category {
            font-weight: 700;
            color: #000000;
            margin-bottom: 5px;
            font-size: 14px;
        }
        
        .daily-detail-text {
            color: #333333;
            margin-bottom: 5px;
            font-size: 14px;
        }
        
        .daily-detail-amount {
            font-weight: 700;
            font-size: 16px;
            color: #000000;
        }
        
        .daily-summary {
            padding: 15px;
            background: #f9f9f9;
            border: 1px solid #000000;
            border-radius: 4px;
            margin-bottom: 15px;
            text-align: center;
            font-weight: 700;
            color: #000000;
        }
/* ÁõÆÊ®ô„Ç´„Éº„Éâ„ÅÆ„Çπ„Çø„Ç§„É´ */
.goal-card {
    background: #ffffff;
    border: 2px solid #000000;
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 20px;
}

.goal-card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.goal-title {
    display: flex;
    align-items: center;
    gap: 8px;
}

.goal-emoji {
    font-size: 24px;
}

.goal-text {
    font-size: 18px;
    font-weight: bold;
    color: #000000;
}

.btn-icon-small {
    background: none;
    border: none;
    font-size: 18px;
    cursor: pointer;
    padding: 4px 8px;
}

.btn-icon-small:hover {
    opacity: 0.7;
}

/* ÈÄ≤Êçó„Éê„Éº */
.progress-bar-container {
    margin: 15px 0;
    padding: 15px;
    background: #f5f5f5;
    border-radius: 4px;
}

.progress-bar-visual {
    font-family: monospace;
    font-size: 20px;
    letter-spacing: 2px;
    color: #000000;
    margin-bottom: 8px;
}

.progress-bar-text {
    font-size: 14px;
    color: #666666;
    font-weight: bold;
}

/* ÈÄ≤ÊçóÂÖ•Âäõ„Çª„ÇØ„Ç∑„Éß„É≥ */
.progress-input-section {
    margin: 15px 0;
    padding: 15px;
    background: #fafafa;
    border: 1px solid #e0e0e0;
    border-radius: 4px;
}

.progress-input-row {
    display: flex;
    gap: 10px;
    align-items: center;
}

.level-select {
    width: 80px;
    padding: 8px;
    border: 2px solid #000000;
    border-radius: 4px;
    font-size: 14px;
    font-weight: bold;
    background: #ffffff;
}

.comment-input {
    flex: 1;
    padding: 8px 12px;
    border: 2px solid #000000;
    border-radius: 4px;
    font-size: 14px;
}

.comment-input:focus {
    outline: none;
    border-color: #333333;
}

.btn-record {
    padding: 8px 16px;
    background: #000000;
    color: #ffffff;
    border: none;
    border-radius: 4px;
    font-size: 18px;
    cursor: pointer;
    transition: background 0.2s;
}

.btn-record:hover {
    background: #333333;
}

/* ÈÄ≤ÊçóÂ±•Ê≠¥ */
.progress-history-details {
    margin-top: 15px;
}

.progress-history-summary {
    cursor: pointer;
    padding: 10px;
    background: #f0f0f0;
    border-radius: 4px;
    font-size: 14px;
    font-weight: bold;
    user-select: none;
}

.progress-history-summary:hover {
    background: #e5e5e5;
}

.progress-history-content {
    margin-top: 10px;
    padding: 10px;
    border-left: 3px solid #000000;
}

.progress-history-item {
    padding: 10px;
    margin-bottom: 10px;
    background: #ffffff;
    border: 1px solid #e0e0e0;
    border-radius: 4px;
}

.progress-history-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 5px;
}

.progress-level-badge {
    background: #000000;
    color: #ffffff;
    padding: 2px 8px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: bold;
}

.progress-date {
    font-size: 12px;
    color: #666666;
}

.progress-comment {
    font-size: 14px;
    color: #333333;
    margin-top: 5px;
}

.empty-state {
    text-align: center;
    padding: 40px 20px;
    color: #999999;
    font-size: 14px;
}
/* ÁõÆÊ®ô„Ç´„Éº„Éâ„ÅÆÈÄ≤Êçó„Éê„ÉºÂ∞ÇÁî®„Çπ„Çø„Ç§„É´ */
.goal-card .progress-bar-container {
    margin: 15px 0;
    padding: 15px;
    background: #f5f5f5;
    border-radius: 4px;
}

.goal-card .progress-bar-visual {
    font-family: monospace;
    font-size: 20px;
    letter-spacing: 2px;
    color: #000000;
    margin-bottom: 8px;
}

.goal-card .progress-bar-text {
    font-size: 14px;
    color: #666666;
    font-weight: bold;
}

/* ÁõÆÊ®ôËøΩÂä†„Éú„Çø„É≥ */
.btn-add-goal {
    display: block;
    width: 100%;
    padding: 12px 20px;
    background: #000000;
    color: #ffffff;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    transition: background 0.2s;
    margin-top: 10px;
}

.btn-add-goal:hover {
    background: #333333;
}

.btn-add-goal:active {
    background: #000000;
    transform: scale(0.98);
}
    </style>
</head>
<body>
    <div class="container">
        <h1>üìä „É©„Ç§„Éï„É≠„Ç∞ v34.4 - ÂÆåÂÖ®„Éá„Éê„ÉÉ„Ç∞Áâà</h1>
        
        <div class="tab-nav">
            <button class="tab-button active" onclick="switchTab('activity')">‚è±Ô∏è Ë°åÂãï</button>
            <button class="tab-button" onclick="switchTab('money')">üí∞ „ÅäÈáë</button>
            <button class="tab-button" onclick="switchTab('journal')">üìî „Ç∏„É£„Éº„Éä„É´</button>
            <button class="tab-button" onclick="switchTab('reportActivity')">üìä Ë°åÂãï„É¨„Éù„Éº„Éà</button>
            <button class="tab-button" onclick="switchTab('reportMoney')">üí∞ „ÅäÈáë„É¨„Éù„Éº„Éà</button>
            <button class="tab-button" onclick="switchTab('goals')">üéØ ÁõÆÊ®ô</button>
        </div>
        
        <!-- Ë°åÂãï„Çø„Éñ -->
        <div id="activity" class="tab-content active">
            
            <!-- ‰ªäÊó•„ÅÆ„Çø„Çπ„ÇØË°®Á§∫ -->
            <div class="today-tasks-section" id="todayTasksSection">
                <div class="today-tasks-header">
                    <h3>üìã ‰ªäÊó•„ÅÆ„Çø„Çπ„ÇØ</h3>
                    <button class="refresh-tasks-button" onclick="refreshTodayTasks()">üîÑ Êõ¥Êñ∞</button>
                </div>
                <div class="today-tasks-content" id="todayTasksContent">
                    <div class="loading-tasks">Êò®Êó•„ÅÆ„Ç∏„É£„Éº„Éä„É´„Åã„ÇâË™≠„ÅøËæº„Åø‰∏≠...</div>
                </div>
            </div>
            
            
            <!-- „Ç´„ÉÜ„Ç¥„É™ÈÅ∏Êäû -->
            <div class="category-selection-section" style="margin: 20px 0; padding: 20px; background: #f9f9f9; border-radius: 12px; border: 1px solid #e0e0e0;">
                <div style="font-weight: 600; margin-bottom: 15px; color: #000; text-align: center;">üìÇ „Ç´„ÉÜ„Ç¥„É™„ÇíÈÅ∏Êäû</div>
                <div class="category-buttons" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 10px;">
                    <button class="category-btn" onclick="selectActivityCategory('ÈÅãÂãï')" data-category="ÈÅãÂãï" style="padding: 12px; background: white; border: 2px solid #ddd; border-radius: 8px; cursor: pointer; transition: all 0.3s;">
                        üèÉ ÈÅãÂãï
                    </button>
                    <button class="category-btn" onclick="selectActivityCategory('Ë™≠Êõ∏')" data-category="Ë™≠Êõ∏">
                        üìö Ë™≠Êõ∏
                    </button>
                    <button class="category-btn" onclick="selectActivityCategory('‰ªï‰∫ã')" data-category="‰ªï‰∫ã">
                        üíº ‰ªï‰∫ã
                    </button>
                    <button class="category-btn" onclick="selectActivityCategory('ÂãâÂº∑')" data-category="ÂãâÂº∑">
                        üìñ ÂãâÂº∑
                    </button>
                    <button class="category-btn" onclick="selectActivityCategory('Ë∂£Âë≥')" data-category="Ë∂£Âë≥">
                        üé® Ë∂£Âë≥
                    </button>
                    <button class="category-btn" onclick="selectActivityCategory('ÂÆ∂‰∫ã')" data-category="ÂÆ∂‰∫ã">
                        üè† ÂÆ∂‰∫ã
                    </button>
                    <button class="category-btn" onclick="selectActivityCategory('È£ü‰∫ã')" data-category="È£ü‰∫ã">
                        üçΩÔ∏è È£ü‰∫ã
                    </button>
                    <button class="category-btn" onclick="selectActivityCategory('Áù°Áú†')" data-category="Áù°Áú†">
                        üò¥ Áù°Áú†
                    </button>
                    <button class="category-btn" onclick="selectActivityCategory('ÁßªÂãï')" data-category="ÁßªÂãï">
                        üöó ÁßªÂãï
                    </button>
                    <button class="category-btn" onclick="selectActivityCategory('„Åù„ÅÆ‰ªñ')" data-category="„Åù„ÅÆ‰ªñ">
                        üìù „Åù„ÅÆ‰ªñ
                    </button>
                </div>
                <div id="selectedActivityCategory" style="margin-top: 15px; padding: 10px; background: white; border-radius: 8px; text-align: center; color: #666;">
                    „Ç´„ÉÜ„Ç¥„É™„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ
                </div>
            </div>
            
            <!-- Ë©≥Á¥∞ÂÖ•Âäõ -->
            <input type="text" id="activityDetailInput" class="text-input" placeholder="Ë©≥Á¥∞„ÇíÂÖ•ÂäõÔºà‰æãÔºö„Ç∏„É†„Åß1ÊôÇÈñìÔºâ" style="margin-top: 10px;">
            
            <button id="activityVoiceButton" class="voice-button">üé§ Èü≥Â£∞ÂÖ•Âäõ„ÅßË®òÈå≤</button>
            
            <div id="activityQuickButtons" class="quick-buttons"></div>
            
            <input type="text" id="activityInput" class="text-input" placeholder="Ê¥ªÂãïÂÜÖÂÆπ„ÇíÂÖ•Âäõ...">
            
            <!-- ÊôÇÈñìË®òÈå≤Ê©üËÉΩ -->
            <div class="time-input-section" style="margin-top: 15px; padding: 15px; background: #f9f9f9; border-radius: 12px;">
                <div style="font-weight: 600; margin-bottom: 10px; color: #000;">‚è±Ô∏è ÊôÇÈñì„ÇíË®òÈå≤</div>
                
                <!-- „Ç∑„É≥„Éó„É´: Ë®òÈå≤„Éú„Çø„É≥„ÇíÊäº„Åô„Å†„Åë -->
                <div style="text-align: center; color: #666; font-size: 0.9em; margin-bottom: 10px;">
                    ‚Äª Ë®òÈå≤„Éú„Çø„É≥„ÅßÈñãÂßã„ÄÅ„É≠„Ç∞„ÅÆÁµÇ‰∫Ü„Éú„Çø„É≥„ÅßÁµÇ‰∫Ü
                </div>
            </div>
            
            <button class="add-button" onclick="addActivity()">‚ûï Ë®òÈå≤</button>
            <div id="activityStatus" class="status"></div>
            
            <div class="logs-section">
                <div class="section-title">
                    <span>‰ªäÊó•„ÅÆË°åÂãï</span>
                    <button class="manage-button" onclick="openCategoryManager()">‚öôÔ∏è „Ç´„ÉÜ„Ç¥„É™ÁÆ°ÁêÜ</button>
                </div>
                <div id="activityLogs"></div>
            </div>
        </div>
        <!-- „ÅäÈáë„Çø„Éñ -->
        <div id="money" class="tab-content">
            
            <!-- ÂèéÂÖ•/ÊîØÂá∫„Çø„Éñ -->
            <div class="money-type-tabs">
                <button class="money-type-tab active" onclick="switchMoneyType('expense')" data-type="expense">
                    üí∏ ÊîØÂá∫
                </button>
                <button class="money-type-tab" onclick="switchMoneyType('income')" data-type="income">
                    üí∞ ÂèéÂÖ•
                </button>
            </div>
            
            <!-- ÊîØÂá∫„Ç´„ÉÜ„Ç¥„É™ -->
            <div id="expenseCategories" class="money-categories active">
                <div class="category-selector-title">üìä ÊîØÂá∫„Ç´„ÉÜ„Ç¥„É™„ÇíÈÅ∏Êäû:</div>
                <div class="category-buttons money-category-buttons">
                    <button class="category-btn" onclick="selectMoneyCategory('È£üË≤ª')" data-category="È£üË≤ª">üçΩÔ∏è È£üË≤ª</button>
                    <button class="category-btn" onclick="selectMoneyCategory('Êó•Áî®ÂìÅ')" data-category="Êó•Áî®ÂìÅ">üß¥ Êó•Áî®ÂìÅ</button>
                    <button class="category-btn" onclick="selectMoneyCategory('Ë°£Êúç')" data-category="Ë°£Êúç">üëï Ë°£Êúç</button>
                    <button class="category-btn" onclick="selectMoneyCategory('ÁæéÂÆπ')" data-category="ÁæéÂÆπ">üíÑ ÁæéÂÆπ</button>
                    <button class="category-btn" onclick="selectMoneyCategory('‰∫§ÈöõË≤ª')" data-category="‰∫§ÈöõË≤ª">ü§ù ‰∫§ÈöõË≤ª</button>
                    <button class="category-btn" onclick="selectMoneyCategory('ÂåªÁôÇË≤ª')" data-category="ÂåªÁôÇË≤ª">‚öïÔ∏è ÂåªÁôÇË≤ª</button>
                    <button class="category-btn" onclick="selectMoneyCategory('ÊïôËÇ≤Ë≤ª')" data-category="ÊïôËÇ≤Ë≤ª">üìö ÊïôËÇ≤Ë≤ª</button>
                    <button class="category-btn" onclick="selectMoneyCategory('ÂÖâÁÜ±Ë≤ª')" data-category="ÂÖâÁÜ±Ë≤ª">üí° ÂÖâÁÜ±Ë≤ª</button>
                    <button class="category-btn" onclick="selectMoneyCategory('‰∫§ÈÄöË≤ª')" data-category="‰∫§ÈÄöË≤ª">üöÉ ‰∫§ÈÄöË≤ª</button>
                    <button class="category-btn" onclick="selectMoneyCategory('Â®ØÊ•Ω')" data-category="Â®ØÊ•Ω">üéÆ Â®ØÊ•Ω</button>
                </div>
                <button class="category-edit-button" onclick="editMoneyCategories('expense')">‚úèÔ∏è „Ç´„ÉÜ„Ç¥„É™Á∑®ÈõÜ</button>
            </div>
            
            <!-- ÂèéÂÖ•„Ç´„ÉÜ„Ç¥„É™ -->
            <div id="incomeCategories" class="money-categories">
                <div class="category-selector-title">üí∞ ÂèéÂÖ•„Ç´„ÉÜ„Ç¥„É™„ÇíÈÅ∏Êäû:</div>
                <div class="category-buttons money-category-buttons">
                    <button class="category-btn" onclick="selectMoneyCategory('Áµ¶Êñô')" data-category="Áµ¶Êñô">üíº Áµ¶Êñô</button>
                    <button class="category-btn" onclick="selectMoneyCategory('„Åä„Åì„Å•„Åã„ÅÑ')" data-category="„Åä„Åì„Å•„Åã„ÅÑ">üíµ „Åä„Åì„Å•„Åã„ÅÑ</button>
                    <button class="category-btn" onclick="selectMoneyCategory('Ë≥û‰∏é')" data-category="Ë≥û‰∏é">üéÅ Ë≥û‰∏é</button>
                    <button class="category-btn" onclick="selectMoneyCategory('ÂâØÊ•≠')" data-category="ÂâØÊ•≠">üíª ÂâØÊ•≠</button>
                    <button class="category-btn" onclick="selectMoneyCategory('ÊäïË≥á')" data-category="ÊäïË≥á">üìà ÊäïË≥á</button>
                    <button class="category-btn" onclick="selectMoneyCategory('Ëá®ÊôÇÂèéÂÖ•')" data-category="Ëá®ÊôÇÂèéÂÖ•">üéâ Ëá®ÊôÇÂèéÂÖ•</button>
                </div>
                <button class="category-edit-button" onclick="editMoneyCategories('income')">‚úèÔ∏è „Ç´„ÉÜ„Ç¥„É™Á∑®ÈõÜ</button>
            </div>
            
            <div class="selected-category-display" id="selectedMoneyCategory">
                „Ç´„ÉÜ„Ç¥„É™„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ
            </div>
            
            <!-- ÂÖ•ÂäõÊ¨Ñ -->
            <input type="text" id="moneyInput" class="text-input" placeholder="„É°„É¢Ôºà‰æãÔºö„É©„É≥„ÉÅ‰ª£Ôºâ">
            <input type="number" id="moneyAmount" class="text-input" placeholder="ÈáëÈ°çÔºàÂÜÜÔºâ">
            <button class="add-button" onclick="addMoney()">‚ûï Ë®òÈå≤</button>
            <div id="moneyStatus" class="status"></div>
            
            <div class="logs-section">
                <h2 class="section-title">‰ªäÊó•„ÅÆ„ÅäÈáë</h2>
                <div id="moneyLogs"></div>
            </div>
        </div>
        <!-- „Ç∏„É£„Éº„Éä„É´„Çø„Éñ -->
        <div id="journal" class="tab-content journal-tab">
<!-- „Ç´„ÉÜ„Ç¥„É™ÈÅ∏ÊäûUIÔºà„Ç∏„É£„Éº„Éä„É´„ÅÆÈü≥Â£∞ÂÖ•ÂäõÂâç„Å´ÈÖçÁΩÆÔºâ -->
<div class="category-selector">
            <div style="display: none;">
    <div class="category-selector-title">
        üéØ Èü≥Â£∞ÂÖ•Âäõ„Åô„Çã„Ç´„ÉÜ„Ç¥„É™„ÇíÈÅ∏Êäû:
    </div></div>
    <div class="category-buttons">
        <button class="category-btn good" onclick="selectJournalCategory('good')" data-category="good">
            üòä ËâØ„Åã„Å£„Åü„Åì„Å®
        </button>
        <button class="category-btn more" onclick="selectJournalCategory('more')" data-category="more">
            üìà „ÇÇ„Å£„Å®„Åß„Åç„Çã„Åì„Å®
        </button>
        <button class="category-btn worry" onclick="selectJournalCategory('worry')" data-category="worry">
            üòü ÊÇ©„Çì„Åß„ÅÑ„Çã„Åì„Å®
        </button>
        <button class="category-btn task-must" onclick="selectJournalCategory('taskMust')" data-category="taskMust">
            ‚úÖ Must: „ÇÑ„Çâ„Å™„Åç„ÇÉ„ÅÑ„Åë„Å™„ÅÑ„Åì„Å®
        </button>
        <button class="category-btn task-want" onclick="selectJournalCategory('taskWant')" data-category="taskWant">
            üí° Want: „ÇÑ„Çä„Åü„ÅÑ„Åì„Å®
        </button>
    </div>
    <div class="selected-category-display" id="selectedCategoryDisplay">
        „Ç´„ÉÜ„Ç¥„É™„ÇíÈÅ∏Êäû„Åó„Å¶„Åã„ÇâÈü≥Â£∞ÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ
    </div>
    <div class="category-required-hint" id="categoryRequiredHint">
        ‚ö†Ô∏è „Ç´„ÉÜ„Ç¥„É™„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ
    </div>
</div>
            <!-- üé§ Èü≥Â£∞ÂÖ•Âäõ„Éú„Çø„É≥ -->
            <button id="journalVoiceButton" class="voice-button" onclick="startJournalVoice()" style="width: 100%; padding: 16px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 12px; font-size: 16px; font-weight: bold; cursor: pointer; margin: 16px 0; transition: all 0.3s;">
                üé§ Èü≥Â£∞ÂÖ•Âäõ
            </button>
            
            <!-- Ê∞óÂàÜÈÅ∏Êäû -->
            <div class="mood-selector">
                <div class="mood-selector-title">‰ªäÊó•„ÅÆÊ∞óÂàÜ„ÇíÈÅ∏„Çì„Åß„Åè„Å†„Åï„ÅÑ</div>
                <div class="mood-buttons">
                    <button class="mood-button" onclick="selectMood('great')" data-mood="great">
                        <span class="mood-emoji">üòä</span>
                        <span class="mood-label">ÊúÄÈ´ò</span>
                    </button>
                    <button class="mood-button" onclick="selectMood('good')" data-mood="good">
                        <span class="mood-emoji">üôÇ</span>
                        <span class="mood-label">ËâØ„ÅÑ</span>
                    </button>
                    <button class="mood-button" onclick="selectMood('normal')" data-mood="normal">
                        <span class="mood-emoji">üòê</span>
                        <span class="mood-label">ÊôÆÈÄö</span>
                    </button>
                    <button class="mood-button" onclick="selectMood('bad')" data-mood="bad">
                        <span class="mood-emoji">üòî</span>
                        <span class="mood-label">ÊÇ™„ÅÑ</span>
                    </button>
                    <button class="mood-button" onclick="selectMood('terrible')" data-mood="terrible">
                        <span class="mood-emoji">üò¢</span>
                        <span class="mood-label">ÊúÄÊÇ™</span>
                    </button>
                </div>
            </div>
            
            
            <!-- Êó•‰ªòÈÅ∏Êäû -->
            <div style="margin: 15px 0; padding: 15px; background: #f9f9f9; border-radius: 12px;">
                <label style="display: block; margin-bottom: 5px; font-weight: 600;">üìÖ Ë®òÈå≤„Åô„ÇãÊó•‰ªò„ÇíÈÅ∏Êäû</label>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <input type="date" id="journalDate" style="flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 1em;">
                    <button type="button" onclick="setJournalDateToToday()" style="padding: 10px 15px; background: #4CAF50; color: white; border: none; border-radius: 8px; cursor: pointer; white-space: nowrap;">‰ªäÊó•</button>
                </div>
                <div style="margin-top: 5px; font-size: 0.9em; color: #666;">
                    ‚Äª ÈÅéÂéª„ÅÆÊó•‰ªò„ÇíÈÅ∏Êäû„Åó„Å¶„ÄÅÈÅ°„Å£„Å¶Ë®òÈå≤„Åß„Åç„Åæ„Åô
                </div>
            </div>
            <textarea id="journalInput" class="text-input" placeholder="‰ªäÊó•„ÅÆÊåØ„ÇäËøî„Çä„ÇíÊõ∏„Åç„Åæ„Åó„Çá„ÅÜ...&#10;&#10;‰æãÔºö&#10;Êúù„Åã„Çâ„Ç∏„É†„Å´Ë°å„Å£„Å¶Ê∞óÊåÅ„Å°„Çà„ÅèÊ±ó„ÇíÊµÅ„Åó„Åü„ÄÇ&#10;ÂçàÂæå„ÅØÈõÜ‰∏≠„Åó„Å¶‰ªï‰∫ã„Åå„Åß„Åç„Åü„ÄÇ&#10;ÊòéÊó•„ÅØÊó©Ëµ∑„Åç„Åó„Å¶Êñ∞„Åó„ÅÑ„Éó„É≠„Ç∏„Çß„ÇØ„Éà„Å´Âèñ„ÇäÁµÑ„ÇÇ„ÅÜ„ÄÇ"></textarea>
            
            <!-- Ëá™ÂãïË¶ÅÁ¥Ñ„Çª„ÇØ„Ç∑„Éß„É≥ -->
            <div id="summarySection" class="summary-section">
                <h3 style="margin-bottom: 15px;">üìù Ëá™ÂãïË¶ÅÁ¥Ñ</h3>
                
                <div class="summary-item">
                    <div class="summary-label">üòä GoodÔºàËâØ„Åã„Å£„Åü„Åì„Å®Ôºâ</div>
                    <div id="summaryGood" class="summary-content"></div>
                    <div id="commentGood" class="ai-comment"></div>
                </div>
                
                <div class="summary-item">
                    <div class="summary-label">üìà MoreÔºà„ÇÇ„Å£„Å®ËâØ„Åè„Åß„Åç„Çã„Åì„Å®Ôºâ</div>
                    <div id="summaryMore" class="summary-content"></div>
                    <div id="commentMore" class="ai-comment"></div>
                </div>
                
                <div class="summary-item">
                    <div class="summary-label">ü§î ÊÇ©„Çì„Åß„ÅÑ„Çã„Åì„Å®</div>
                    <div id="summaryWorry" class="summary-content"></div>
                    <div id="commentWorry" class="ai-comment"></div>
                </div>
                
                <div class="summary-item">
                    <div class="summary-label">‚úÖ Must: „ÇÑ„Çâ„Å™„Åç„ÇÉ„ÅÑ„Åë„Å™„ÅÑ„Åì„Å®</div>
                    <div id="summaryTaskMust" class="summary-content"></div>
                    <div id="commentTaskMust" class="ai-comment"></div>
                </div>
                
                <div class="summary-item">
                    <div class="summary-label">üí° Want: „ÇÑ„Çä„Åü„ÅÑ„Åì„Å®</div>
                    <div id="summaryTaskWant" class="summary-content"></div>
                    <div id="commentTaskWant" class="ai-comment"></div>
                </div>
            </div>
            
            <button class="add-button" onclick="saveJournalWithAI()">üìù ‰øùÂ≠ò</button>
            <div id="journalStatus" class="status"></div>
            
            <div class="logs-section">
                <h2 class="section-title">üìÖ ÊúàÈñì„Ç´„É¨„É≥„ÉÄ„Éº</h2>
                <div class="calendar">
                    <div class="calendar-header">
                        <button class="calendar-nav" onclick="changeMonth(-1)">‚óÄ ÂâçÊúà</button>
                        <span id="calendarMonth" style="font-weight: 600;"></span>
                        <button class="calendar-nav" onclick="changeMonth(1)">Ê¨°Êúà ‚ñ∂</button>
                    </div>
                    <div id="calendar" class="calendar-grid"></div>
                </div>
                
                <h2 class="section-title" style="margin-top: 30px;">„Ç∏„É£„Éº„Éä„É´Â±•Ê≠¥</h2>
                <div id="journalLogs"></div>
            </div>
        </div>
        
<!-- ‰ªäÊúà„ÅÆÁõÆÊ®ô„Çø„Éñ -->
<div id="goals" class="tab-content">
    <h2 class="section-title">üéØ ÁõÆÊ®ôÁÆ°ÁêÜ</h2>
    
    <!-- ÊúàÈÅ∏Êäû -->
    <div class="month-selector-section">
        <button class="month-nav-button" onclick="changeGoalsMonth(-1)">‚óÄ ÂâçÊúà</button>
        <div class="current-month-display" id="currentGoalsMonth">2026Âπ¥1Êúà</div>
        <button class="month-nav-button" onclick="changeGoalsMonth(1)">Ê¨°Êúà ‚ñ∂</button>
    </div>
    
    <div class="goals-section">
        <div class="form-group">
            <label>Êñ∞„Åó„ÅÑÁõÆÊ®ô„ÇíËøΩÂä†</label>
            <input type="text" id="goalInput" class="input-field" placeholder="‰æã: ÊØéÊó•30ÂàÜÈÅãÂãï„Åô„Çã" />
        </div>
        
        <div class="form-group">
            <label>„Ç´„ÉÜ„Ç¥„É™</label>
            <select id="goalCategory" class="input-field">
                <option value="ÂÅ•Â∫∑">üí™ ÂÅ•Â∫∑</option>
                <option value="‰ªï‰∫ã">üíº ‰ªï‰∫ã</option>
                <option value="ÂãâÂº∑">üìö ÂãâÂº∑</option>
                <option value="Ë∂£Âë≥">üé® Ë∂£Âë≥</option>
                <option value="‰∫∫ÈñìÈñ¢‰øÇ">üë• ‰∫∫ÈñìÈñ¢‰øÇ</option>
                <option value="„ÅäÈáë">üí∞ „ÅäÈáë</option>
                <option value="„Åù„ÅÆ‰ªñ">üìå „Åù„ÅÆ‰ªñ</option>
            </select>
        </div>
        
        <button class="btn-add-goal" onclick="addGoal()">‚ûï ÁõÆÊ®ô„ÇíËøΩÂä†</button>
        <div id="goalStatus" class="status-message"></div>
    </div>
    
    <div class="goals-list-section">
        <h3 id="goalsListTitle">‰ªäÊúà„ÅÆÁõÆÊ®ô„É™„Çπ„Éà</h3>
        <div id="goalsList"></div>
    </div>
    
    <div class="goals-progress-section">
        <h3>üìä ÈÅîÊàêÁä∂Ê≥Å</h3>
        <div id="goalsProgress"></div>
    </div>
    
    <div class="goals-feedback-section">
        <h3>ü§ñ AI „Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ</h3>
        <div id="goalsFeedback" class="ai-feedback-box">
            ÁõÆÊ®ô„ÇíË®≠ÂÆö„Åô„Çã„Å®„ÄÅAI„Åå„ÅÇ„Å™„Åü„ÅÆË°åÂãïË®òÈå≤„Å®„Ç∏„É£„Éº„Éä„É´„ÇíÂàÜÊûê„Åó„Å¶„ÄÅÈÅîÊàê„Å´Âêë„Åë„Åü„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ„ÇíÊèê‰æõ„Åó„Åæ„Åô„ÄÇ
        </div>
        <button class="btn-secondary" onclick="generateGoalsFeedback()">üîÑ „Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ„ÇíÊõ¥Êñ∞</button>
    </div>
</div>
        <!-- Ë°åÂãï„É¨„Éù„Éº„Éà„Çø„Éñ -->
        <div id="reportActivity" class="tab-content">
            <h2 class="section-title">üìä Ë°åÂãï„É¨„Éù„Éº„Éà</h2>
            
            <!-- ÊúàÈÅ∏Êäû -->
            <div class="simple-month-selector">
                <button class="simple-nav-btn" onclick="changeReportMonth('activity', -1)">‚óÄ ÂâçÊúà</button>
                <div class="simple-month-display" id="activityReportMonthDisplay">2026Âπ¥1Êúà</div>
                <button class="simple-nav-btn" onclick="changeReportMonth('activity', 1)">Ê¨°Êúà ‚ñ∂</button>
            </div>
            
            <!-- „Ç´„É¨„É≥„ÉÄ„Éº -->
            <div class="simple-calendar" id="activityCalendar"></div>
            
            <!-- Ê¶ÇË¶Å -->
            <div class="simple-summary">
                <h3>üìã ÊúàÈñìÊ¶ÇË¶Å</h3>
                <div id="activitySummary"></div>
            </div>
            
            <!-- Êó•Âà•Ë©≥Á¥∞ -->
            <div class="simple-details">
                <h3>üìÖ Êó•Âà•Ë©≥Á¥∞</h3>
                <div id="activityDailyDetails">
                    <p class="empty-message">„Ç´„É¨„É≥„ÉÄ„Éº„ÅÆÊó•‰ªò„Çí„Çø„ÉÉ„Éó„Åó„Å¶Ë©≥Á¥∞„ÇíË°®Á§∫</p>
                </div>
            </div>
        </div>
        
        <!-- „ÅäÈáë„É¨„Éù„Éº„Éà„Çø„Éñ -->
        <div id="reportMoney" class="tab-content">
            <h2 class="section-title">üí∞ „ÅäÈáë„É¨„Éù„Éº„Éà</h2>
            
            <!-- ÊúàÈÅ∏Êäû -->
            <div class="simple-month-selector">
                <button class="simple-nav-btn" onclick="changeReportMonth('money', -1)">‚óÄ ÂâçÊúà</button>
                <div class="simple-month-display" id="moneyReportMonthDisplay">2026Âπ¥1Êúà</div>
                <button class="simple-nav-btn" onclick="changeReportMonth('money', 1)">Ê¨°Êúà ‚ñ∂</button>
            </div>
            
            <!-- „Ç´„É¨„É≥„ÉÄ„Éº -->
            <div class="simple-calendar" id="moneyCalendar"></div>
            
            <!-- Ê¶ÇË¶Å -->
            <div class="simple-summary">
                <h3>üí∞ ÊúàÈñìÊ¶ÇË¶Å</h3>
                <div id="moneySummary"></div>
            </div>
            
            <!-- ÂÜÜ„Ç∞„É©„Éï -->
            <div class="simple-chart">
                <h3>üìä ÊîØÂá∫ÂÜÖË®≥</h3>
                <canvas id="moneyPieChart" width="400" height="400"></canvas>
            </div>
            
            <!-- Êó•Âà•Ë©≥Á¥∞ -->
            <div class="simple-details">
                <h3>üìÖ Êó•Âà•Ë©≥Á¥∞</h3>
                <div id="moneyDailyDetails">
                    <p class="empty-message">„Ç´„É¨„É≥„ÉÄ„Éº„ÅÆÊó•‰ªò„Çí„Çø„ÉÉ„Éó„Åó„Å¶Ë©≥Á¥∞„ÇíË°®Á§∫</p>
                </div>
            </div>
        </div>
    <!-- „Ç´„ÉÜ„Ç¥„É™ÁÆ°ÁêÜ„É¢„Éº„ÉÄ„É´ -->
    <div id="categoryModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeCategoryManager()">&times;</span>
            <h2 class="modal-title">‚öôÔ∏è „Ç´„ÉÜ„Ç¥„É™ÁÆ°ÁêÜ</h2>
            
            <div style="margin-bottom: 20px;">
                <input type="text" id="newCategoryName" class="text-input" placeholder="Êñ∞„Åó„ÅÑ„Ç´„ÉÜ„Ç¥„É™ÂêçÔºà‰æãÔºöË™≠Êõ∏Ôºâ">
                <input type="text" id="newCategoryEmoji" class="text-input" placeholder="ÁµµÊñáÂ≠óÔºà‰æãÔºöüìñÔºâ">
                <button class="add-button" onclick="addCategory()">‚ûï ËøΩÂä†</button>
            </div>
            
            <h3 style="margin-bottom: 10px;">ÁèæÂú®„ÅÆ„Ç´„ÉÜ„Ç¥„É™</h3>
            <div id="categoryList"></div>
        </div>
    </div>
    
    <script>
        // „Éá„Éº„ÇøÊ†ºÁ¥ç
        let activities = JSON.parse(localStorage.getItem('activities') || '[]');
        window.moneyRecords = JSON.parse(localStorage.getItem('moneyRecords') || '[]');
        let weightRecords = JSON.parse(localStorage.getItem('weightRecords') || '[]');
        let journals = JSON.parse(localStorage.getItem('journals') || '[]');
        
        // „Ç´„Çπ„Çø„É†„Ç´„ÉÜ„Ç¥„É™
        let activityCategories = JSON.parse(localStorage.getItem('activityCategories') || JSON.stringify([
            { name: '‰ªï‰∫ã', emoji: 'üíº' },
            { name: 'ÂãâÂº∑', emoji: 'üìö' },
            { name: 'ÈÅãÂãï', emoji: 'üèÉ' },
            { name: 'È£ü‰∫ã', emoji: 'üçΩÔ∏è' },
            { name: 'Áù°Áú†', emoji: 'üò¥' },
            { name: 'Ë™≠Êõ∏', emoji: 'üìñ' },
            { name: 'ÂÆ∂‰∫ã', emoji: 'üßπ' },
            { name: 'Ë∂£Âë≥', emoji: 'üé®' }
        ]));
        
        // „Ç´„É¨„É≥„ÉÄ„ÉºÁî®
        let currentCalendarDate = new Date();
        
        // ÁèæÂú®ÈÅ∏Êäû„Åï„Çå„Å¶„ÅÑ„ÇãÊ∞óÂàÜ
        let selectedMood = 'normal';
        
        // ÁèæÂú®ÈÅ∏Êäû„Åï„Çå„Å¶„ÅÑ„Çã„Ç´„ÉÜ„Ç¥„É™
        let selectedCategory = null;
        let selectedCategoryEmoji = null;
        
        // „Çø„Ç§„Éû„ÉºÈñ¢ÈÄ£
        let timerStartTime = null;
        let timerInterval = null;
        let timerRunning = false;
        let timerElapsedSeconds = 0;
        
        // Ê∞óÂàÜ„ÅÆÁµµÊñáÂ≠ó„Éû„ÉÉ„Éî„É≥„Ç∞
        const moodEmojis = {
            great: 'üòä',
            good: 'üôÇ',
            normal: 'üòê',
            bad: 'üòî',
            terrible: 'üò¢'
        };
        
        // Ê∞óÂàÜÈÅ∏Êäû
        function selectMood(mood) {
            selectedMood = mood;
            
            // „Éú„Çø„É≥„ÅÆÈÅ∏ÊäûÁä∂ÊÖã„ÇíÊõ¥Êñ∞
            document.querySelectorAll('.mood-button').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            const selectedButton = document.querySelector(`.mood-button[data-mood="${mood}"]`);
            if (selectedButton) {
                selectedButton.classList.add('selected');
            }
        }
        
        // „Çø„ÉñÂàá„ÇäÊõø„Åà
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
            console.log("switchTab called:", tabName);
                tab.classList.remove('active');
            });
            console.log("Active classes removed");
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            const tabElement = document.getElementById(tabName);
            if (tabElement) {
                tabElement.classList.add('active');
            console.log("Tab element:", tabElement, "Active:", tabElement?.classList.contains("active"));
            }
            
            // „ÇØ„É™„ÉÉ„ÇØ„Åï„Çå„Åü„Éú„Çø„É≥„ÇíÊé¢„Åó„Å¶active„Å´
            setTimeout(() => {
                const activeButton = document.querySelector(`.tab-button[onclick*="'${tabName}'"]`);
                if (activeButton) {
                    activeButton.classList.add('active');
                }
            }, 0);
            
            if (tabName === 'journal') {
                renderCalendar();
            } else if (tabName === 'reportActivity') {
                renderActivityReport();
            } else if (tabName === 'reportMoney') {
                renderMoneyReport();
            }
        }
        
        // „ÇØ„Ç§„ÉÉ„ÇØ„Éú„Çø„É≥„ÇíÂãïÁöÑÁîüÊàê
        function renderActivityQuickButtons() {
            const container = document.getElementById('activityQuickButtons');
            container.innerHTML = activityCategories.map(cat => 
                `<button class="quick-button" data-category="${cat.name}" data-emoji="${cat.emoji}" onclick="selectCategory('${cat.name}', '${cat.emoji}')">${cat.emoji} ${cat.name}</button>`
            ).join('');
        }
        
        // „Ç´„ÉÜ„Ç¥„É™ÈÅ∏ÊäûÔºà„ÇØ„Ç§„ÉÉ„ÇØ„Éú„Çø„É≥Ôºâ
        function selectCategory(categoryName, categoryEmoji) {
            selectedCategory = categoryName;
            selectedCategoryEmoji = categoryEmoji;
            
            // „Éú„Çø„É≥„ÅÆÈÅ∏ÊäûÁä∂ÊÖã„ÇíÊõ¥Êñ∞
            document.querySelectorAll('.quick-button').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            const selectedButton = document.querySelector(`.quick-button[data-category="${categoryName}"]`);
            if (selectedButton) {
                selectedButton.classList.add('selected');
            }
            
            // ÂÖ•ÂäõÊ¨Ñ„Å´„Éï„Ç©„Éº„Ç´„Çπ
            document.getElementById('activityInput').focus();
        }
        
        // „ÇØ„Ç§„ÉÉ„ÇØËøΩÂä†Ôºö„ÅäÈáë
        function quickAddMoney(category, amount) {
            document.getElementById('moneyInput').value = category;
            document.getElementById('moneyAmount').value = Math.abs(amount);
            addMoney();
        }
        
        // Ë°åÂãï„ÇíË®òÈå≤
        function addActivity() {
            const text = document.getElementById('activityInput').value.trim();
            
            // „Ç´„ÉÜ„Ç¥„É™ÈÅ∏Êäû„ÉÅ„Çß„ÉÉ„ÇØÔºà„ÇØ„Ç§„ÉÉ„ÇØ„Éú„Çø„É≥ÊñπÂºèÔºâ
            if (!selectedCategory) {
                alert('‚ùå „Ç´„ÉÜ„Ç¥„É™„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
            
            if (!text) {
                alert('‚ùå ÂÜÖÂÆπ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
            
            // Êñ∞„Åó„ÅÑË®òÈå≤„Çí‰ΩúÊàêÔºàÈñãÂßãÊôÇÂàª„ÅÆ„ÅøÔºâ
            const activity = {
                id: Date.now(),
                text: text,
                category: selectedCategory,
                categoryEmoji: selectedCategoryEmoji,
                startTime: new Date().toISOString(),
                endTime: null,  // Á∂ôÁ∂ö‰∏≠
                timestamp: new Date().toISOString()
            };
            
            activities.unshift(activity);
            localStorage.setItem('activities', JSON.stringify(activities));
            
            // ÂÖ•ÂäõÊ¨Ñ„Çí„ÇØ„É™„Ç¢
            document.getElementById('activityInput').value = '';
            
            // „Ç´„ÉÜ„Ç¥„É™ÈÅ∏Êäû„Çí„É™„Çª„ÉÉ„Éà
            selectedCategory = null;
            selectedCategoryEmoji = null;
            
            // „ÇØ„Ç§„ÉÉ„ÇØ„Éú„Çø„É≥„ÅÆÈÅ∏ÊäûÁä∂ÊÖã„Çí„ÇØ„É™„Ç¢
            document.querySelectorAll('.quick-button').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            // „É≠„Ç∞„ÇíÊõ¥Êñ∞
            renderActivityLogs();
            
            alert('‚úì Ë®òÈå≤„ÇíÈñãÂßã„Åó„Åæ„Åó„Åü');
        }

        // Á∂ôÁ∂ö‰∏≠„ÅÆË®òÈå≤„ÇíÁµÇ‰∫Ü
        function endActivity(id) {
            const activity = activities.find(a => a.id === id);
            if (!activity) return;
            
            // ÁµÇ‰∫ÜÊôÇÂàª„ÇíË®òÈå≤
            activity.endTime = new Date().toISOString();
            
            // ÊâÄË¶ÅÊôÇÈñì„ÇíË®àÁÆó
            const start = new Date(activity.startTime || activity.timestamp);
            const end = new Date(activity.endTime);
            const durationMinutes = Math.round((end - start) / 1000 / 60);
            activity.durationMinutes = durationMinutes;
            
            localStorage.setItem('activities', JSON.stringify(activities));
            renderActivityLogs();
            
            const hours = Math.floor(durationMinutes / 60);
            const minutes = durationMinutes % 60;
            const durationStr = hours > 0 ? `${hours}ÊôÇÈñì${minutes}ÂàÜ` : `${minutes}ÂàÜ`;
            
            alert(`‚úì ÁµÇ‰∫Ü„Åó„Åæ„Åó„ÅüÔºà${durationStr}Ôºâ`);
        }

        function addMoney() {
            const input = document.getElementById('moneyInput');
            const amountInput = document.getElementById('moneyAmount');
            const text = input.value.trim();
            const amount = parseFloat(amountInput.value);
            
            if (!selectedMoneyCategory) {
                showStatus('moneyStatus', '‚ùå „Ç´„ÉÜ„Ç¥„É™„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
            
            if (!text || isNaN(amount)) {
                showStatus('moneyStatus', '‚ùå „É°„É¢„Å®ÈáëÈ°ç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
            
            // ÊîØÂá∫„ÅÆÂ†¥Âêà„ÅØ„Éû„Ç§„Éä„Çπ„Å´
            const finalAmount = currentMoneyType === 'expense' ? -Math.abs(amount) : Math.abs(amount);
            
            const record = {
                id: Date.now(),
                text: text,
                amount: finalAmount,
                category: selectedMoneyCategory,
                type: currentMoneyType,
                timestamp: new Date().toISOString()
            };
            
            window.moneyRecords.unshift(record);
            console.log("üí∞ Êñ∞„Åó„ÅÑË®òÈå≤„ÇíËøΩÂä†:", record);
            console.log("ËøΩÂä†Âæå„ÅÆ moneyRecords ‰ª∂Êï∞:", window.moneyRecords.length);
            localStorage.setItem('moneyRecords', JSON.stringify(window.moneyRecords));
            
            input.value = '';
            amountInput.value = '';
            showStatus('moneyStatus', '‚úì Ë®òÈå≤„Åó„Åæ„Åó„Åü');
            renderMoneyLogs();
        }
        

// „ÅäÈáë„Çø„Éñ: ÂèéÂÖ•/ÊîØÂá∫„ÅÆÂàá„ÇäÊõø„Åà
let currentMoneyType = 'expense'; // 'expense' „Åæ„Åü„ÅØ 'income'
let selectedMoneyCategory = null;

function switchMoneyType(type) {
    currentMoneyType = type;
    
    // „Çø„Éñ„Éú„Çø„É≥„ÅÆ active Áä∂ÊÖã„ÇíÊõ¥Êñ∞
    document.querySelectorAll('.money-type-tab').forEach(btn => {
        btn.classList.remove('active');
    });
    document.querySelector(`.money-type-tab[data-type="${type}"]`).classList.add('active');
    
    // „Ç´„ÉÜ„Ç¥„É™Ë°®Á§∫„ÇíÂàá„ÇäÊõø„Åà
    if (type === 'expense') {
        document.getElementById('expenseCategories').classList.add('active');
        document.getElementById('incomeCategories').classList.remove('active');
    } else {
        document.getElementById('expenseCategories').classList.remove('active');
        document.getElementById('incomeCategories').classList.add('active');
    }
    
    // „Ç´„ÉÜ„Ç¥„É™ÈÅ∏Êäû„Çí„É™„Çª„ÉÉ„Éà
    selectedMoneyCategory = null;
    document.querySelectorAll('.money-category-buttons .category-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    document.getElementById('selectedMoneyCategory').textContent = '„Ç´„ÉÜ„Ç¥„É™„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ';
}

function selectMoneyCategory(category) {
    selectedMoneyCategory = category;
    
    // ÂÖ®„Å¶„ÅÆ„Ç´„ÉÜ„Ç¥„É™„Éú„Çø„É≥„Åã„Çâ active „ÇíÂâäÈô§
    document.querySelectorAll('.money-category-buttons .category-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    
    // ÈÅ∏Êäû„Åï„Çå„Åü„Ç´„ÉÜ„Ç¥„É™„Éú„Çø„É≥„Å´ active „ÇíËøΩÂä†
    const activeContainer = currentMoneyType === 'expense' ? 
        document.getElementById('expenseCategories') : 
        document.getElementById('incomeCategories');
    const btn = activeContainer.querySelector(`[data-category="${category}"]`);
    if (btn) {
        btn.classList.add('active');
    }
    
    // ÈÅ∏ÊäûË°®Á§∫„ÇíÊõ¥Êñ∞
    const display = document.getElementById('selectedMoneyCategory');
    display.textContent = `ÈÅ∏Êäû‰∏≠: ${category}`;
    display.classList.add('has-selection');
}


// „ÅäÈáë„Ç´„ÉÜ„Ç¥„É™Á∑®ÈõÜÊ©üËÉΩ
window.expenseCategories = [
    { name: 'È£üË≤ª', emoji: 'üçΩÔ∏è' },
    { name: 'Êó•Áî®ÂìÅ', emoji: 'üß¥' },
    { name: 'Ë°£Êúç', emoji: 'üëï' },
    { name: 'ÁæéÂÆπ', emoji: 'üíÑ' },
    { name: '‰∫§ÈöõË≤ª', emoji: 'ü§ù' },
    { name: 'ÂåªÁôÇË≤ª', emoji: '‚öïÔ∏è' },
    { name: 'ÊïôËÇ≤Ë≤ª', emoji: 'üìö' },
    { name: 'ÂÖâÁÜ±Ë≤ª', emoji: 'üí°' },
    { name: '‰∫§ÈÄöË≤ª', emoji: 'üöÉ' },
    { name: 'Â®ØÊ•Ω', emoji: 'üéÆ' }
];

window.incomeCategories = [
    { name: 'Áµ¶Êñô', emoji: 'üíº' },
    { name: '„Åä„Åì„Å•„Åã„ÅÑ', emoji: 'üíµ' },
    { name: 'Ë≥û‰∏é', emoji: 'üéÅ' },
    { name: 'ÂâØÊ•≠', emoji: 'üíª' },
    { name: 'ÊäïË≥á', emoji: 'üìà' },
    { name: 'Ëá®ÊôÇÂèéÂÖ•', emoji: 'üéâ' }
];

// LocalStorage„Åã„ÇâË™≠„ÅøËæº„Åø
function loadMoneyCategories() {
    const savedExpense = localStorage.getItem('expenseCategories');
    const savedIncome = localStorage.getItem('incomeCategories');
    
    if (savedExpense) {
        expenseCategories = JSON.parse(savedExpense);
    }
    if (savedIncome) {
        incomeCategories = JSON.parse(savedIncome);
    }
    
    renderMoneyCategories();
}

// „Ç´„ÉÜ„Ç¥„É™„ÇíÊèèÁîª
function renderMoneyCategories() {
    // ÊîØÂá∫„Ç´„ÉÜ„Ç¥„É™
    const expenseContainer = document.querySelector('#expenseCategories .money-category-buttons');
    if (expenseContainer) {
        expenseContainer.innerHTML = expenseCategories.map(cat => 
            `<button class="category-btn" onclick="selectMoneyCategory('${cat.name}')" data-category="${cat.name}">${cat.emoji} ${cat.name}</button>`
        ).join('');
    }
    
    // ÂèéÂÖ•„Ç´„ÉÜ„Ç¥„É™
    const incomeContainer = document.querySelector('#incomeCategories .money-category-buttons');
    if (incomeContainer) {
        incomeContainer.innerHTML = incomeCategories.map(cat => 
            `<button class="category-btn" onclick="selectMoneyCategory('${cat.name}')" data-category="${cat.name}">${cat.emoji} ${cat.name}</button>`
        ).join('');
    }
}

// „Ç´„ÉÜ„Ç¥„É™Á∑®ÈõÜ„É¢„Éº„ÉÄ„É´„ÇíÈñã„Åè
function editMoneyCategories(type) {
    const modal = document.getElementById('moneyCategoryEditModal');
    modal.style.display = 'block';
    
    const title = modal.querySelector('h3');
    title.textContent = type === 'expense' ? 'üí∏ ÊîØÂá∫„Ç´„ÉÜ„Ç¥„É™Á∑®ÈõÜ' : 'üí∞ ÂèéÂÖ•„Ç´„ÉÜ„Ç¥„É™Á∑®ÈõÜ';
    
    // „É¢„Éº„ÉÄ„É´„Å´ type „Çí‰øùÂ≠ò
    modal.dataset.editingType = type;
    
    renderCategoryEditList(type);
}

// „Ç´„ÉÜ„Ç¥„É™Á∑®ÈõÜ„É™„Çπ„Éà„ÇíÊèèÁîª
function renderCategoryEditList(type) {
    const container = document.getElementById('categoryEditList');
    const categories = type === 'expense' ? expenseCategories : incomeCategories;
    
    container.innerHTML = categories.map((cat, index) => `
        <div class="category-edit-item">
            <span class="category-edit-emoji">${cat.emoji}</span>
            <span class="category-edit-name">${cat.name}</span>
            <button class="btn-icon" onclick="deleteMoneyCategoryItem('${type}', ${index})" title="ÂâäÈô§">üóëÔ∏è</button>
        </div>
    `).join('');
}

// „Ç´„ÉÜ„Ç¥„É™ËøΩÂä†
function addMoneyCategory() {
    const modal = document.getElementById('moneyCategoryEditModal');
    const type = modal.dataset.editingType;
    const nameInput = document.getElementById('newCategoryName');
    const emojiInput = document.getElementById('newCategoryEmoji');
    
    const name = nameInput.value.trim();
    const emoji = emojiInput.value.trim() || 'üìå';
    
    if (!name) {
        alert('„Ç´„ÉÜ„Ç¥„É™Âêç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
        return;
    }
    
    const categories = type === 'expense' ? expenseCategories : incomeCategories;
    
    // ÈáçË§á„ÉÅ„Çß„ÉÉ„ÇØ
    if (categories.some(c => c.name === name)) {
        alert('„Åô„Åß„Å´Âêå„ÅòÂêçÂâç„ÅÆ„Ç´„ÉÜ„Ç¥„É™„ÅåÂ≠òÂú®„Åó„Åæ„Åô');
        return;
    }
    
    categories.push({ name, emoji });
    
    // ‰øùÂ≠ò
    localStorage.setItem(type === 'expense' ? 'expenseCategories' : 'incomeCategories', JSON.stringify(categories));
    
    // „É™„Çª„ÉÉ„Éà
    nameInput.value = '';
    emojiInput.value = '';
    
    // ÂÜçÊèèÁîª
    renderCategoryEditList(type);
    renderMoneyCategories();
}

// „Ç´„ÉÜ„Ç¥„É™ÂâäÈô§
function deleteMoneyCategoryItem(type, index) {
    if (!confirm('„Åì„ÅÆ„Ç´„ÉÜ„Ç¥„É™„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')) return;
    
    const categories = type === 'expense' ? expenseCategories : incomeCategories;
    categories.splice(index, 1);
    
    // ‰øùÂ≠ò
    localStorage.setItem(type === 'expense' ? 'expenseCategories' : 'incomeCategories', JSON.stringify(categories));
    
    // ÂÜçÊèèÁîª
    renderCategoryEditList(type);
    renderMoneyCategories();
}

// „É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
function closeMoneyCategoryEditModal() {
    document.getElementById('moneyCategoryEditModal').style.display = 'none';
}
        // ‰ΩìÈáç„ÇíË®òÈå≤
        function addWeight() {
            const input = document.getElementById('weightInput');
            const weight = parseFloat(input.value);
            
            if (isNaN(weight) || weight <= 0) {
                showStatus('weightStatus', '‚ùå Ê≠£„Åó„ÅÑ‰ΩìÈáç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
            
            const record = {
                id: Date.now(),
                weight: weight,
                timestamp: new Date().toISOString()
            };
            
            weightRecords.unshift(record);
            localStorage.setItem('weightRecords', JSON.stringify(weightRecords));
            
            input.value = '';
            showStatus('weightStatus', '‚úì Ë®òÈå≤„Åó„Åæ„Åó„Åü');
            renderWeightLogs();
        }
        
        // „Ç∏„É£„Éº„Éä„É´Ëá™ÂãïË¶ÅÁ¥Ñ
// ÊîπÂñÑÁâà„Ç∏„É£„Éº„Éä„É´ÂàÜÊûêÈñ¢Êï∞
        // ÊîπÂñÑÁâà„Ç∏„É£„Éº„Éä„É´ÂàÜÊûêÈñ¢Êï∞Ôºà„Éá„Éê„ÉÉ„Ç∞Âº∑ÂåñÁâàÔºâ
        // ÂÆåÂÖ®ÊîπÂñÑÁâà„Ç∏„É£„Éº„Éä„É´ÂàÜÊûêÈñ¢Êï∞ÔºàË§áÊï∞Ë¶ÅÁ¥†ÂØæÂøúÔºâ
// Èü≥Â£∞ÂÖ•Âäõ„ÉÜ„Ç≠„Çπ„Éà„ÅÆÂâçÂá¶ÁêÜ„Å®È´òÁ≤æÂ∫¶ÂàÜÊûê

function preprocessVoiceText(text) {
    console.log('=== ÂâçÂá¶ÁêÜÈñãÂßã ===');
    console.log('ÂÖÉ„ÅÆ„ÉÜ„Ç≠„Çπ„Éà:', text);
    
    // 1. ÊòéÁ¢∫„Å™Âå∫Âàá„Çä„Éù„Ç§„É≥„Éà„ÇíÊ§úÂá∫
    let processed = text;
    
    // Êé•Á∂öË©û„ÅÆÂâç„Å´Âè•ÁÇπ„ÇíËøΩÂä†Ôºà„Ç´„Ç∏„É•„Ç¢„É´Ë°®ÁèæÂØæÂøúÔºâ
    const conjunctions = [
        '„Åæ„Åü', '„Åù„Åó„Å¶', '„Åù„Çå„Åã„Çâ', '„ÅÇ„Å®', '„Åß„ÇÇ', '„Å†„Åë„Å©', '„Åó„Åã„Åó',
        '„Åü„Å†', '„Åë„Å©', '‰∏ÄÊñπ', '„Å°„Å™„Åø„Å´', 'Ê¨°„Å´', '„Åï„Çâ„Å´', '„Åù„Çå„Åß'
    ];
    
    conjunctions.forEach(conj => {
        // „Äå„Åß„Åô[Êé•Á∂öË©û]„Äç„Äå„Åó„Åü[Êé•Á∂öË©û]„Äç„Äå„Å†[Êé•Á∂öË©û]„Äç„Å™„Å©„ÇíÊ§úÂá∫
        const patterns = [
            new RegExp(`(„Åß„Åô|„Åó„Åü|„Å†„Å£„Åü|„Åß„Åó„Åü|„Åæ„Åô|„Åæ„Åó„Åü|„Å†|„Åü)${conj}`, 'g'),
            new RegExp(`(„Åì„Å®|„ÅÆ|„ÇÇ„ÅÆ)${conj}`, 'g')
        ];
        
        patterns.forEach(pattern => {
            processed = processed.replace(pattern, (match, p1) => {
                console.log(`Âè•ÁÇπÊåøÂÖ•: "${match}" ‚Üí "${p1}„ÄÇ${conj}"`);
                return `${p1}„ÄÇ${conj}`;
            });
        });
    });
    
    // 2. „Ç´„ÉÜ„Ç¥„É™„Ç≠„Éº„ÉØ„Éº„Éâ„ÅÆÂâç„Å´Âè•ÁÇπ„ÇíËøΩÂä†
    const categoryMarkers = [
        '„Çà„Åã„Å£„Åü„Åì„Å®', 'ËâØ„Åã„Å£„Åü„Åì„Å®', '„ÅÑ„ÅÑ„Åì„Å®',
        '„ÇÇ„Å£„Å®„Åß„Åç„Çã„Åì„Å®', '„ÇÇ„Å£„Å®',
        'ÊÇ©„Çì„Åß„Çã„Åì„Å®', 'ÂøÉÈÖç„Å™„Åì„Å®', '‰∏çÂÆâ„Å™„Åì„Å®',
        'ÊòéÊó•', 'ÊòéÊó•„ÅØ', 'ÊòéÊó•„ÅÆ', 'ÊòéÊó•„ÇÑ„Çã„Åì„Å®'
    ];
    
    categoryMarkers.forEach(marker => {
        const pattern = new RegExp(`(„Åß„Åô|„Åó„Åü|„Å†„Å£„Åü|„Åß„Åó„Åü|„Åæ„Åô|„Åæ„Åó„Åü|„Å†|„Åü|„Åì„Å®)([^„ÄÇ])*(${marker})`, 'g');
        processed = processed.replace(pattern, (match, p1, p2, p3) => {
            // Êó¢„Å´Âè•ÁÇπ„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅØ„Çπ„Ç≠„ÉÉ„Éó
            if (match.includes('„ÄÇ')) return match;
            const insertion = `${p1}„ÄÇ${p2 || ''}${p3}`;
            console.log(`„Ç´„ÉÜ„Ç¥„É™ÂâçÂè•ÁÇπÊåøÂÖ•: "${match}" ‚Üí "${insertion}"`);
            return insertion;
        });
    });
    
    // 3. Èü≥Â£∞Ë™çË≠òÁâπÊúâ„ÅÆË™§Â§âÊèõ„Çí‰øÆÊ≠£
    const corrections = [
        ['Â¶ªÊÉ≥', 'ÊúÄÈ´ò'],
        ['Ë©ï‰æ°„ÇíÈÄ≤„ÇÅ„Çâ„Çå„Åü', 'Ë©ï‰æ°„Çí„ÇÇ„Çâ„Åà„Åü'],
        ['„Åß„Åô„Åæ„Åü', '„Åß„Åô„ÄÇ„Åæ„Åü'],
        ['„Åì„Å®Â¶ªÊÉ≥', '„Åì„Å®ÊúÄÈ´ò'],
        ['„Åì„Å®„Åå', '„Åì„Å®„Åß']
    ];
    
    corrections.forEach(([wrong, correct]) => {
        if (processed.includes(wrong)) {
            console.log(`Ë™§Â§âÊèõ‰øÆÊ≠£: "${wrong}" ‚Üí "${correct}"`);
            processed = processed.replace(new RegExp(wrong, 'g'), correct);
        }
    });
    
    console.log('ÂâçÂá¶ÁêÜÂæå:', processed);
    console.log('=== ÂâçÂá¶ÁêÜÂÆå‰∫Ü ===\n');
    
    return processed;
}

function analyzJournal(text) {
    console.log('\n=== „Ç∏„É£„Éº„Éä„É´ÂàÜÊûêÈñãÂßã ===');
    
    // ÂâçÂá¶ÁêÜ„ÇíÈÅ©Áî®
    const preprocessed = preprocessVoiceText(text);
    
    const analysis = {
        good: [],
        more: [],
        worry: [],
        task: []
    };

    // „Ç≠„Éº„ÉØ„Éº„Éâ„Éë„Çø„Éº„É≥ÔºàÊã°ÂºµÁâàÔºâ
    const patterns = {
        good: {
            keywords: [
                '„Çà„Åã„Å£„Åü', 'ËâØ„Åã„Å£„Åü', '„ÅÑ„ÅÑ', 'ËâØ„ÅÑ', '„ÅÜ„Çå„Åó„ÅÑ', 'Â¨â„Åó„ÅÑ',
                'Ê•Ω„Åó„Åã„Å£„Åü', 'Ê•Ω„Åó„ÅÑ', '„Åü„ÅÆ„Åó„ÅÑ', 'Âπ∏„Åõ', '„Åó„ÅÇ„Çè„Åõ',
                'ÊàêÂäü', '„Åß„Åç„Åü', 'ÈÅîÊàê', 'ÈÄ≤„Çì„Å†', 'È†ÜË™ø', '„ÇÑ„Å£„Åü',
                'Ê∫ÄË∂≥', '„ÅÇ„Çä„Åå„Åü„ÅÑ', 'ÊÑüË¨ù', 'ÊúÄÈ´ò', 'Á¥†Êô¥„Çâ„Åó„ÅÑ',
                'ÂÖÖÂÆü', '„Éù„Ç∏„ÉÜ„Ç£„Éñ', 'ÂâçÂêë„Åç', '„Åå„Çì„Å∞„Å£„Åü', 'È†ëÂºµ„Å£„Åü',
                'Ë©ï‰æ°', '„ÇÇ„Çâ„Åà„Åü', 'Ë§í„ÇÅ„Çâ„Çå„Åü', 'Ë™ç„ÇÅ„Çâ„Çå„Åü', 'ÈÄÄÈô¢'
            ],
            verbs: ['„Åß„Åç„Åü', 'ÈÄ≤„Çì„Å†', '„ÇÑ„Å£„Åü', 'ÈÅîÊàê„Åó„Åü', 'ÊàêÂäü„Åó„Åü']
        },
        more: {
            keywords: [
                '„ÇÇ„Å£„Å®', '„Åï„Çâ„Å´', 'ÊîπÂñÑ', '„ÇÇ„ÅÜÂ∞ë„Åó', 'Ê¨°„ÅØ', 'Ê¨°Âõû',
                'Â∑•Â§´', 'ÂäπÁéá', '„Çà„Çä„Çà„Åè', 'Âêë‰∏ä', '‰º∏„Å∞„Åô', 'Á£®„Åè',
                'Âº∑Âåñ', '„Çπ„Ç≠„É´„Ç¢„ÉÉ„Éó', 'ÊàêÈï∑', '„É¨„Éô„É´„Ç¢„ÉÉ„Éó', 'Áô∫Â±ï',
                '„Åß„Åç„Çã„Åì„Å®', '„ÇÑ„Çå„Çã„Åì„Å®', 'ÂèØËÉΩÊÄß', '„ÉÅ„É£„É≥„Çπ'
            ],
            verbs: ['ÊîπÂñÑ„Åô„Çã', 'Âêë‰∏ä„Åô„Çã', 'ÊàêÈï∑„Åô„Çã', 'Á£®„Åè', '‰º∏„Å∞„Åô']
        },
        worry: {
            keywords: [
                'ÂøÉÈÖç', '‰∏çÂÆâ', 'ÊÇ©„Åø', 'Âõ∞„Å£„Åü', 'Èõ£„Åó„ÅÑ', 'Â§ßÂ§â',
                '„Å§„Çâ„ÅÑ', '„Åç„Å§„ÅÑ', '„Åó„Çì„Å©„ÅÑ', '„Çπ„Éà„É¨„Çπ', '„Éó„É¨„ÉÉ„Ç∑„É£„Éº',
                'ÁÑ¶„Çä', '„Ç§„É©„Ç§„É©', '„ÇÇ„ÇÑ„ÇÇ„ÇÑ', 'ÊÇ≤„Åó„ÅÑ', 'ËêΩ„Å°Ëæº„ÇÄ',
                'ÂæåÊÇî', 'Â§±Êïó', '„Éü„Çπ', '„Éà„É©„Éñ„É´', 'ÂïèÈ°å',
                '„Çè„Åã„Çâ„Å™„ÅÑ', '„Åß„Åç„Å™„ÅÑ', '„ÅÜ„Åæ„Åè„ÅÑ„Åã„Å™„ÅÑ', '„ÇÑ„Å∞„ÅÑ'
            ],
            verbs: ['Âõ∞„Çã', 'ÊÇ©„ÇÄ', 'ÂøÉÈÖç„Åô„Çã', '‰∏çÂÆâ„Å´„Å™„Çã', 'ËêΩ„Å°Ëæº„ÇÄ']
        },
        task: {
            keywords: [
                'ÊòéÊó•', '‰ªäÂæå', '„Åì„Çå„Åã„Çâ', 'Ê¨°', '‰∫àÂÆö', 'Ë®àÁîª',
                '„ÇÑ„Çã', '„Åô„Çã', '„Åó„Çà„ÅÜ', '„ÇÑ„Çç„ÅÜ', 'Âèñ„ÇäÁµÑ„ÇÄ', 'ÈÄ≤„ÇÅ„Çã',
                'Ê∫ñÂÇô', 'ÂØæÂøú', 'ÂÆüÊñΩ', 'Ë°å„ÅÜ', 'Âßã„ÇÅ„Çã', '„Çπ„Çø„Éº„Éà',
                'È†ëÂºµ„Çã', '„Åå„Çì„Å∞„Çã', '„Éà„É©„Ç§', '„ÉÅ„É£„É¨„É≥„Ç∏', 'ÊåëÊà¶'
            ],
            verbs: ['„ÇÑ„Çã', '„Åô„Çã', 'Âèñ„ÇäÁµÑ„ÇÄ', 'ÈÄ≤„ÇÅ„Çã', 'Âßã„ÇÅ„Çã', 'È†ëÂºµ„Çã']
        }
    };

    // ÂâçÂá¶ÁêÜÊ∏à„Åø„ÉÜ„Ç≠„Çπ„Éà„Çí„Çª„Ç∞„É°„É≥„Éà„Å´ÂàÜÂâ≤
    const sentences = preprocessed
        .split(/[„ÄÇÔºÅÔºü\n]/)
        .filter(s => s.trim().length > 0);
    
    console.log('„Çª„Ç∞„É°„É≥„Éà„Å´ÂàÜÂâ≤:', sentences);

    sentences.forEach((sentence, idx) => {
        const trimmed = sentence.trim();
        if (trimmed.length === 0) return;

        console.log(`\n--- „Çª„Ç∞„É°„É≥„Éà ${idx + 1}: "${trimmed}" ---`);

        let matched = false;
        let matchedCategories = [];

        // ÂêÑ„Ç´„ÉÜ„Ç¥„É™„Çí„ÉÅ„Çß„ÉÉ„ÇØÔºàË§áÊï∞„Ç´„ÉÜ„Ç¥„É™ÂØæÂøúÔºâ
        Object.keys(patterns).forEach(category => {
            const pattern = patterns[category];
            const hasKeyword = pattern.keywords.some(kw => trimmed.includes(kw));
            const hasVerb = pattern.verbs && pattern.verbs.some(v => trimmed.includes(v));

            if (hasKeyword || hasVerb) {
                console.log(`  ‚úì ${category}„Å´ÂàÜÈ°û („Ç≠„Éº„ÉØ„Éº„Éâ: ${hasKeyword}, ÂãïË©û: ${hasVerb})`);
                
                // ÈáçË§á„ÉÅ„Çß„ÉÉ„ÇØ
                if (!analysis[category].includes(trimmed)) {
                    analysis[category].push(trimmed);
                    matchedCategories.push(category);
                    matched = true;
                }
            }
        });

        if (!matched) {
            console.log('  ‚Üí more„Å´ÂàÜÈ°ûÔºà„Éá„Éï„Ç©„É´„ÉàÔºâ');
            if (!analysis.more.includes(trimmed)) {
                analysis.more.push(trimmed);
            }
        } else {
            console.log(`  ‚Üí ${matchedCategories.join(', ')}„Å´ÂàÜÈ°û`);
        }
    });

    // ÂêÑ„Ç´„ÉÜ„Ç¥„É™„ÇíÊúÄÂ§ß5‰ª∂„Å´Âà∂Èôê
    Object.keys(analysis).forEach(key => {
        if (analysis[key].length > 5) {
            analysis[key] = analysis[key].slice(0, 5);
        }
    });

    console.log('\n=== ÂàÜÊûêÁµêÊûú ===');
    console.log('Good:', analysis.good);
    console.log('More:', analysis.more);
    console.log('Worry:', analysis.worry);
    console.log('Task:', analysis.task);
    console.log('=== ÂàÜÊûêÂÆå‰∫Ü ===\n');

    return analysis;
}
        
        // „Ç∏„É£„Éº„Éä„É´„Çí‰øùÂ≠ò
        function addJournal() {
            const input = document.getElementById('journalInput');
            const text = input.value.trim();
            const journalDateInput = document.getElementById('journalDate');
            
            if (!text) {
                showStatus('journalStatus', '‚ùå ÂÜÖÂÆπ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
            
            // ÈÅ∏Êäû„Åï„Çå„ÅüÊó•‰ªò„ÇíÂèñÂæóÔºàÊú™ÈÅ∏Êäû„ÅÆÂ†¥Âêà„ÅØ‰ªäÊó•Ôºâ
            let selectedDate;
            if (journalDateInput.value) {
                // Êó•‰ªòÂÖ•Âäõ„Åã„ÇâÊó•‰ªò„ÇíÂèñÂæó„Åó„ÄÅÁèæÂú®ÊôÇÂàª„ÇíË®≠ÂÆö
                selectedDate = new Date(journalDateInput.value + 'T' + new Date().toTimeString().split(' ')[0]);
            } else {
                selectedDate = new Date();
            }
            
            // Ëá™ÂãïË¶ÅÁ¥Ñ
            const analysis = createManualCategoryAnalysis();
            
            const record = {
                id: Date.now(),
                text: text,
                mood: selectedMood,
                summary: analysis,
                timestamp: selectedDate.toISOString()
            };
            
            // ÈÅ∏Êäû„Åó„ÅüÊó•‰ªò„ÅÆ„Ç∏„É£„Éº„Éä„É´„Çí‰∏äÊõ∏„ÅçÁ¢∫Ë™ç
            const targetDateStr = selectedDate.toLocaleDateString('ja-JP');
            const existingIndex = journals.findIndex(j => 
                new Date(j.timestamp).toLocaleDateString('ja-JP') === targetDateStr
            );
            
            if (existingIndex >= 0) {
                if (confirm(`${targetDateStr}„ÅÆ„Ç∏„É£„Éº„Éä„É´„ÅØÊó¢„Å´Â≠òÂú®„Åó„Åæ„Åô„ÄÇ‰∏äÊõ∏„Åç„Åó„Åæ„Åô„ÅãÔºü`)) {
                    journals[existingIndex] = record;
                } else {
                    return;
                }
            } else {
                journals.unshift(record);
            }
            
            localStorage.setItem('journals', JSON.stringify(journals));
            
            input.value = '';
            clearCategoryVoiceInputs(); // „Ç´„ÉÜ„Ç¥„É™ÂÖ•Âäõ„Çí„ÇØ„É™„Ç¢
            journalDateInput.value = ''; // Êó•‰ªò„Çí„É™„Çª„ÉÉ„Éà
            // Keep summary visible after save
            
            // Ê∞óÂàÜÈÅ∏Êäû„Çí„É™„Çª„ÉÉ„Éà
            selectedMood = 'normal';
            document.querySelectorAll('.mood-button').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            showStatus('journalStatus', `‚úì ${targetDateStr}„ÅÆË®òÈå≤„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü`);
            renderJournalLogs();
            renderCalendar();
        }
        
        // Êó•‰ªò„Çí‰ªäÊó•„Å´Ë®≠ÂÆö
        function setJournalDateToToday() {
            const today = new Date();
            const dateStr = today.toISOString().split('T')[0];
            document.getElementById('journalDate').value = dateStr;
        }
        
        // „Éö„Éº„Ç∏Ë™≠„ÅøËæº„ÅøÊôÇ„Å´‰ªäÊó•„ÅÆÊó•‰ªò„ÇíË®≠ÂÆö
        document.addEventListener('DOMContentLoaded', () => {
            setJournalDateToToday();
        });
        
        // „Çπ„ÉÜ„Éº„Çø„ÇπË°®Á§∫
        function showStatus(elementId, message) {
            const statusEl = document.getElementById(elementId);
            statusEl.textContent = message;
            setTimeout(() => {
                statusEl.textContent = '';
            }, 3000);
        }
        
        // „É≠„Ç∞Ë°®Á§∫ÔºöË°åÂãï
// Ë°åÂãï„É≠„Ç∞Ë°®Á§∫ÔºàÁ∑®ÈõÜ„ÉªÂâäÈô§„Éú„Çø„É≥‰ªò„ÅçÔºâ

// ‰ªäÊó•„ÅÆ„Çø„Çπ„ÇØ„ÇíË°®Á§∫
function renderTodayTasks() {
    const container = document.getElementById('todayTasksContent');
    
    // Êò®Êó•„ÅÆÊó•‰ªò„ÇíÂèñÂæó
    const yesterday = new Date();
    yesterday.setDate(yesterday.getDate() - 1);
    const yesterdayStr = yesterday.toISOString().split('T')[0];
    
    // Êò®Êó•„ÅÆ„Ç∏„É£„Éº„Éä„É´„ÇíÂèñÂæó
    const yesterdayJournal = journalRecords.find(record => {
        const recordDate = new Date(record.timestamp).toISOString().split('T')[0];
        return recordDate === yesterdayStr;
    });
    
    if (!yesterdayJournal) {
        container.innerHTML = '<div class="no-tasks">Êò®Êó•„ÅÆ„Ç∏„É£„Éº„Éä„É´„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</div>';
        return;
    }
    
    // Must „Çø„Çπ„ÇØ„Å® Want „Çø„Çπ„ÇØ„ÇíÂèñÂæó
    const mustTasks = yesterdayJournal.taskMust || [];
    const wantTasks = yesterdayJournal.taskWant || [];
    
    if (mustTasks.length === 0 && wantTasks.length === 0) {
        container.innerHTML = '<div class="no-tasks">Êò®Êó•„ÅÆ„Çø„Çπ„ÇØ„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</div>';
        return;
    }
    
    let html = '';
    
    // Must „Çø„Çπ„ÇØ
    if (mustTasks.length > 0) {
        html += '<div class="task-group">';
        html += '<div class="task-group-title">‚úÖ MustÔºà„ÇÑ„Çâ„Å™„Åç„ÇÉ„ÅÑ„Åë„Å™„ÅÑ„Åì„Å®Ôºâ</div>';
        mustTasks.forEach((task, index) => {
            html += `
                <div class="task-item">
                    <input type="checkbox" id="mustTask${index}" class="task-checkbox">
                    <label for="mustTask${index}" class="task-label">${task}</label>
                </div>
            `;
        });
        html += '</div>';
    }
    
    // Want „Çø„Çπ„ÇØ
    if (wantTasks.length > 0) {
        html += '<div class="task-group">';
        html += '<div class="task-group-title">üí° WantÔºà„ÇÑ„Çä„Åü„ÅÑ„Åì„Å®Ôºâ</div>';
        wantTasks.forEach((task, index) => {
            html += `
                <div class="task-item">
                    <input type="checkbox" id="wantTask${index}" class="task-checkbox">
                    <label for="wantTask${index}" class="task-label">${task}</label>
                </div>
            `;
        });
        html += '</div>';
    }
    
    container.innerHTML = html;
}

function refreshTodayTasks() {
    renderTodayTasks();
    showStatus('activityStatus', '‚úì „Çø„Çπ„ÇØ„ÇíÊõ¥Êñ∞„Åó„Åæ„Åó„Åü');
}

// „É¨„Éù„Éº„ÉàÊ©üËÉΩ
let selectedReportType = 'activity'; // 'activity' „Åæ„Åü„ÅØ 'money'
let activityReportMonth = new Date().toISOString().substring(0, 7); // YYYY-MM
let moneyReportMonth = new Date().toISOString().substring(0, 7);

// „É¨„Éù„Éº„Éà„Çø„Ç§„Éó„ÅÆÂàá„ÇäÊõø„Åà
function switchReportType(type) {
    selectedReportType = type;
    
    // „Çø„Éñ„Éú„Çø„É≥„ÅÆ active Áä∂ÊÖã„ÇíÊõ¥Êñ∞
    document.querySelectorAll('.report-type-tab').forEach(btn => {
        btn.classList.remove('active');
    });
    document.querySelector(`.report-type-tab[data-type="${type}"]`).classList.add('active');
    
    // „É¨„Éù„Éº„ÉàÂÜÖÂÆπ„ÅÆË°®Á§∫Âàá„ÇäÊõø„Åà
    if (type === 'activity') {
        document.getElementById('activityReport').classList.add('active');
        document.getElementById('moneyReport').classList.remove('active');
    } else {
        document.getElementById('activityReport').classList.remove('active');
        document.getElementById('moneyReport').classList.add('active');
    }
}

// Êúà„ÅÆÂ§âÊõ¥
function changeReportMonth(type, offset) {
    if (type === 'activity') {
        const [year, month] = activityReportMonth.split('-').map(Number);
        const date = new Date(year, month - 1 + offset, 1);
        activityReportMonth = date.toISOString().substring(0, 7);
        updateReportMonthDisplay('activity');
        renderActivityReport();
    } else {
        const [year, month] = moneyReportMonth.split('-').map(Number);
        const date = new Date(year, month - 1 + offset, 1);
        moneyReportMonth = date.toISOString().substring(0, 7);
        updateReportMonthDisplay('money');
        renderMoneyReport();
    }
}

// ÊúàË°®Á§∫„ÇíÊõ¥Êñ∞
function updateReportMonthDisplay(type) {
    const monthNames = ['1Êúà', '2Êúà', '3Êúà', '4Êúà', '5Êúà', '6Êúà', 
                        '7Êúà', '8Êúà', '9Êúà', '10Êúà', '11Êúà', '12Êúà'];
    
    if (type === 'activity') {
        const [year, month] = activityReportMonth.split('-').map(Number);
        document.getElementById('activityReportMonthDisplay').textContent = `${year}Âπ¥${monthNames[month - 1]}`;
    } else {
        const [year, month] = moneyReportMonth.split('-').map(Number);
        document.getElementById('moneyReportMonthDisplay').textContent = `${year}Âπ¥${monthNames[month - 1]}`;
    }
}

// Ë°åÂãï„É¨„Éù„Éº„Éà„ÇíÊèèÁîª
function renderActivityReport() {
    renderActivityCalendar();
    renderActivitySummary();
    renderActivityChart();
    renderActivityDailyDetails();
}

// „ÅäÈáë„É¨„Éù„Éº„Éà„ÇíÊèèÁîª
function renderMoneyReport() {
    console.log("üîç renderMoneyReport „Éá„Éê„ÉÉ„Ç∞");
    console.log("moneyRecords ÂÖ®‰ª∂Êï∞:", moneyRecords.length);
    console.log("moneyRecords ÂÖ®„Éá„Éº„Çø:", JSON.stringify(moneyRecords, null, 2));
    console.log("localStorage „Åã„ÇâÁõ¥Êé•Ë™≠„ÅøÂèñ„Çä:", localStorage.getItem("moneyRecords"));
    renderMoneyCalendar();
    renderMoneySummary();
    renderMoneyChart();
    renderMoneyDailyDetails();
}

// Ë°åÂãï„Ç´„É¨„É≥„ÉÄ„Éº
function renderActivityCalendar() {
    const container = document.getElementById('activityCalendar');
    const [year, month] = activityReportMonth.split('-').map(Number);
    
    // „Åù„ÅÆÊúà„ÅÆË®òÈå≤„ÇíÂèñÂæó
    const monthRecords = activities.filter(record => {
        const recordDate = new Date(record.timestamp).toISOString().substring(0, 7);
        return recordDate === activityReportMonth;
    });
    
    // Êó•Âà•„Å´„Ç∞„É´„Éº„ÉóÂåñ
    const dayGroups = {};
    monthRecords.forEach(record => {
        const day = new Date(record.timestamp).getDate();
        if (!dayGroups[day]) dayGroups[day] = [];
        dayGroups[day].push(record);
    });
    
    // „Ç´„É¨„É≥„ÉÄ„Éº„ÇíÁîüÊàê
    const firstDay = new Date(year, month - 1, 1).getDay();
    const daysInMonth = new Date(year, month, 0).getDate();
    
    let html = '<div class="calendar-grid">';
    html += '<div class="calendar-header">Êó•</div>';
    html += '<div class="calendar-header">Êúà</div>';
    html += '<div class="calendar-header">ÁÅ´</div>';
    html += '<div class="calendar-header">Ê∞¥</div>';
    html += '<div class="calendar-header">Êú®</div>';
    html += '<div class="calendar-header">Èáë</div>';
    html += '<div class="calendar-header">Âúü</div>';
    
    // Á©∫ÁôΩ„Çª„É´
    for (let i = 0; i < firstDay; i++) {
        html += '<div class="calendar-day empty"></div>';
    }
    
    // Êó•‰ªò„Çª„É´
    for (let day = 1; day <= daysInMonth; day++) {
        const hasRecords = dayGroups[day] && dayGroups[day].length > 0;
        const count = hasRecords ? dayGroups[day].length : 0;
        html += `
            <div class="calendar-day ${hasRecords ? 'has-records' : ''}" 
                 onclick="showActivityDayDetails(${day})">
                <div class="calendar-day-number">${day}</div>
                ${hasRecords ? `<div class="calendar-day-count">${count}‰ª∂</div>` : ''}
            </div>
        `;
    }
    
    html += '</div>';
    container.innerHTML = html;
}

// Ë°åÂãïÊ¶ÇË¶Å
function renderActivitySummary() {
    const container = document.getElementById('activitySummary');
    
    const monthRecords = activities.filter(record => {
        const recordDate = new Date(record.timestamp).toISOString().substring(0, 7);
        return recordDate === activityReportMonth;
    });
    
    const totalCount = monthRecords.length;
    const categoryCount = {};
    
    monthRecords.forEach(record => {
        const category = record.category || '„Åù„ÅÆ‰ªñ';
        categoryCount[category] = (categoryCount[category] || 0) + 1;
    });
    
    const topCategory = Object.entries(categoryCount).sort((a, b) => b[1] - a[1])[0];
    
    container.innerHTML = `
        <div class="summary-stats">
            <div class="summary-stat-item">
                <div class="summary-stat-value">${totalCount}</div>
                <div class="summary-stat-label">Á∑èË°åÂãïÊï∞</div>
            </div>
            <div class="summary-stat-item">
                <div class="summary-stat-value">${Object.keys(categoryCount).length}</div>
                <div class="summary-stat-label">„Ç´„ÉÜ„Ç¥„É™Êï∞</div>
            </div>
            ${topCategory ? `
            <div class="summary-stat-item">
                <div class="summary-stat-value">${topCategory[0]}</div>
                <div class="summary-stat-label">ÊúÄÂ§ö„Ç´„ÉÜ„Ç¥„É™ (${topCategory[1]}Âõû)</div>
            </div>
            ` : ''}
        </div>
    `;
}

// „ÅäÈáë„Ç´„É¨„É≥„ÉÄ„ÉºÔºàÂêåÊßò„ÅÆÂÆüË£ÖÔºâ
function renderMoneyCalendar() {
    const container = document.getElementById('moneyCalendar');
    console.log("renderMoneyCalendar: moneyReportMonth=", moneyReportMonth, "moneyRecords.length=", moneyRecords.length);
    const [year, month] = moneyReportMonth.split('-').map(Number);
    
    const monthRecords = moneyRecords.filter(record => {
        const recordDate = new Date(record.timestamp).toISOString().substring(0, 7);
        return recordDate === moneyReportMonth;
    });
    
    const dayGroups = {};
    monthRecords.forEach(record => {
        const day = new Date(record.timestamp).getDate();
        if (!dayGroups[day]) dayGroups[day] = { income: 0, expense: 0 };
        if (record.amount > 0) {
            dayGroups[day].income += record.amount;
        } else {
            dayGroups[day].expense += Math.abs(record.amount);
        }
    });
    
    const firstDay = new Date(year, month - 1, 1).getDay();
    const daysInMonth = new Date(year, month, 0).getDate();
    
    let html = '<div class="calendar-grid">';
    html += '<div class="calendar-header">Êó•</div>';
    html += '<div class="calendar-header">Êúà</div>';
    html += '<div class="calendar-header">ÁÅ´</div>';
    html += '<div class="calendar-header">Ê∞¥</div>';
    html += '<div class="calendar-header">Êú®</div>';
    html += '<div class="calendar-header">Èáë</div>';
    html += '<div class="calendar-header">Âúü</div>';
    
    for (let i = 0; i < firstDay; i++) {
        html += '<div class="calendar-day empty"></div>';
    }
    
    for (let day = 1; day <= daysInMonth; day++) {
        const hasRecords = dayGroups[day];
        const balance = hasRecords ? (dayGroups[day].income - dayGroups[day].expense) : 0;
        html += `
            <div class="calendar-day ${hasRecords ? 'has-records' : ''}" 
                 onclick="showMoneyDayDetails(${day})">
                <div class="calendar-day-number">${day}</div>
                ${hasRecords ? `<div class="calendar-day-balance ${balance >= 0 ? 'positive' : 'negative'}">${balance >= 0 ? '+' : ''}${balance.toLocaleString()}ÂÜÜ</div>` : ''}
            </div>
        `;
    }
    
    html += '</div>';
    container.innerHTML = html;
}
    console.log("moneyCalendar HTML generated, length=", html.length, "first 200 chars:", html.substring(0, 200));

// „ÅäÈáëÊ¶ÇË¶Å
function renderMoneySummary() {
    const container = document.getElementById('moneySummary');
    
    const monthRecords = moneyRecords.filter(record => {
        const recordDate = new Date(record.timestamp).toISOString().substring(0, 7);
        return recordDate === moneyReportMonth;
    });
    
    let totalIncome = 0;
    let totalExpense = 0;
    
    monthRecords.forEach(record => {
        if (record.amount > 0) {
            totalIncome += record.amount;
        } else {
            totalExpense += Math.abs(record.amount);
        }
    });
    
    const balance = totalIncome - totalExpense;
    
    container.innerHTML = `
        <div class="summary-stats">
            <div class="summary-stat-item income">
                <div class="summary-stat-value">+${totalIncome.toLocaleString()}ÂÜÜ</div>
                <div class="summary-stat-label">ÂèéÂÖ•</div>
            </div>
            <div class="summary-stat-item expense">
                <div class="summary-stat-value">-${totalExpense.toLocaleString()}ÂÜÜ</div>
                <div class="summary-stat-label">ÊîØÂá∫</div>
            </div>
            <div class="summary-stat-item ${balance >= 0 ? 'positive' : 'negative'}">
                <div class="summary-stat-value">${balance >= 0 ? '+' : ''}${balance.toLocaleString()}ÂÜÜ</div>
                <div class="summary-stat-label">ÂêàË®à</div>
            </div>
        </div>
    `;
}

// „Ç∞„É©„ÉïÊèèÁîªÁî®„ÅÆÈñ¢Êï∞ÔºàChart.js„Çí‰ΩøÁî®Ôºâ
function renderActivityChart() {
    // Ë°åÂãï„É¨„Éù„Éº„Éà„Å´„ÅØ„Ç∞„É©„Éï„Å™„Åó
}

function renderMoneyChart() {
    const container = document.querySelector('#moneyReportChart').parentElement;
    container.innerHTML = '<p style="text-align:center;color:#999;">„Ç∞„É©„ÉïÊ©üËÉΩ„ÅØ‰ªäÂæåÂÆüË£Ö‰∫àÂÆö„Åß„Åô</p>';
}

// Êó•Âà•Ë©≥Á¥∞
function renderActivityDailyDetails() {
    const container = document.getElementById('activityDailyDetails');
    container.innerHTML = '<p style="text-align:center;color:#999;">„Ç´„É¨„É≥„ÉÄ„Éº„ÅÆÊó•‰ªò„Çí„Çø„ÉÉ„Éó„Åó„Å¶Ë©≥Á¥∞„ÇíË°®Á§∫</p>';
}

function renderMoneyDailyDetails() {
    const container = document.getElementById('moneyDailyDetails');
    container.innerHTML = '<p style="text-align:center;color:#999;">„Ç´„É¨„É≥„ÉÄ„Éº„ÅÆÊó•‰ªò„Çí„Çø„ÉÉ„Éó„Åó„Å¶Ë©≥Á¥∞„ÇíË°®Á§∫</p>';
}

// Êó•‰ªò„ÇØ„É™„ÉÉ„ÇØÊôÇ„ÅÆË©≥Á¥∞Ë°®Á§∫
function showActivityDayDetails(day) {
window.showActivityDayDetails = showActivityDayDetails; // „Ç∞„É≠„Éº„Éê„É´„Å´ÊòéÁ§∫ÁöÑ„Å´ÂÖ¨Èñã
    const [year, month] = activityReportMonth.split('-').map(Number);
    const targetDate = new Date(year, month - 1, day);
    const dateStr = targetDate.toISOString().split('T')[0];
    
    const dayRecords = activities.filter(record => {
        const recordDate = new Date(record.timestamp).toISOString().split('T')[0];
        return recordDate === dateStr;
    });
    
    const container = document.getElementById('activityDailyDetails');
    
    if (dayRecords.length === 0) {
        container.innerHTML = `<p style="text-align:center;color:#999;">${month}Êúà${day}Êó•„ÅÆË®òÈå≤„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì</p>`;
        return;
    }
    
    let html = `<h4>${month}Êúà${day}Êó•„ÅÆË°åÂãï (${dayRecords.length}‰ª∂)</h4>`;
    html += '<div class="daily-detail-list">';
    
    dayRecords.forEach(record => {
        const time = new Date(record.timestamp).toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' });
        html += `
            <div class="daily-detail-item">
                <div class="daily-detail-time">${time}</div>
                <div class="daily-detail-content">
                    <div class="daily-detail-category">${record.category || '„Åù„ÅÆ‰ªñ'}</div>
                    <div class="daily-detail-text">${record.text}</div>
                </div>
            </div>
        `;
    });
    
    html += '</div>';
    container.innerHTML = html;
    
    // „Çπ„ÇØ„É≠„Éº„É´
    container.scrollIntoView({ behavior: 'smooth' });
}

function showMoneyDayDetails(day) {
window.showMoneyDayDetails = showMoneyDayDetails; // „Ç∞„É≠„Éº„Éê„É´„Å´ÊòéÁ§∫ÁöÑ„Å´ÂÖ¨Èñã
    console.log("showMoneyDayDetails called", day, "moneyReportMonth:", moneyReportMonth, "moneyRecords:", moneyRecords.length);
    const [year, month] = moneyReportMonth.split('-').map(Number);
    const targetDate = new Date(year, month - 1, day);
    const dateStr = targetDate.toISOString().split('T')[0];
    
    const dayRecords = moneyRecords.filter(record => {
        const recordDate = new Date(record.timestamp).toISOString().split('T')[0];
        return recordDate === dateStr;
    });
    console.log("dayRecords filtered:", dayRecords.length, dayRecords);
    
    const container = document.getElementById('moneyDailyDetails');
    
    if (dayRecords.length === 0) {
        container.innerHTML = `<p style="text-align:center;color:#999;">${month}Êúà${day}Êó•„ÅÆË®òÈå≤„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì</p>`;
        return;
    }
    
    let totalIncome = 0;
    let totalExpense = 0;
    
    dayRecords.forEach(record => {
        if (record.amount > 0) {
            totalIncome += record.amount;
        } else {
            totalExpense += Math.abs(record.amount);
        }
    });
    
    let html = `<h4>${month}Êúà${day}Êó•„ÅÆÂèéÊîØ (${dayRecords.length}‰ª∂)</h4>`;
    html += `<div class="daily-summary">ÂèéÂÖ•: +${totalIncome.toLocaleString()}ÂÜÜ / ÊîØÂá∫: -${totalExpense.toLocaleString()}ÂÜÜ</div>`;
    html += '<div class="daily-detail-list">';
    
    dayRecords.forEach(record => {
        const time = new Date(record.timestamp).toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' });
        const isIncome = record.amount > 0;
        html += `
            <div class="daily-detail-item ${isIncome ? 'income' : 'expense'}">
                <div class="daily-detail-time">${time}</div>
                <div class="daily-detail-content">
                    <div class="daily-detail-category">${record.category || (isIncome ? 'ÂèéÂÖ•' : 'ÊîØÂá∫')}</div>
                    <div class="daily-detail-text">${record.text}</div>
                    <div class="daily-detail-amount">${isIncome ? '+' : '-'}${Math.abs(record.amount).toLocaleString()}ÂÜÜ</div>
                </div>
            </div>
        `;
    });
    
    html += '</div>';
    container.innerHTML = html;
    
    container.scrollIntoView({ behavior: 'smooth' });
}
function renderActivityLogs() {
    const container = document.getElementById('activityLogs');
    const today = new Date().toLocaleDateString('ja-JP');
    const todayActivities = activities.filter(a => {
        const activityDate = new Date(a.startTime || a.timestamp).toLocaleDateString('ja-JP');
        return activityDate === today;
    });
    
    if (todayActivities.length === 0) {
        container.innerHTML = '<p style="color: #999;">Ë®òÈå≤„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>';
        return;
    }
    
    container.innerHTML = todayActivities.map(record => {
        const startTime = new Date(record.startTime || record.timestamp);
        const startTimeStr = startTime.toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' });
        
        // Á∂ôÁ∂ö‰∏≠„Åã„Å©„ÅÜ„ÅãÂà§ÂÆö
        const isOngoing = !record.endTime;
        
        let timeDisplay = '';
        let statusBadge = '';
        
        if (isOngoing) {
            // Á∂ôÁ∂ö‰∏≠„ÅÆÂ†¥Âêà
            const now = new Date();
            const elapsedMinutes = Math.round((now - startTime) / 1000 / 60);
            const hours = Math.floor(elapsedMinutes / 60);
            const minutes = elapsedMinutes % 60;
            const elapsedStr = hours > 0 ? `${hours}ÊôÇÈñì${minutes}ÂàÜ` : `${minutes}ÂàÜ`;
            
            timeDisplay = `${startTimeStr}„Äú (${elapsedStr}ÁµåÈÅé)`;
            statusBadge = '<span class="ongoing-badge">üü¢ Á∂ôÁ∂ö‰∏≠</span>';
        } else {
            // ÁµÇ‰∫ÜÊ∏à„Åø„ÅÆÂ†¥Âêà
            const endTime = new Date(record.endTime);
            const endTimeStr = endTime.toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' });
            const durationMinutes = record.durationMinutes || 0;
            const hours = Math.floor(durationMinutes / 60);
            const minutes = durationMinutes % 60;
            const durationStr = hours > 0 ? `${hours}ÊôÇÈñì${minutes}ÂàÜ` : `${minutes}ÂàÜ`;
            
            timeDisplay = `${startTimeStr}„Äú${endTimeStr} (${durationStr})`;
        }
        
        const categoryBadge = record.category && record.categoryEmoji 
            ? `<span class="category-badge">${record.categoryEmoji} ${record.category}</span>`
            : '';
        
        const actionButtons = isOngoing
            ? `<button onclick="endActivity(${record.id})" class="end-btn">‚èπÔ∏è ÁµÇ‰∫Ü</button>
               <button onclick="editActivity(${record.id})">‚úèÔ∏è Á∑®ÈõÜ</button>
               <button onclick="deleteActivity(${record.id})">üóëÔ∏è</button>`
            : `<button onclick="editActivity(${record.id})">‚úèÔ∏è Á∑®ÈõÜ</button>
               <button onclick="deleteActivity(${record.id})">üóëÔ∏è</button>`;
        
        return `
            <div class="log-item ${isOngoing ? 'ongoing' : ''}">
                <div class="log-header">
                    <strong>${record.text}</strong>
                    ${statusBadge}
                </div>
                <div class="log-info">
                    <span class="time-display">${timeDisplay}</span>
                    ${categoryBadge}
                </div>
                <div class="log-actions">
                    ${actionButtons}
                </div>
            </div>
        `;
    }).join('');
}

// Á∂ôÁ∂ö‰∏≠„ÅÆË®òÈå≤„ÇíÂÆöÊúüÁöÑ„Å´Êõ¥Êñ∞Ôºà1ÂàÜ„Åî„Å®Ôºâ
setInterval(() => {
    const hasOngoing = activities.some(a => !a.endTime);
    if (hasOngoing) {
        renderActivityLogs();
    }
}, 60000);


// Á∑®ÈõÜ‰∏≠„ÅÆË°åÂãïID
window.editingActivityId = null;

// Ë°åÂãï„ÇíÁ∑®ÈõÜÔºà„É¢„Éº„ÉÄ„É´ÁâàÔºâ
// „ÅäÈáëÁ∑®ÈõÜÊ©üËÉΩ
window.editingMoneyId = null;

function editMoney(id) {
    const record = window.moneyRecords.find(r => r.id === id);
    if (!record) {
        alert('Ë®òÈå≤„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
        return;
    }
    
    window.editingMoneyId = id;
    
    // „É¢„Éº„ÉÄ„É´„Å´ÁèæÂú®„ÅÆÂÄ§„ÇíË®≠ÂÆö
    document.getElementById('editMoneyText').value = record.text || '';
    document.getElementById('editMoneyAmount').value = record.amount || 0;
    
    // „Çø„Ç§„É†„Çπ„Çø„É≥„Éó„Çídatetime-localÂΩ¢Âºè„Å´Â§âÊèõ
    if (record.timestamp) {
        const date = new Date(record.timestamp);
        const formatted = formatDateTimeLocal(date);
        document.getElementById('editMoneyTimestamp').value = formatted;
    }
    
    // „Ç´„ÉÜ„Ç¥„É™„Çª„É¨„ÇØ„Éà„ÇíÁîüÊàê
    const categorySelect = document.getElementById('editMoneyCategory');
    const allCategories = [...(window.expenseCategories || []), ...(window.incomeCategories || [])];
    categorySelect.innerHTML = allCategories.map(cat => 
        `<option value="${cat.name}" ${record.category === cat.name ? 'selected' : ''}>
            ${cat.emoji} ${cat.name}
        </option>`
    ).join('');
    
    // „É¢„Éº„ÉÄ„É´„ÇíË°®Á§∫
    document.getElementById('editMoneyModal').style.display = 'flex';
}
window.editMoney = editMoney; // „Ç∞„É≠„Éº„Éê„É´„Å´ÊòéÁ§∫ÁöÑ„Å´ÂÖ¨Èñã

function closeEditMoneyModal() {
    document.getElementById('editMoneyModal').style.display = 'none';
    window.editingMoneyId = null;
}

window.closeEditMoneyModal = closeEditMoneyModal; // „Ç∞„É≠„Éº„Éê„É´„Å´ÊòéÁ§∫ÁöÑ„Å´ÂÖ¨Èñã
function saveMoneyEdit() {
    const record = window.moneyRecords.find(r => r.id === window.editingMoneyId);
    if (!record) {
        alert('Ë®òÈå≤„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
        return;
    }
    
    const text = document.getElementById('editMoneyText').value.trim();
    const amount = parseFloat(document.getElementById('editMoneyAmount').value);
    const categoryName = document.getElementById('editMoneyCategory').value;
    const timestamp = document.getElementById('editMoneyTimestamp').value;
    
    if (!text) {
        alert('‚ùå ÂÜÖÂÆπ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
        return;
    }
    
    if (isNaN(amount)) {
        alert('‚ùå ÊúâÂäπ„Å™ÈáëÈ°ç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
        return;
    }
    
    // „Ç´„ÉÜ„Ç¥„É™„ÅÆÁµµÊñáÂ≠ó„ÇíÂèñÂæó
    const allCategories = [...(window.expenseCategories || []), ...(window.incomeCategories || [])];
    const category = allCategories.find(c => c.name === categoryName);
    const categoryEmoji = category ? category.emoji : 'üí∞';
    
    // Êõ¥Êñ∞
    record.text = text;
    record.amount = amount;
    record.category = categoryName;
    record.categoryEmoji = categoryEmoji;
    
    if (timestamp) {
        record.timestamp = new Date(timestamp).toISOString();
    }
    
    // ‰øùÂ≠ò
    localStorage.setItem('moneyRecords', JSON.stringify(window.moneyRecords));
    
    // ÂÜçÊèèÁîª
    renderMoneyLogs();
    
    // „É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
    closeEditMoneyModal();
    
    showStatus('moneyStatus', '‚úì Ë®òÈå≤„ÇíÊõ¥Êñ∞„Åó„Åæ„Åó„Åü');
}

window.saveMoneyEdit = saveMoneyEdit; // „Ç∞„É≠„Éº„Éê„É´„Å´ÊòéÁ§∫ÁöÑ„Å´ÂÖ¨Èñã
function deleteMoney(id) {
    if (!confirm('„Åì„ÅÆË®òÈå≤„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')) {
        return;
    }
    
    window.moneyRecords = window.moneyRecords.filter(r => r.id !== id);
    localStorage.setItem('moneyRecords', JSON.stringify(window.moneyRecords));
    renderMoneyLogs();
    showStatus('moneyStatus', '‚úì Ë®òÈå≤„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü');
}

window.deleteMoney = deleteMoney; // „Ç∞„É≠„Éº„Éê„É´„Å´ÊòéÁ§∫ÁöÑ„Å´ÂÖ¨Èñã
function formatDateTimeLocal(date) {
    const year = date.getFullYear();
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const day = String(date.getDate()).padStart(2, '0');
    const hours = String(date.getHours()).padStart(2, '0');
    const minutes = String(date.getMinutes()).padStart(2, '0');
    return `${year}-${month}-${day}T${hours}:${minutes}`;
}
function editActivity(id) {
    const activity = activities.find(a => a.id === id);
    if (!activity) return;
    
    window.editingActivityId = id;
    
    // „Ç´„ÉÜ„Ç¥„É™„Çª„É¨„ÇØ„Éà„ÇíÁîüÊàê
    const categorySelect = document.getElementById('editActivityCategory');
    categorySelect.innerHTML = activityCategories.map((cat, idx) => 
        `<option value="${idx}" ${activity.category === cat.name ? 'selected' : ''}>
            ${cat.emoji} ${cat.name}
        </option>`
    ).join('');
    
    // ÂÜÖÂÆπ„Çí„Çª„ÉÉ„Éà
    document.getElementById('editActivityText').value = activity.text;
    
    // ÈñãÂßãÊôÇÂàª„Çí„Çª„ÉÉ„Éà
    const startTime = new Date(activity.startTime || activity.timestamp);
    document.getElementById('editActivityStartTime').value = formatDateTimeLocal(startTime);
    
    // ÁµÇ‰∫ÜÊôÇÂàª„Çí„Çª„ÉÉ„Éà
    if (activity.endTime) {
        const endTime = new Date(activity.endTime);
        document.getElementById('editActivityEndTime').value = formatDateTimeLocal(endTime);
    } else {
        document.getElementById('editActivityEndTime').value = '';
    }
    
    // „É¢„Éº„ÉÄ„É´„ÇíË°®Á§∫
    document.getElementById('editActivityModal').style.display = 'flex';
    
    // ÊâÄË¶ÅÊôÇÈñì„ÇíÊõ¥Êñ∞
    updateDurationDisplay();
}

// Êó•ÊôÇ„Çídatetime-localÂΩ¢Âºè„Å´Â§âÊèõ
function formatDateTimeLocal(date) {
    const year = date.getFullYear();
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const day = String(date.getDate()).padStart(2, '0');
    const hours = String(date.getHours()).padStart(2, '0');
    const minutes = String(date.getMinutes()).padStart(2, '0');
    return `${year}-${month}-${day}T${hours}:${minutes}`;
}

// Á∑®ÈõÜ„É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
function closeEditActivityModal() {
    document.getElementById('editActivityModal').style.display = 'none';
    window.editingActivityId = null;
}

// Á∑®ÈõÜ„Çí‰øùÂ≠ò
function saveEditActivity() {
    const activity = activities.find(a => a.id === window.editingActivityId);
    if (!activity) return;
    
    const text = document.getElementById('editActivityText').value.trim();
    const startTime = document.getElementById('editActivityStartTime').value;
    const endTime = document.getElementById('editActivityEndTime').value;
    const categoryIdx = parseInt(document.getElementById('editActivityCategory').value);
    
    if (!text) {
        alert('‚ùå ÂÜÖÂÆπ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
        return;
    }
    
    if (!startTime) {
        alert('‚ùå ÈñãÂßãÊôÇÂàª„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
        return;
    }
    
    // „Éá„Éº„Çø„ÇíÊõ¥Êñ∞
    activity.text = text;
    activity.category = activityCategories[categoryIdx].name;
    activity.categoryEmoji = activityCategories[categoryIdx].emoji;
    activity.startTime = new Date(startTime).toISOString();
    activity.timestamp = new Date(startTime).toISOString();
    
    if (endTime) {
        activity.endTime = new Date(endTime).toISOString();
        const duration = (new Date(endTime) - new Date(startTime)) / 1000 / 60;
        activity.durationMinutes = Math.max(0, Math.round(duration));
    } else {
        activity.endTime = null;
        activity.durationMinutes = 0;
    }
    
    // ‰øùÂ≠ò
    localStorage.setItem('activities', JSON.stringify(activities));
    
    // „É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
    closeEditActivityModal();
    
    // ÂÜç„É¨„É≥„ÉÄ„É™„É≥„Ç∞
    renderActivityLogs();
    
    alert('‚úì ‰øùÂ≠ò„Åó„Åæ„Åó„Åü');
}

// ÈñãÂßãÊôÇÂàª„Å´ÁèæÂú®ÊôÇÂàª„Çí„Çª„ÉÉ„Éà
function setCurrentTimeToStart() {
    const now = new Date();
    document.getElementById('editActivityStartTime').value = formatDateTimeLocal(now);
    updateDurationDisplay();
}

// ÁµÇ‰∫ÜÊôÇÂàª„Å´ÁèæÂú®ÊôÇÂàª„Çí„Çª„ÉÉ„Éà
function setCurrentTimeToEnd() {
    const now = new Date();
    document.getElementById('editActivityEndTime').value = formatDateTimeLocal(now);
    updateDurationDisplay();
}

// ÁµÇ‰∫ÜÊôÇÂàª„ÇíË™øÊï¥
function adjustEndTime(minutes) {
    const endTimeInput = document.getElementById('editActivityEndTime');
    let endTime;
    
    if (endTimeInput.value) {
        endTime = new Date(endTimeInput.value);
    } else {
        const startTime = new Date(document.getElementById('editActivityStartTime').value);
        endTime = new Date(startTime.getTime());
    }
    
    endTime.setMinutes(endTime.getMinutes() + minutes);
    endTimeInput.value = formatDateTimeLocal(endTime);
    
    updateDurationDisplay();
}

// ÊâÄË¶ÅÊôÇÈñì„ÇíÊõ¥Êñ∞
function updateDurationDisplay() {
    const startTime = document.getElementById('editActivityStartTime').value;
    const endTime = document.getElementById('editActivityEndTime').value;
    const durationSpan = document.getElementById('calculatedDuration');
    
    if (!startTime) {
        durationSpan.textContent = '--';
        return;
    }
    
    if (!endTime) {
        durationSpan.textContent = 'Á∂ôÁ∂ö‰∏≠';
        return;
    }
    
    const start = new Date(startTime);
    const end = new Date(endTime);
    const durationMinutes = Math.round((end - start) / 1000 / 60);
    
    if (durationMinutes < 0) {
        durationSpan.textContent = '‚ö†Ô∏è ÁµÇ‰∫ÜÊôÇÂàª„ÅåÈñãÂßãÊôÇÂàª„Çà„ÇäÂâç„Åß„Åô';
        durationSpan.style.color = 'red';
    } else {
        const hours = Math.floor(durationMinutes / 60);
        const minutes = durationMinutes % 60;
        
        if (hours > 0) {
            durationSpan.textContent = `${hours}ÊôÇÈñì${minutes}ÂàÜ`;
        } else {
            durationSpan.textContent = `${minutes}ÂàÜ`;
        }
        durationSpan.style.color = '#000';
    }
}

// ÂÖ•Âäõ„Éï„Ç£„Éº„É´„Éâ„ÅÆÂ§âÊõ¥„ÇíÁõ£Ë¶ñ
document.addEventListener('DOMContentLoaded', () => {
    const startTimeInput = document.getElementById('editActivityStartTime');
    const endTimeInput = document.getElementById('editActivityEndTime');
    
    if (startTimeInput) startTimeInput.addEventListener('input', updateDurationDisplay);
    if (endTimeInput) endTimeInput.addEventListener('input', updateDurationDisplay);
});
        function deleteActivity(id) {
            if (confirm('„Åì„ÅÆË°åÂãï„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')) {
                activities = activities.filter(a => a.id !== id);
                localStorage.setItem('activities', JSON.stringify(activities));
                renderActivityLogs();
            }
        }
        
        // „É≠„Ç∞Ë°®Á§∫Ôºö„ÅäÈáë
function renderMoneyLogs() {
    console.log("üîç renderMoneyLogs „Éá„Éê„ÉÉ„Ç∞");
    const moneyRecords = window.moneyRecords || [];
    console.log("moneyRecords ÂÖ®‰ª∂Êï∞:", moneyRecords.length);
    console.log("‰ªäÊó•„ÅÆÊó•‰ªò:", new Date().toLocaleDateString('ja-JP'));
    const todayRecords = moneyRecords.filter(m => new Date(m.timestamp).toLocaleDateString('ja-JP') === new Date().toLocaleDateString('ja-JP'));
    console.log("‰ªäÊó•„ÅÆË®òÈå≤:", todayRecords);
    const container = document.getElementById('moneyLogs');
    const today = new Date().toLocaleDateString('ja-JP');
    const todayMoney = moneyRecords.filter(m => 
        new Date(m.timestamp).toLocaleDateString('ja-JP') === today
    );
    
    if (todayMoney.length === 0) {
        container.innerHTML = '<div class="log-item">Ë®òÈå≤„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</div>';
        return;
    }
    
    const total = todayMoney.reduce((sum, r) => sum + r.amount, 0);
    
    container.innerHTML = `
        <div class="log-item" style="background: ${total >= 0 ? '#f0f8ff' : '#fff5f5'};">
            <strong>‰ªäÊó•„ÅÆÂèéÊîØ: ¬•${total.toLocaleString()}</strong>
        </div>
    ` + todayMoney.map(record => {
        const categoryText = record.categoryEmoji ? 
            `${record.categoryEmoji} ${record.category}` : 
            (record.category || '');
        
        return `
            <div class="log-item">
                <div style="display: flex; justify-content: space-between; align-items: start;">
                    <div style="flex: 1;">
                        <strong>${record.text}</strong> - ¬•${record.amount.toLocaleString()}
                        ${categoryText ? `<br><span class="category-badge">${categoryText}</span>` : ''}
                        <br>
                        <small>${new Date(record.timestamp).toLocaleTimeString('ja-JP', {hour: '2-digit', minute: '2-digit'})}</small>
                    </div>
                    <div style="display: flex; gap: 5px;">
                        <button class="btn-icon" onclick="editMoney(${record.id})" title="Á∑®ÈõÜ">‚úèÔ∏è</button>
                        <button class="btn-icon" onclick="deleteMoney(${record.id})" title="ÂâäÈô§">üóëÔ∏è</button>
                    </div>
                </div>
            </div>
        `;
    }).join('');
}
        
        // „É≠„Ç∞Ë°®Á§∫Ôºö‰ΩìÈáç
        function renderWeightLogs() {
            const container = document.getElementById('weightLogs');
            if (weightRecords.length === 0) {
                container.innerHTML = '<div class="log-item">Ë®òÈå≤„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</div>';
                return;
            }
            
            const recent = weightRecords.slice(0, 10);
            container.innerHTML = recent.map(record => `
                <div class="log-item">
                    <strong>${record.weight} kg</strong>
                    <br>
                    <small>${new Date(record.timestamp).toLocaleString('ja-JP', {month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit'})}</small>
                </div>
            `).join('');
        }
        
        // „É≠„Ç∞Ë°®Á§∫Ôºö„Ç∏„É£„Éº„Éä„É´
// ÊîπÂñÑÁâà„Ç∏„É£„Éº„Éä„É´„É≠„Ç∞Ë°®Á§∫
function renderJournalLogs() {
    const container = document.getElementById('journalLogs');
    const journals = JSON.parse(localStorage.getItem('journals') || '[]');
    
    if (journals.length === 0) {
        container.innerHTML = '<div class="log-item">Ë®òÈå≤„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</div>';
        return;
    }
    
    const recent = journals.slice(0, 10);
    container.innerHTML = recent.map(record => {
        const date = new Date(record.timestamp);
        const dateStr = date.toLocaleDateString('ja-JP', {
            year: 'numeric',
            month: 'long',
            day: 'numeric',
            weekday: 'short'
        });
        
        // Ê∞óÂàÜ„ÅÆÁµµÊñáÂ≠ó
        const moodEmojis = {
            'great': 'üòä',
            'good': 'üôÇ',
            'normal': 'üòê',
            'bad': 'üòî',
            'terrible': 'üò¢'
        };
        const moodEmoji = moodEmojis[record.mood] || 'üòê';
        
        // AIÂàÜÊûêÁµêÊûú„Çí‰ΩøÁî®Ôºà„Åæ„Åü„ÅØÁ©∫„ÅÆ„Ç™„Éñ„Ç∏„Çß„ÇØ„ÉàÔºâ
        const summary = record.aiAnalysis || { good: [], more: [], worry: [], task: [] };
        
        // Ë¶ÅÁ¥Ñ„ÅåÁ©∫„Åß„Å™„ÅÑ„Åã„ÉÅ„Çß„ÉÉ„ÇØ
        const hasGood = summary.good && summary.good.length > 0;
        const hasMore = summary.more && summary.more.length > 0;
        const hasWorry = summary.worry && summary.worry.length > 0;
        const hasTask = summary.task && summary.task.length > 0;
        
        const hasSummary = hasGood || hasMore || hasWorry || hasTask;
        
        return `
            <div class="journal-log-item">
                <div class="journal-log-header" onclick="toggleJournalDetail('journal-${record.id}')">
                    <div class="journal-date">
                        ${moodEmoji} ${dateStr}
                    </div>
                    <span class="toggle-icon">‚ñº</span>
                </div>
                
                ${hasSummary ? `
                <div class="journal-summary-preview">
                    ${hasGood ? `
                        <div class="summary-preview-item">
                            <span class="summary-label-mini">üòä Good</span>
                            <div class="summary-items">
                                ${summary.good.slice(0, 2).map(item => 
                                    `<div class="summary-bullet">‚Ä¢ ${item}</div>`
                                ).join('')}
                                ${summary.good.length > 2 ? 
                                    `<div class="summary-more">‰ªñ${summary.good.length - 2}‰ª∂</div>` 
                                    : ''}
                            </div>
                        </div>
                    ` : ''}
                    
                    ${hasWorry ? `
                        <div class="summary-preview-item">
                            <span class="summary-label-mini">ü§î ÊÇ©„Åø</span>
                            <div class="summary-items">
                                ${summary.worry.slice(0, 2).map(item => 
                                    `<div class="summary-bullet">‚Ä¢ ${item}</div>`
                                ).join('')}
                                ${summary.worry.length > 2 ? 
                                    `<div class="summary-more">‰ªñ${summary.worry.length - 2}‰ª∂</div>` 
                                    : ''}
                            </div>
                        </div>
                    ` : ''}
                    
                    ${hasTask ? `
                        <div class="summary-preview-item">
                            <span class="summary-label-mini">‚úÖ „Çø„Çπ„ÇØ</span>
                            <div class="summary-items">
                                ${summary.task.slice(0, 2).map(item => 
                                    `<div class="summary-bullet">‚Ä¢ ${item}</div>`
                                ).join('')}
                                ${summary.task.length > 2 ? 
                                    `<div class="summary-more">‰ªñ${summary.task.length - 2}‰ª∂</div>` 
                                    : ''}
                            </div>
                        </div>
                    ` : ''}
                </div>
                ` : ''}
                
                <div id="journal-${record.id}" class="journal-detail">
                    <div class="journal-full-text">
                        <strong>üìÑ ÂÖ®Êñá:</strong>
                        <div style="white-space: pre-wrap; margin-top: 10px; line-height: 1.6;">
                            ${record.text}
                        </div>
                    </div>
                    
                    ${hasSummary ? `
                    <div class="journal-full-summary">
                        <strong>üìù Ë©≥Á¥∞„Å™Ë¶ÅÁ¥Ñ:</strong>
                        
                        ${hasGood ? `
                            <div class="summary-detail-section">
                                <div class="summary-detail-label">üòä GoodÔºàËâØ„Åã„Å£„Åü„Åì„Å®Ôºâ</div>
                                ${summary.good.map(item => 
                                    `<div class="summary-detail-item">‚Ä¢ ${item}</div>`
                                ).join('')}
                            </div>
                        ` : ''}
                        
                        ${hasMore ? `
                            <div class="summary-detail-section">
                                <div class="summary-detail-label">üìà MoreÔºà„ÇÇ„Å£„Å®ËâØ„Åè„Åß„Åç„Çã„Åì„Å®Ôºâ</div>
                                ${summary.more.map(item => 
                                    `<div class="summary-detail-item">‚Ä¢ ${item}</div>`
                                ).join('')}
                            </div>
                        ` : ''}
                        
                        ${hasWorry ? `
                            <div class="summary-detail-section">
                                <div class="summary-detail-label">ü§î ÊÇ©„Çì„Åß„ÅÑ„Çã„Åì„Å®</div>
                                ${summary.worry.map(item => 
                                    `<div class="summary-detail-item">‚Ä¢ ${item}</div>`
                                ).join('')}
                            </div>
                        ` : ''}
                        
                        ${hasTask ? `
                            <div class="summary-detail-section">
                                <div class="summary-detail-label">‚úÖ ÊòéÊó•„ÅÆ„Çø„Çπ„ÇØ</div>
                                ${summary.task.map(item => 
                                    `<div class="summary-detail-item">‚Ä¢ ${item}</div>`
                                ).join('')}
                            </div>
                        ` : ''}
                    </div>
                    ` : ''}
                </div>
            </div>
        `;
    }).join('');
}

function toggleJournalDetail(id) {
    const element = document.getElementById(id);
    const parent = element.closest('.journal-log-item');
    const icon = parent.querySelector('.toggle-icon');
    
    if (element.classList.contains('show')) {
        element.classList.remove('show');
        icon.textContent = '‚ñº';
    } else {
        element.classList.add('show');
        icon.textContent = '‚ñ≤';
    }
}
        
        // „Ç´„É¨„É≥„ÉÄ„ÉºË°®Á§∫
// „É™„ÉÉ„ÉÅ„É¨„Éù„Éº„ÉàÊ©üËÉΩ

// ÂàùÊúüÂåñ: ‰ªäÊúà„Çí„Éá„Éï„Ç©„É´„ÉàË®≠ÂÆö
function initializeReportMonths() {
    const now = new Date();
    const currentMonth = now.toISOString().substring(0, 7); // YYYY-MM
    document.getElementById('activityReportMonthDisplay').value = currentMonth;
    document.getElementById('moneyReportMonthDisplay').value = currentMonth;
}

// Ë°åÂãï„É¨„Éù„Éº„ÉàÁîüÊàê
function generateActivityReport() {
    const month = document.getElementById('activityReportMonthDisplay').value;
    if (!month) {
        alert('ÊúüÈñì„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
        return;
    }
    
    const [year, monthNum] = month.split('-');
    const startDate = new Date(year, monthNum - 1, 1);
    const endDate = new Date(year, monthNum, 0, 23, 59, 59);
    
    // ÊúüÈñìÂÜÖ„ÅÆ„Ç¢„ÇØ„ÉÜ„Ç£„Éì„ÉÜ„Ç£„Çí„Éï„Ç£„É´„Çø„Éº
    const filteredActivities = activities.filter(a => {
        const actDate = new Date(a.timestamp);
        return actDate >= startDate && actDate <= endDate;
    });
    
    if (filteredActivities.length === 0) {
        document.getElementById('activityReportContent').innerHTML = '<p style="text-align:center; color:#999;">„Åì„ÅÆÊúüÈñì„Å´Ë®òÈå≤„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>';
        document.getElementById('activityChartCanvas').style.display = 'none';
        return;
    }
    
    // „Ç´„ÉÜ„Ç¥„É™Âà•„Å´ÈõÜË®à
    const categoryData = {};
    
    filteredActivities.forEach(activity => {
        const cat = activity.category || 'Êú™ÂàÜÈ°û';
        const emoji = activity.categoryEmoji || 'üìã';
        
        if (!categoryData[cat]) {
            categoryData[cat] = {
                emoji: emoji,
                totalMinutes: 0,
                count: 0,
                details: []
            };
        }
        
        // ÊâÄË¶ÅÊôÇÈñìË®àÁÆó
        let minutes = 0;
        if (activity.endTime && activity.startTime) {
            const start = new Date(activity.startTime);
            const end = new Date(activity.endTime);
            minutes = Math.round((end - start) / 60000);
        }
        
        categoryData[cat].totalMinutes += minutes;
        categoryData[cat].count += 1;
        categoryData[cat].details.push({
            text: activity.text,
            startTime: activity.startTime,
            endTime: activity.endTime,
            minutes: minutes
        });
    });
    
    // HTMLÁîüÊàê
    let html = '';
    let totalMinutes = 0;
    let totalCount = 0;
    
    const sortedCategories = Object.keys(categoryData).sort((a, b) => 
        categoryData[b].totalMinutes - categoryData[a].totalMinutes
    );
    
    sortedCategories.forEach(cat => {
        const data = categoryData[cat];
        const hours = Math.floor(data.totalMinutes / 60);
        const mins = data.totalMinutes % 60;
        
        totalMinutes += data.totalMinutes;
        totalCount += data.count;
        
        html += `
            <div class="category-summary" onclick="toggleCategoryDetail('activity-${cat}')">
                <div class="category-header">
                    <span>${data.emoji} ${cat}</span>
                    <span>‚ñº</span>
                </div>
                <div class="category-stats">
                    <span>‚è±Ô∏è ${hours}ÊôÇÈñì${mins}ÂàÜ</span>
                    <span>üìù ${data.count}Âõû</span>
                </div>
                <div id="activity-${cat}" class="category-details">
                    ${data.details.sort((a, b) => new Date(b.startTime) - new Date(a.startTime)).map(detail => {
                        const start = detail.startTime ? new Date(detail.startTime).toLocaleString('ja-JP', { month: 'numeric', day: 'numeric', hour: '2-digit', minute: '2-digit' }) : '-';
                        const end = detail.endTime ? new Date(detail.endTime).toLocaleString('ja-JP', { hour: '2-digit', minute: '2-digit' }) : 'Á∂ôÁ∂ö‰∏≠';
                        const durationText = detail.endTime ? `${Math.floor(detail.minutes / 60)}ÊôÇÈñì${detail.minutes % 60}ÂàÜ` : 'Á∂ôÁ∂ö‰∏≠';
                        
                        return `
                            <div class="detail-item">
                                <strong>${detail.text}</strong>
                                <div>${start} „Äú ${end} (${durationText})</div>
                            </div>
                        `;
                    }).join('')}
                </div>
            </div>
        `;
    });
    
    const totalHours = Math.floor(totalMinutes / 60);
    const totalMins = totalMinutes % 60;
    
    html = `
        <div class="total-summary">
            üìä ÂêàË®à: ${totalHours}ÊôÇÈñì${totalMins}ÂàÜ / ${totalCount}Âõû„ÅÆË®òÈå≤
        </div>
    ` + html;
    
    document.getElementById('activityReportContent').innerHTML = html;
    
    // „Ç∞„É©„ÉïÊèèÁîª
    drawActivityChart(categoryData);
}

// „ÅäÈáë„É¨„Éù„Éº„ÉàÁîüÊàê
// ‰ªäÊúà„ÅÆÁõÆÊ®ôÊ©üËÉΩ
let monthlyGoals = JSON.parse(localStorage.getItem('monthlyGoals')) || [];


// ÁõÆÊ®ô„ÅÆÊúàÈÅ∏ÊäûÊ©üËÉΩ
let selectedGoalsMonth = new Date().toISOString().substring(0, 7); // YYYY-MM

function changeGoalsMonth(offset) {
    const [year, month] = selectedGoalsMonth.split('-').map(Number);
    const date = new Date(year, month - 1 + offset, 1);
    selectedGoalsMonth = date.toISOString().substring(0, 7);
    
    updateGoalsMonthDisplay();
    renderGoals();
    renderGoalsProgress();
}

function updateGoalsMonthDisplay() {
    const [year, month] = selectedGoalsMonth.split('-').map(Number);
    const monthNames = ['1Êúà', '2Êúà', '3Êúà', '4Êúà', '5Êúà', '6Êúà', 
                        '7Êúà', '8Êúà', '9Êúà', '10Êúà', '11Êúà', '12Êúà'];
    
    const display = document.getElementById('currentGoalsMonth');
    display.textContent = `${year}Âπ¥${monthNames[month - 1]}`;
    
    // Month filtering now uses selectedGoalsMonth
    const title = document.getElementById('goalsListTitle');
    if (selectedGoalsMonth === currentMonth) {
        title.textContent = '‰ªäÊúà„ÅÆÁõÆÊ®ô„É™„Çπ„Éà';
    } else {
        title.textContent = `${year}Âπ¥${monthNames[month - 1]}„ÅÆÁõÆÊ®ô„É™„Çπ„Éà`;
    }
}
function addGoal() {
    console.log('üéØ addGoal Âëº„Å≥Âá∫„Åó');
    
    const input = document.getElementById('goalInput');
    const categorySelect = document.getElementById('goalCategory');
    const text = input.value.trim();
    const category = categorySelect.value;
    
    console.log('ÂÖ•ÂäõÂÄ§:', { text, category });
    
    if (!text) {
        showStatus('goalStatus', '‚ùå ÁõÆÊ®ô„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
        return;
    }
    
    console.log('ÁèæÂú®„ÅÆ selectedGoalsMonth:', selectedGoalsMonth);
    console.log('monthlyGoals „ÅÆÈï∑„ÅïÔºàËøΩÂä†ÂâçÔºâ:', monthlyGoals.length);
    
    const goal = {
        id: Date.now(),
        text: text,
        category: category,
        createdAt: new Date().toISOString(),
        month: selectedGoalsMonth, // Ë°®Á§∫‰∏≠„ÅÆÊúà„Å´ËøΩÂä†
        currentLevel: 0,  // üÜï ÁèæÂú®„ÅÆÈÄ≤Êçó„É¨„Éô„É´ (0-10)
        progress: [],     // üÜï ÈÄ≤ÊçóÂ±•Ê≠¥
        completed: false  // ÂæåÊñπ‰∫íÊèõÊÄß„ÅÆ„Åü„ÇÅÊÆã„Åô
    };
    
    console.log('‰ΩúÊàê„Åó„ÅüÁõÆÊ®ô:', goal);
    
    monthlyGoals.unshift(goal);
    localStorage.setItem('monthlyGoals', JSON.stringify(monthlyGoals));
    
    console.log('monthlyGoals „ÅÆÈï∑„ÅïÔºàËøΩÂä†ÂæåÔºâ:', monthlyGoals.length);
    console.log('localStorage „Å´‰øùÂ≠ò„Åó„Åæ„Åó„Åü');
    
    input.value = '';
    
    console.log('renderGoals „ÇíÂëº„Å≥Âá∫„Åó„Åæ„Åô');
    renderGoals();
    
    showStatus('goalStatus', '‚úì ÁõÆÊ®ô„ÇíËøΩÂä†„Åó„Åæ„Åó„Åü');
    console.log('‚úÖ addGoal ÂÆå‰∫Ü');
}

function toggleGoalComplete(id) {
    const goal = monthlyGoals.find(g => g.id === id);
    if (goal) {
        goal.completed = !goal.completed;
        localStorage.setItem('monthlyGoals', JSON.stringify(monthlyGoals));
        renderGoals();
        generateGoalsFeedback();
    }
}

function deleteGoal(id) {
    if (!confirm('„Åì„ÅÆÁõÆÊ®ô„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')) return;
    
    monthlyGoals = monthlyGoals.filter(g => g.id !== id);
    localStorage.setItem('monthlyGoals', JSON.stringify(monthlyGoals));
    renderGoals();
    showStatus('goalStatus', '‚úì ÁõÆÊ®ô„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü');
}

// ÈÄ≤Êçó„Éê„Éº„ÇíÁîüÊàê„Åô„ÇãÈñ¢Êï∞
function renderProgressBar(level) {
    const filled = '‚ñ†'.repeat(level);
    const empty = '‚ñ°'.repeat(10 - level);
    const percentage = level * 10;
    
    return `
        <div class="progress-bar-container">
            <div class="progress-bar-visual">${filled}${empty}</div>
            <div class="progress-bar-text">${level}/10 (${percentage}%)</div>
        </div>
    `;
}

// ÈÄ≤ÊçóÂ±•Ê≠¥„ÇíË°®Á§∫„Åô„ÇãÈñ¢Êï∞
function renderProgressHistory(goal) {
    if (!goal.progress || goal.progress.length === 0) {
        return '<div class="empty-state">„Åæ„Å†ÈÄ≤Êçó„ÅåË®òÈå≤„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì</div>';
    }
    
    return goal.progress.map(entry => {
        const date = new Date(entry.timestamp);
        const dateStr = date.toLocaleDateString('ja-JP', { month: 'short', day: 'numeric' });
        const timeStr = date.toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' });
        
        return `
            <div class="progress-history-item">
                <div class="progress-history-header">
                    <span class="progress-level-badge">Lv.${entry.level}</span>
                    <span class="progress-date">${dateStr} ${timeStr}</span>
                </div>
                <div class="progress-comment">${entry.comment || 'Ôºà„Ç≥„É°„É≥„Éà„Å™„ÅóÔºâ'}</div>
            </div>
        `;
    }).join('');
}

// ÁõÆÊ®ô„Å´ÈÄ≤Êçó„ÇíËøΩÂä†„Åô„ÇãÈñ¢Êï∞
function addProgressToGoal(goalId, level, comment) {
    const goal = monthlyGoals.find(g => g.id === goalId);
    if (!goal) {
        console.error('ÁõÆÊ®ô„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì:', goalId);
        return;
    }
    
    // ÈÄ≤Êçó„É¨„Éô„É´„ÅÆ„Éê„É™„Éá„Éº„Ç∑„Éß„É≥
    if (level < 0 || level > 10) {
        showStatus('goalStatus', '‚ùå ÈÄ≤Êçó„É¨„Éô„É´„ÅØ0„Äú10„ÅÆÁØÑÂõ≤„ÅßÊåáÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
        return;
    }
    
    // ÈÄ≤Êçó„Éá„Éº„Çø„Çí‰ΩúÊàê
    const progressEntry = {
        date: new Date().toISOString().substring(0, 10), // YYYY-MM-DD
        level: parseInt(level),
        comment: comment.trim(),
        timestamp: new Date().toISOString()
    };
    
    // progress ÈÖçÂàó„ÅåÂ≠òÂú®„Åó„Å™„ÅÑÂ†¥Âêà„ÅØÂàùÊúüÂåñÔºàÂæåÊñπ‰∫íÊèõÊÄßÔºâ
    if (!goal.progress) {
        goal.progress = [];
    }
    
    // ÈÄ≤Êçó„ÇíËøΩÂä†
    goal.progress.unshift(progressEntry);
    
    // ÁèæÂú®„ÅÆ„É¨„Éô„É´„ÇíÊõ¥Êñ∞
    goal.currentLevel = parseInt(level);
    
    // „É¨„Éô„É´10„ÅßËá™ÂãïÁöÑ„Å´ÂÆå‰∫ÜÊâ±„ÅÑ
    if (level === 10) {
        goal.completed = true;
    }
    
    // ‰øùÂ≠ò
    localStorage.setItem('monthlyGoals', JSON.stringify(monthlyGoals));
    
    // ÂÜçÊèèÁîª
    renderGoals();
    
    console.log('‚úÖ ÈÄ≤Êçó„ÇíË®òÈå≤„Åó„Åæ„Åó„Åü:', progressEntry);
    showStatus('goalStatus', '‚úì ÈÄ≤Êçó„ÇíË®òÈå≤„Åó„Åæ„Åó„Åü');
}

// ÈÄ≤Êçó„ÇíË®òÈå≤„Åô„Çã„Éú„Çø„É≥„ÅÆ„Éè„É≥„Éâ„É©„Éº
function recordProgress(goalId) {
    const levelSelect = document.getElementById(`level-${goalId}`);
    const commentInput = document.getElementById(`comment-${goalId}`);
    
    const level = parseInt(levelSelect.value);
    const comment = commentInput.value.trim();
    
    if (!comment) {
        alert('„Ç≥„É°„É≥„Éà„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
        return;
    }
    
    addProgressToGoal(goalId, level, comment);
    
    // ÂÖ•ÂäõÊ¨Ñ„Çí„ÇØ„É™„Ç¢
    commentInput.value = '';
}

function renderGoals() {
    console.log('üìä renderGoals Âëº„Å≥Âá∫„Åó');
    console.log('monthlyGoals ÂÖ®‰Ωì:', monthlyGoals);
    console.log('selectedGoalsMonth:', selectedGoalsMonth);
    
    const container = document.getElementById('goalsList');
    console.log('container:', container);
    
    if (!container) {
        console.error('‚ùå goalsList „ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„ÇìÔºÅ');
        return;
    }
    
    const currentGoals = monthlyGoals.filter(g => g.month === selectedGoalsMonth);
    console.log('ÁèæÂú®„ÅÆÊúà„ÅÆÁõÆÊ®ôÊï∞:', currentGoals.length);
    console.log('„Éï„Ç£„É´„ÇøÂæå„ÅÆÁõÆÊ®ô:', currentGoals);
    
    if (currentGoals.length === 0) {
        const isCurrentMonth = selectedGoalsMonth === new Date().toISOString().substring(0, 7);
        container.innerHTML = `<div class="empty-state">${isCurrentMonth ? '‰ªäÊúà' : 'ÈÅ∏Êäû„Åó„ÅüÊúà'}„ÅÆÁõÆÊ®ô„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</div>`;
        console.log('ÁõÆÊ®ô„Å™„Åó ‚Üí empty-state „ÇíË°®Á§∫');
        renderGoalsProgress();
        return;
    }
    
    console.log('ÁõÆÊ®ô„ÇíÊèèÁîª„Åó„Åæ„Åô:', currentGoals.length, '‰ª∂');
    
    container.innerHTML = currentGoals.map(goal => {
        const categoryEmoji = {
            'ÂÅ•Â∫∑': 'üí™', '‰ªï‰∫ã': 'üíº', 'ÂãâÂº∑': 'üìö',
            'Ë∂£Âë≥': 'üé®', '‰∫∫ÈñìÈñ¢‰øÇ': 'üë•', '„ÅäÈáë': 'üí∞', '„Åù„ÅÆ‰ªñ': 'üìå'
        }[goal.category] || 'üìå';
        
        // ÂæåÊñπ‰∫íÊèõÊÄß: currentLevel „ÅåÊú™ÂÆöÁæ©„ÅÆÂ†¥Âêà„ÅØ0
        const level = goal.currentLevel !== undefined ? goal.currentLevel : 0;
        
        return `
            <div class="goal-card">
                <div class="goal-card-header">
                    <div class="goal-title">
                        <span class="goal-emoji">${categoryEmoji}</span>
                        <span class="goal-text">${goal.text}</span>
                    </div>
                    <button class="btn-icon-small" onclick="deleteGoal(${goal.id})" title="ÂâäÈô§">üóëÔ∏è</button>
                </div>
                
                <!-- ÈÄ≤Êçó„Éê„Éº -->
                ${renderProgressBar(level)}
                
                <!-- ÈÄ≤ÊçóÂÖ•Âäõ„Éï„Ç©„Éº„É† -->
                <div class="progress-input-section">
                    <div class="progress-input-row">
                        <select id="level-${goal.id}" class="level-select">
                            ${Array.from({length: 11}, (_, i) => 
                                `<option value="${i}" ${i === level ? 'selected' : ''}>Lv.${i}</option>`
                            ).join('')}
                        </select>
                        <input type="text" 
                               id="comment-${goal.id}" 
                               class="comment-input" 
                               placeholder="„Ç≥„É°„É≥„Éà„ÇíÂÖ•Âäõ..."
                               maxlength="100" />
                        <button class="btn-record" onclick="recordProgress(${goal.id})">üì§</button>
                    </div>
                </div>
                
                <!-- ÈÄ≤ÊçóÂ±•Ê≠¥ -->
                <details class="progress-history-details">
                    <summary class="progress-history-summary">üìä ÈÄ≤ÊçóÂ±•Ê≠¥„ÇíË°®Á§∫</summary>
                    <div class="progress-history-content">
                        ${renderProgressHistory(goal)}
                    </div>
                </details>
            </div>
        `;
    }).join('');
    
    console.log('‚úÖ ÁõÆÊ®ô„ÅÆÊèèÁîªÂÆå‰∫Ü');
    renderGoalsProgress();
}
function renderGoalsProgress() {
    const container = document.getElementById('goalsProgress');
    const currentGoals = monthlyGoals.filter(g => g.month === selectedGoalsMonth);
    
    if (currentGoals.length === 0) {
        container.innerHTML = '<div class="empty-state">ÁõÆÊ®ô„ÇíË®≠ÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑ</div>';
        return;
    }
    
    const completed = currentGoals.filter(g => g.completed).length;
    const total = currentGoals.length;
    const percentage = Math.round((completed / total) * 100);
    
    // „Ç´„ÉÜ„Ç¥„É™Âà•„ÅÆÈÅîÊàêÁä∂Ê≥Å
    const categoryStats = {};
    currentGoals.forEach(goal => {
        if (!categoryStats[goal.category]) {
            categoryStats[goal.category] = { total: 0, completed: 0 };
        }
        categoryStats[goal.category].total++;
        if (goal.completed) {
            categoryStats[goal.category].completed++;
        }
    });
    
    let html = `
        <div class="progress-summary">
            <div class="progress-bar-container">
                <div class="progress-bar" style="width: ${percentage}%"></div>
            </div>
            <div class="progress-text">
                ${completed} / ${total} ÈÅîÊàê (${percentage}%)
            </div>
        </div>
        
        <div class="category-progress">
            <h4>„Ç´„ÉÜ„Ç¥„É™Âà•ÈÅîÊàêÁä∂Ê≥Å</h4>
            ${Object.entries(categoryStats).map(([category, stats]) => {
                const catEmoji = {
                    'ÂÅ•Â∫∑': 'üí™', '‰ªï‰∫ã': 'üíº', 'ÂãâÂº∑': 'üìö',
                    'Ë∂£Âë≥': 'üé®', '‰∫∫ÈñìÈñ¢‰øÇ': 'üë•', '„ÅäÈáë': 'üí∞', '„Åù„ÅÆ‰ªñ': 'üìå'
                }[category] || 'üìå';
                const catPercentage = Math.round((stats.completed / stats.total) * 100);
                
                return `
                    <div class="category-stat">
                        <span>${catEmoji} ${category}</span>
                        <span>${stats.completed}/${stats.total} (${catPercentage}%)</span>
                    </div>
                `;
            }).join('')}
        </div>
    `;
    
    container.innerHTML = html;
}

function generateGoalsFeedback() {
    // Month filtering now uses selectedGoalsMonth
    const currentGoals = monthlyGoals.filter(g => g.month === selectedGoalsMonth);
    
    if (currentGoals.length === 0) {
        document.getElementById('goalsFeedback').innerHTML = 
            '<p>ÁõÆÊ®ô„ÇíË®≠ÂÆö„Åô„Çã„Å®„ÄÅAI„Åå„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ„ÇíÊèê‰æõ„Åó„Åæ„Åô„ÄÇ</p>';
        return;
    }
    
    // ‰ªäÊúà„ÅÆË°åÂãïË®òÈå≤„ÇíÂèñÂæó
    const [year, month] = currentMonth.split('-');
    const startDate = new Date(year, month - 1, 1);
    const endDate = new Date(year, month, 0, 23, 59, 59);
    
    const monthActivities = activities.filter(a => {
        const actDate = new Date(a.timestamp);
        return actDate >= startDate && actDate <= endDate;
    });
    
    // ‰ªäÊúà„ÅÆ„Ç∏„É£„Éº„Éä„É´„ÇíÂèñÂæó
    const monthJournals = journals.filter(j => {
        const jDate = new Date(j.timestamp);
        return jDate >= startDate && jDate <= endDate;
    });
    
    // „Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØÁîüÊàê
    let feedback = '<div class="feedback-content">';
    
    // ÂÖ®‰ΩìÁöÑ„Å™ÈÅîÊàêÂ∫¶
    const completed = currentGoals.filter(g => g.completed).length;
    const total = currentGoals.length;
    const percentage = Math.round((completed / total) * 100);
    
    if (percentage >= 80) {
        feedback += `<p>üéâ <strong>Á¥†Êô¥„Çâ„Åó„ÅÑÔºÅ</strong> ${percentage}%„ÅÆÁõÆÊ®ô„ÇíÈÅîÊàê„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ„Åì„ÅÆË™øÂ≠ê„ÅßÈ†ëÂºµ„Çä„Åæ„Åó„Çá„ÅÜÔºÅ</p>`;
    } else if (percentage >= 50) {
        feedback += `<p>üëç <strong>ËâØ„ÅÑ„Éö„Éº„Çπ„Åß„ÅôÔºÅ</strong> ${percentage}%„ÅÆÁõÆÊ®ô„ÇíÈÅîÊàêÊ∏à„Åø„ÄÇÊÆã„Çä„ÅÆÁõÆÊ®ô„ÇÇÈÅîÊàê„Åß„Åç„Çã„Çà„ÅÜÈ†ëÂºµ„Çä„Åæ„Åó„Çá„ÅÜ„ÄÇ</p>`;
    } else if (percentage >= 20) {
        feedback += `<p>üí™ <strong>„Åæ„Å†ÊôÇÈñì„Åå„ÅÇ„Çä„Åæ„ÅôÔºÅ</strong> ${percentage}%„ÅÆÈÅîÊàêÁéá„ÄÇÊÆã„Çä„ÅÆÊó•Êï∞„ÅßÁõÆÊ®ôÈÅîÊàê„ÇíÁõÆÊåá„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ</p>`;
    } else {
        feedback += `<p>‚ö†Ô∏è <strong>„Éö„Éº„Çπ„Ç¢„ÉÉ„Éó„ÅåÂøÖË¶Å„Åß„Åô</strong> ÁèæÂú®„ÅÆÈÅîÊàêÁéá„ÅØ${percentage}%„Åß„Åô„ÄÇÁõÆÊ®ô„ÇíË¶ãÁõ¥„Åô„Åã„ÄÅË°åÂãï„ÇíÂ¢ó„ÇÑ„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ</p>`;
    }
    
    // „Ç´„ÉÜ„Ç¥„É™Âà•„ÅÆÂàÜÊûê
    currentGoals.forEach(goal => {
        if (goal.completed) return;
        
        const relatedActivities = monthActivities.filter(a => 
            a.category === goal.category || 
            a.text.toLowerCase().includes(goal.text.toLowerCase().split(' ')[0])
        );
        
        const relatedJournals = monthJournals.filter(j =>
            j.text.toLowerCase().includes(goal.text.toLowerCase().split(' ')[0]) ||
            j.text.toLowerCase().includes(goal.category.toLowerCase())
        );
        
        if (relatedActivities.length > 0) {
            feedback += `<p>üìä <strong>${goal.category}„ÅÆÁõÆÊ®ô„Äå${goal.text}„Äç</strong><br>`;
            feedback += `‰ªäÊúà${relatedActivities.length}Âõû„ÅÆÈñ¢ÈÄ£„Åô„ÇãË°åÂãï„ÇíË®òÈå≤„Åó„Åæ„Åó„Åü„ÄÇÁ∂ôÁ∂ö„Åó„Å¶Âèñ„ÇäÁµÑ„Çì„Åß„ÅÑ„Åæ„Åô„Å≠ÔºÅ</p>`;
        } else if (relatedJournals.length > 0) {
            feedback += `<p>üìù <strong>${goal.category}„ÅÆÁõÆÊ®ô„Äå${goal.text}„Äç</strong><br>`;
            feedback += `„Ç∏„É£„Éº„Éä„É´„Å´${relatedJournals.length}ÂõûË®ÄÂèä„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇÂÆüÈöõ„ÅÆË°åÂãï„Å´Áßª„Åõ„Çã„Å®„Åï„Çâ„Å´ËâØ„ÅÑ„Åß„Åó„Çá„ÅÜ„ÄÇ</p>`;
        } else {
            feedback += `<p>üí° <strong>${goal.category}„ÅÆÁõÆÊ®ô„Äå${goal.text}„Äç</strong><br>`;
            feedback += `„Åæ„Å†Èñ¢ÈÄ£„Åô„ÇãË°åÂãï„ÇÑ„Ç∏„É£„Éº„Éä„É´„ÅÆË®òÈå≤„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ‰ªäÊó•„Åã„ÇâÂßã„ÇÅ„Å¶„Åø„Åæ„Åó„Çá„ÅÜÔºÅ</p>`;
        }
    });
    
    // „Éù„Ç∏„ÉÜ„Ç£„Éñ„Å™„Ç∏„É£„Éº„Éä„É´ÂàÜÊûê
    const positiveJournals = monthJournals.filter(j => 
        j.mood && ['ÊúÄÈ´ò', 'ËâØ„ÅÑ'].includes(j.mood)
    );
    
    if (positiveJournals.length > 0) {
        feedback += `<p>üòä <strong>„É°„É≥„Çø„É´Èù¢</strong><br>`;
        feedback += `‰ªäÊúà${positiveJournals.length}Êó•„ÄÅËâØ„ÅÑÊ∞óÂàÜ„ÅÆÊó•„Åå„ÅÇ„Çä„Åæ„Åó„Åü„ÄÇ„Éù„Ç∏„ÉÜ„Ç£„Éñ„Å™Áä∂ÊÖã„Çí‰øù„Å¶„Å¶„ÅÑ„Åæ„Åô„Å≠ÔºÅ</p>`;
    }
    
    // ÊîπÂñÑÊèêÊ°à
    const incompleteGoals = currentGoals.filter(g => !g.completed);
    if (incompleteGoals.length > 0) {
        feedback += `<p>üí™ <strong>‰ªäÂæå„ÅÆ„Ç¢„ÇØ„Ç∑„Éß„É≥ÊèêÊ°à</strong><br><ul style="margin-top: 10px;">`;
        incompleteGoals.slice(0, 3).forEach(goal => {
            feedback += `<li>„Äå${goal.text}„Äç„ÅÆ„Åü„ÇÅ„Å´„ÄÅ‰ªäÊó•„Åã„ÇâÂÖ∑‰ΩìÁöÑ„Å™Ë°åÂãï„Çí1„Å§Âßã„ÇÅ„Åæ„Åó„Çá„ÅÜ</li>`;
        });
        feedback += `</ul></p>`;
    }
    
    feedback += '</div>';
    
    document.getElementById('goalsFeedback').innerHTML = feedback;
}
function generateMoneyReport() {
    const month = document.getElementById('moneyReportMonthDisplay').value;
    if (!month) {
        alert('ÊúüÈñì„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
        return;
    }
    
    const [year, monthNum] = month.split('-');
    const startDate = new Date(year, monthNum - 1, 1);
    const endDate = new Date(year, monthNum, 0, 23, 59, 59);
    
    // ÊúüÈñìÂÜÖ„ÅÆË®òÈå≤„Çí„Éï„Ç£„É´„Çø„Éº
    const filteredRecords = (window.moneyRecords || []).filter(r => {
        const recDate = new Date(r.timestamp);
        return recDate >= startDate && recDate <= endDate;
    });
    
    if (filteredRecords.length === 0) {
        document.getElementById('moneyReportContent').innerHTML = '<p style="text-align:center; color:#999;">„Åì„ÅÆÊúüÈñì„Å´Ë®òÈå≤„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>';
        document.getElementById('moneyChartCanvas').style.display = 'none';
        return;
    }
    
    // „Ç´„ÉÜ„Ç¥„É™Âà•„Å´ÈõÜË®à
    const categoryData = {};
    
    filteredRecords.forEach(record => {
        const cat = record.category || 'Êú™ÂàÜÈ°û';
        const emoji = record.categoryEmoji || 'üí∞';
        
        if (!categoryData[cat]) {
            categoryData[cat] = {
                emoji: emoji,
                totalIncome: 0,
                totalExpense: 0,
                count: 0,
                details: []
            };
        }
        
        if (record.amount > 0) {
            categoryData[cat].totalIncome += record.amount;
        } else {
            categoryData[cat].totalExpense += Math.abs(record.amount);
        }
        
        categoryData[cat].count += 1;
        categoryData[cat].details.push({
            text: record.text,
            amount: record.amount,
            timestamp: record.timestamp
        });
    });
    
    // HTMLÁîüÊàê
    let html = '';
    let totalIncome = 0;
    let totalExpense = 0;
    let totalCount = 0;
    
    const sortedCategories = Object.keys(categoryData).sort((a, b) => 
        categoryData[b].totalExpense - categoryData[a].totalExpense
    );
    
    sortedCategories.forEach(cat => {
        const data = categoryData[cat];
        
        totalIncome += data.totalIncome;
        totalExpense += data.totalExpense;
        totalCount += data.count;
        
        html += `
            <div class="category-summary" onclick="toggleCategoryDetail('money-${cat}')">
                <div class="category-header">
                    <span>${data.emoji} ${cat}</span>
                    <span>‚ñº</span>
                </div>
                <div class="category-stats">
                    ${data.totalIncome > 0 ? `<span style="color:green;">üí∞ ÂèéÂÖ• ¬•${data.totalIncome.toLocaleString()}</span>` : ''}
                    ${data.totalExpense > 0 ? `<span style="color:red;">üí∏ ÊîØÂá∫ ¬•${data.totalExpense.toLocaleString()}</span>` : ''}
                    <span>üìù ${data.count}Âõû</span>
                </div>
                <div id="money-${cat}" class="category-details">
                    ${data.details.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp)).map(detail => {
                        const date = new Date(detail.timestamp).toLocaleString('ja-JP', { month: 'numeric', day: 'numeric', hour: '2-digit', minute: '2-digit' });
                        const amountText = detail.amount > 0 ? 
                            `<span style="color:green;">+¬•${detail.amount.toLocaleString()}</span>` : 
                            `<span style="color:red;">-¬•${Math.abs(detail.amount).toLocaleString()}</span>`;
                        
                        return `
                            <div class="detail-item">
                                <strong>${detail.text}</strong>
                                <div>${date} / ${amountText}</div>
                            </div>
                        `;
                    }).join('')}
                </div>
            </div>
        `;
    });
    
    html = `
        <div class="total-summary">
            üí∞ ÂèéÂÖ•: ¬•${totalIncome.toLocaleString()} | üí∏ ÊîØÂá∫: ¬•${totalExpense.toLocaleString()} | üìä ${totalCount}Âõû„ÅÆË®òÈå≤
            <div style="margin-top:10px; font-size:1.2em;">
                ${totalIncome - totalExpense >= 0 ? 'üìà' : 'üìâ'} ÂèéÊîØ: ¬•${(totalIncome - totalExpense).toLocaleString()}
            </div>
        </div>
    ` + html;
    
    document.getElementById('moneyReportContent').innerHTML = html;
    
    // „Ç∞„É©„ÉïÊèèÁîª
    drawMoneyChart(categoryData);
}

// Ë©≥Á¥∞Ë°®Á§∫„Éà„Ç∞„É´
function toggleCategoryDetail(id) {
    const element = document.getElementById(id);
    if (element) {
        element.classList.toggle('show');
    }
}

// Ë°åÂãï„Ç∞„É©„ÉïÊèèÁîª
function drawActivityChart(categoryData) {
    const canvas = document.getElementById('activityChartCanvas');
    const ctx = canvas.getContext('2d');
    
    canvas.style.display = 'block';
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    const categories = Object.keys(categoryData);
    if (categories.length === 0) return;
    
    const totalMinutes = categories.reduce((sum, cat) => sum + categoryData[cat].totalMinutes, 0);
    if (totalMinutes === 0) return;
    
    // ÂÜÜ„Ç∞„É©„ÉïÊèèÁîª
    const centerX = canvas.width / 2;
    const centerY = canvas.height / 2;
    const radius = Math.min(centerX, centerY) - 40;
    
    const colors = [
        '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF',
        '#FF9F40', '#FF6384', '#C9CBCF', '#4BC0C0', '#FF6384'
    ];
    
    let currentAngle = -Math.PI / 2;
    
    categories.forEach((cat, index) => {
        const data = categoryData[cat];
        const sliceAngle = (data.totalMinutes / totalMinutes) * 2 * Math.PI;
        
        // ÊâáÂΩ¢ÊèèÁîª
        ctx.fillStyle = colors[index % colors.length];
        ctx.beginPath();
        ctx.moveTo(centerX, centerY);
        ctx.arc(centerX, centerY, radius, currentAngle, currentAngle + sliceAngle);
        ctx.closePath();
        ctx.fill();
        
        // „É©„Éô„É´
        const labelAngle = currentAngle + sliceAngle / 2;
        const labelX = centerX + Math.cos(labelAngle) * (radius * 0.7);
        const labelY = centerY + Math.sin(labelAngle) * (radius * 0.7);
        
        const hours = Math.floor(data.totalMinutes / 60);
        const mins = data.totalMinutes % 60;
        
        ctx.fillStyle = '#000';
        ctx.font = 'bold 12px sans-serif';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText(`${data.emoji}`, labelX, labelY - 10);
        ctx.font = '11px sans-serif';
        ctx.fillText(`${hours}h${mins}m`, labelX, labelY + 10);
        
        currentAngle += sliceAngle;
    });
}

// „ÅäÈáë„Ç∞„É©„ÉïÊèèÁîª
function drawMoneyChart(categoryData) {
    const canvas = document.getElementById('moneyChartCanvas');
    const ctx = canvas.getContext('2d');
    
    canvas.style.display = 'block';
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    const categories = Object.keys(categoryData);
    if (categories.length === 0) return;
    
    const totalExpense = categories.reduce((sum, cat) => sum + categoryData[cat].totalExpense, 0);
    if (totalExpense === 0) return;
    
    // ÂÜÜ„Ç∞„É©„ÉïÊèèÁîª
    const centerX = canvas.width / 2;
    const centerY = canvas.height / 2;
    const radius = Math.min(centerX, centerY) - 40;
    
    const colors = [
        '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF',
        '#FF9F40', '#FF6384', '#C9CBCF', '#4BC0C0', '#FF6384'
    ];
    
    let currentAngle = -Math.PI / 2;
    
    categories.forEach((cat, index) => {
        const data = categoryData[cat];
        if (data.totalExpense === 0) return;
        
        const sliceAngle = (data.totalExpense / totalExpense) * 2 * Math.PI;
        
        // ÊâáÂΩ¢ÊèèÁîª
        ctx.fillStyle = colors[index % colors.length];
        ctx.beginPath();
        ctx.moveTo(centerX, centerY);
        ctx.arc(centerX, centerY, radius, currentAngle, currentAngle + sliceAngle);
        ctx.closePath();
        ctx.fill();
        
        // „É©„Éô„É´
        const labelAngle = currentAngle + sliceAngle / 2;
        const labelX = centerX + Math.cos(labelAngle) * (radius * 0.7);
        const labelY = centerY + Math.sin(labelAngle) * (radius * 0.7);
        
        ctx.fillStyle = '#000';
        ctx.font = 'bold 12px sans-serif';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText(`${data.emoji}`, labelX, labelY - 10);
        ctx.font = '11px sans-serif';
        ctx.fillText(`¬•${Math.round(data.totalExpense / 1000)}k`, labelX, labelY + 10);
        
        currentAngle += sliceAngle;
    });
}
        function renderCalendar() {
            const year = currentCalendarDate.getFullYear();
            const month = currentCalendarDate.getMonth();
            
            document.getElementById('calendarMonth').textContent = 
                `${year}Âπ¥ ${month + 1}Êúà`;
            
            const firstDay = new Date(year, month, 1).getDay();
            const lastDate = new Date(year, month + 1, 0).getDate();
            const today = new Date();
            
            let html = '';
            ['Êó•', 'Êúà', 'ÁÅ´', 'Ê∞¥', 'Êú®', 'Èáë', 'Âúü'].forEach(day => {
                html += `<div class="calendar-day-header">${day}</div>`;
            });
            
            for (let i = 0; i < firstDay; i++) {
                html += '<div class="calendar-day empty"></div>';
            }
            
            for (let date = 1; date <= lastDate; date++) {
                const currentDate = new Date(year, month, date);
                const dateStr = currentDate.toLocaleDateString('ja-JP');
                
                // „Åù„ÅÆÊó•„ÅÆ„Ç∏„É£„Éº„Éä„É´„ÇíÂèñÂæó
                const journal = journals.find(j => 
                    new Date(j.timestamp).toLocaleDateString('ja-JP') === dateStr
                );
                const hasJournal = !!journal;
                
                const isToday = 
                    today.getFullYear() === year &&
                    today.getMonth() === month &&
                    today.getDate() === date;
                
                let className = 'calendar-day';
                if (isToday) className += ' today';
                if (hasJournal) className += ' has-journal';
                
                // Ê∞óÂàÜÁµµÊñáÂ≠ó„ÇíËøΩÂä†
                let moodEmoji = '';
                if (journal && journal.mood) {
                    moodEmoji = `<div class="calendar-day-mood">${moodEmojis[journal.mood]}</div>`;
                }
                
                html += `<div class="${className}" onclick="viewJournalByDate('${dateStr}')">${date}${moodEmoji}</div>`;
            }
            
            document.getElementById('calendar').innerHTML = html;
        }
        
        function changeMonth(delta) {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() + delta);
            renderCalendar();
        }
        
        function viewJournalByDate(dateStr) {
            const journal = journals.find(j => 
                new Date(j.timestamp).toLocaleDateString('ja-JP') === dateStr
            );
            
            if (journal) {
                const moodText = journal.mood ? `\n\nÊ∞óÂàÜ: ${moodEmojis[journal.mood]}` : '';
                alert(`${dateStr}„ÅÆ„Ç∏„É£„Éº„Éä„É´:${moodText}\n\n${journal.text}`);
            } else {
                alert(`${dateStr}„Å´„ÅØ„Ç∏„É£„Éº„Éä„É´„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ`);
            }
        }
        
        // „É¨„Éù„Éº„ÉàË°®Á§∫
        function renderReports() {
            // Áµ±Ë®à
            document.getElementById('totalActivities').textContent = activities.length;
            
            const totalMoney = moneyRecords.reduce((sum, r) => sum + r.amount, 0);
            document.getElementById('totalMoney').textContent = `¬•${totalMoney.toLocaleString()}`;
            
            document.getElementById('totalJournals').textContent = journals.length;
            
            if (weightRecords.length > 0) {
                const avgWeight = weightRecords.reduce((sum, r) => sum + r.weight, 0) / weightRecords.length;
                document.getElementById('avgWeight').textContent = avgWeight.toFixed(1) + ' kg';
            }
            
            // Ë°åÂãï„ÉÅ„É£„Éº„Éà
            renderActivityChart();
            
            // Ê∞óÂàÜ„ÉÅ„É£„Éº„Éà
            renderMoodChart();
            
            // „ÅäÈáë„ÉÅ„É£„Éº„Éà
            renderMoneyChart();
            
            // ‰ΩìÈáç„ÉÅ„É£„Éº„Éà
            renderWeightChart();
            
            // AI„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ
            renderAIFeedback();
        }
        
        function renderActivityChart() {
            const ctx = document.getElementById('activityChart');
            if (!ctx) return;
            
            const categoryCounts = {};
            activityCategories.forEach(cat => {
                categoryCounts[cat.name] = activities.filter(a => a.text.includes(cat.name)).length;
            });
            
            if (window.activityChartInstance) {
                window.activityChartInstance.destroy();
            }
            
            window.activityChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(categoryCounts),
                    datasets: [{
                        label: 'ÂõûÊï∞',
                        data: Object.values(categoryCounts),
                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                        borderColor: 'rgba(0, 0, 0, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }
        
        function renderMoodChart() {
            const ctx = document.getElementById('moodChart');
            if (!ctx) return;
            
            // Ê∞óÂàÜ„ÅÆ„Ç´„Ç¶„É≥„Éà
            const moodCounts = {
                great: 0,
                good: 0,
                normal: 0,
                bad: 0,
                terrible: 0
            };
            
            journals.forEach(j => {
                if (j.mood && moodCounts.hasOwnProperty(j.mood)) {
                    moodCounts[j.mood]++;
                }
            });
            
            const moodLabels = {
                great: 'üòä ÊúÄÈ´ò',
                good: 'üôÇ ËâØ„ÅÑ',
                normal: 'üòê ÊôÆÈÄö',
                bad: 'üòî ÊÇ™„ÅÑ',
                terrible: 'üò¢ ÊúÄÊÇ™'
            };
            
            if (window.moodChartInstance) {
                window.moodChartInstance.destroy();
            }
            
            window.moodChartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(moodCounts).map(k => moodLabels[k]),
                    datasets: [{
                        data: Object.values(moodCounts),
                        backgroundColor: [
                            'rgba(76, 175, 80, 0.8)',   // great - green
                            'rgba(139, 195, 74, 0.8)',  // good - light green
                            'rgba(158, 158, 158, 0.8)', // normal - grey
                            'rgba(255, 152, 0, 0.8)',   // bad - orange
                            'rgba(244, 67, 54, 0.8)'    // terrible - red
                        ],
                        borderColor: [
                            'rgba(76, 175, 80, 1)',
                            'rgba(139, 195, 74, 1)',
                            'rgba(158, 158, 158, 1)',
                            'rgba(255, 152, 0, 1)',
                            'rgba(244, 67, 54, 1)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'bottom'
                        }
                    }
                }
            });
        }
        
        function renderMoneyChart() {
            const ctx = document.getElementById('moneyChart');
            if (!ctx) return;
            
            const last7Days = [];
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                last7Days.push(date.toLocaleDateString('ja-JP', {month: 'short', day: 'numeric'}));
            }
            
            const data = last7Days.map(dateStr => {
                const dayRecords = moneyRecords.filter(r => {
                    const recordDate = new Date(r.timestamp).toLocaleDateString('ja-JP', {month: 'short', day: 'numeric'});
                    return recordDate === dateStr;
                });
                return dayRecords.reduce((sum, r) => sum + r.amount, 0);
            });
            
            if (window.moneyChartInstance) {
                window.moneyChartInstance.destroy();
            }
            
            window.moneyChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: last7Days,
                    datasets: [{
                        label: 'ÂèéÊîØÔºàÂÜÜÔºâ',
                        data: data,
                        borderColor: 'rgba(0, 0, 0, 1)',
                        backgroundColor: 'rgba(0, 0, 0, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: true
                        }
                    }
                }
            });
        }
        
        function renderWeightChart() {
            const ctx = document.getElementById('weightChart');
            if (!ctx) return;
            
            const recent = weightRecords.slice(0, 10).reverse();
            
            if (window.weightChartInstance) {
                window.weightChartInstance.destroy();
            }
            
            window.weightChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: recent.map(r => new Date(r.timestamp).toLocaleDateString('ja-JP', {month: 'short', day: 'numeric'})),
                    datasets: [{
                        label: '‰ΩìÈáçÔºàkgÔºâ',
                        data: recent.map(r => r.weight),
                        borderColor: 'rgba(0, 0, 0, 1)',
                        backgroundColor: 'rgba(0, 0, 0, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: true
                        }
                    }
                }
            });
        }
        
        
        // AI„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØÁîüÊàê
        function renderAIFeedback() {
            const today = new Date();
            const sevenDaysAgo = new Date(today);
            sevenDaysAgo.setDate(today.getDate() - 7);
            
            const recentActivities = activities.filter(a => new Date(a.timestamp) >= sevenDaysAgo);
            const recentJournals = journals.filter(j => new Date(j.timestamp) >= sevenDaysAgo);
            const recentMoney = moneyRecords.filter(m => new Date(m.timestamp) >= sevenDaysAgo);
            
            const recordedDates = new Set();
            [...recentActivities, ...recentJournals, ...recentMoney].forEach(record => {
                const date = new Date(record.timestamp).toLocaleDateString('ja-JP');
                recordedDates.add(date);
            });
            
            const recordedDays = recordedDates.size;
            
            const categoryCounts = {};
            activityCategories.forEach(cat => {
                categoryCounts[cat.name] = recentActivities.filter(a => 
                    a.text.includes(cat.name)
                ).length;
            });
            
            const topCategories = Object.entries(categoryCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 3)
                .filter(([, count]) => count > 0);
            
            // ÊôÇÈñìÁµ±Ë®à„ÇíËøΩÂä†
            const totalMinutes = recentActivities.reduce((sum, a) => sum + (a.durationMinutes || 0), 0);
            const totalHours = Math.floor(totalMinutes / 60);
            const remainingMinutes = totalMinutes % 60;
            
            // „Ç´„ÉÜ„Ç¥„É™Âà•„ÅÆÊôÇÈñìÁµ±Ë®à
            const categoryTimes = {};
            activityCategories.forEach(cat => {
                const categoryActivities = recentActivities.filter(a => a.text.includes(cat.name));
                const categoryMinutes = categoryActivities.reduce((sum, a) => sum + (a.durationMinutes || 0), 0);
                if (categoryMinutes > 0) {
                    categoryTimes[cat.name] = {
                        emoji: cat.emoji,
                        hours: Math.floor(categoryMinutes / 60),
                        minutes: categoryMinutes % 60
                    };
                }
            });
            
            const moodCounts = {
                great: 0, good: 0, normal: 0, bad: 0, terrible: 0
            };
            
            recentJournals.forEach(j => {
                if (j.mood && moodCounts.hasOwnProperty(j.mood)) {
                    moodCounts[j.mood]++;
                }
            });
            
            const totalMoods = Object.values(moodCounts).reduce((sum, count) => sum + count, 0);
            const positiveMoods = moodCounts.great + moodCounts.good;
            const negativeMoods = moodCounts.bad + moodCounts.terrible;
            
            const totalIncome = recentMoney.filter(m => m.amount > 0).reduce((sum, m) => sum + m.amount, 0);
            const totalExpense = recentMoney.filter(m => m.amount < 0).reduce((sum, m) => sum + m.amount, 0);
            const balance = totalIncome + totalExpense;
            
            let advice = [];
            
            // ÊôÇÈñìÁµ±Ë®à„ÅÆ„Ç¢„Éâ„Éê„Ç§„Çπ„ÇíËøΩÂä†
            if (totalMinutes > 0) {
                if (totalHours > 0) {
                    advice.push(`‚è±Ô∏è ‰ªäÈÄ±„ÅØÂêàË®à ${totalHours}ÊôÇÈñì${remainingMinutes > 0 ? remainingMinutes + 'ÂàÜ' : ''}„ÇíË®òÈå≤„Åó„Åæ„Åó„ÅüÔºÅ`);
                } else {
                    advice.push(`‚è±Ô∏è ‰ªäÈÄ±„ÅØÂêàË®à ${remainingMinutes}ÂàÜ„ÇíË®òÈå≤„Åó„Åæ„Åó„ÅüÔºÅ`);
                }
            }
            
            if (recordedDays >= 5) {
                advice.push('üìä Á¥†Êô¥„Çâ„Åó„ÅÑÔºÅ‰ªäÈÄ±„ÅØ' + recordedDays + 'Êó•ÈñìË®òÈå≤„ÇíÁ∂ö„Åë„Å¶„ÅÑ„Åæ„Åô„ÄÇÁ∂ôÁ∂ö„ÅØÂäõ„Å™„Çä„Åß„Åô„Å≠ÔºÅ');
            } else if (recordedDays >= 3) {
                advice.push('üìä ‰ªäÈÄ±„ÅØ' + recordedDays + 'Êó•ÈñìË®òÈå≤„Åó„Åæ„Åó„Åü„ÄÇ„ÅÇ„Å®Â∞ë„Åó„ÅßÊØéÊó•Ë®òÈå≤ÈÅîÊàê„Åß„ÅôÔºÅ');
            } else {
                advice.push('üìä ‰ªäÈÄ±„ÅÆË®òÈå≤„ÅØ' + recordedDays + 'Êó•Èñì„Åß„Åô„ÄÇÊØéÊó•Â∞ë„Åó„Åö„Å§Ë®òÈå≤„Åó„Å¶„Åø„Åæ„Åó„Çá„ÅÜÔºÅ');
            }
            
            if (topCategories.length > 0) {
                const topActivity = topCategories[0];
                advice.push('üéØ ‰ªäÈÄ±„ÅØ„Äå' + topActivity[0] + '„Äç„Çí' + topActivity[1] + 'ÂõûË®òÈå≤„Åó„Åæ„Åó„Åü„ÄÇÁ¥†Êô¥„Çâ„Åó„ÅÑÔºÅ');
            }
            
            if (totalMoods > 0) {
                const positiveRate = Math.round((positiveMoods / totalMoods) * 100);
                if (positiveRate >= 70) {
                    advice.push('üòä ‰ªäÈÄ±„ÅÆÊ∞óÂàÜ„ÅØÁ¥†Êô¥„Çâ„Åó„ÅÑÔºÅ' + positiveRate + '%„Åå„Éù„Ç∏„ÉÜ„Ç£„Éñ„Å™Ê∞óÂàÜ„Åß„Åó„Åü„ÄÇ');
                } else if (positiveRate >= 50) {
                    advice.push('üôÇ ‰ªäÈÄ±„ÅÆÊ∞óÂàÜ„ÅØ„Åæ„Åö„Åæ„Åö„ÄÇ' + positiveRate + '%„Åå„Éù„Ç∏„ÉÜ„Ç£„Éñ„Å™Ê∞óÂàÜ„Åß„Åó„Åü„ÄÇ');
                } else if (negativeMoods > positiveMoods) {
                    advice.push('üòî ‰ªäÈÄ±„ÅØÂ∞ë„ÅóÂ§ßÂ§â„Åß„Åó„Åü„Å≠„ÄÇÁÑ°ÁêÜ„Åõ„Åö„ÄÅËá™ÂàÜ„ÅÆ„Éö„Éº„Çπ„ÅßÈÄ≤„Åø„Åæ„Åó„Çá„ÅÜ„ÄÇ');
                }
            }
            
            if (recentMoney.length > 0) {
                if (balance >= 0) {
                    advice.push('üí∞ ‰ªäÈÄ±„ÅÆÂèéÊîØ„ÅØ+' + balance.toLocaleString() + 'ÂÜÜ„ÄÇÁ¥†Êô¥„Çâ„Åó„ÅÑÁÆ°ÁêÜ„Åß„Åô„Å≠ÔºÅ');
                } else {
                    advice.push('üí∏ ‰ªäÈÄ±„ÅÆÊîØÂá∫„ÅØ' + Math.abs(balance).toLocaleString() + 'ÂÜÜ„ÄÇÊù•ÈÄ±„ÅØÁØÄÁ¥Ñ„ÇíÂøÉ„Åå„Åë„Å¶„Åø„Åæ„Åó„Çá„ÅÜ„ÄÇ');
                }
            }
            
            let goals = [];
            
            if (recordedDays < 7) {
                goals.push('üìÖ Êù•ÈÄ±„ÅØÊØéÊó•Ë®òÈå≤„ÇíÁõÆÊåá„Åó„Å¶„Åø„Åæ„Åó„Çá„ÅÜ');
            }
            
            if (topCategories.length > 0) {
                const topActivity = topCategories[0];
                goals.push('üéØ „Äå' + topActivity[0] + '„Äç„Çí' + (topActivity[1] + 2) + 'Âõû„ÇÑ„Å£„Å¶„Åø„Çã');
            }
            
            if (recentActivities.filter(a => a.text.includes('ÈÅãÂãï')).length < 3) {
                goals.push('üèÉ ÈÄ±3Âõû‰ª•‰∏ä„ÅÆÈÅãÂãï„Å´„ÉÅ„É£„É¨„É≥„Ç∏');
            }
            
            if (recentJournals.length < 5) {
                goals.push('üìù ÈÄ±5Âõû„ÅÆ„Ç∏„É£„Éº„Éä„É´Ë®òÈå≤„ÇíÁõÆÊåá„Åô');
            }
            
            if (balance < 0) {
                goals.push('üí∞ ÊîØÂá∫„ÇíÊÑèË≠ò„Åó„Å¶Ë®òÈå≤„ÇíÁ∂ö„Åë„Çã');
            }
            
            const weeklyAnalysisHTML = `
                <p><strong>üìä Ë®òÈå≤Êó•Êï∞:</strong> ${recordedDays}Êó• / 7Êó•</p>
                ${recordedDays >= 5 ? '<p style="color: #28a745;">‚ú® Á¥†Êô¥„Çâ„Åó„ÅÑÁ∂ôÁ∂öÂäõ„Åß„ÅôÔºÅ</p>' : ''}
                ${recentActivities.length > 0 ? `<p><strong>üìù Ë°åÂãïË®òÈå≤:</strong> ${recentActivities.length}Âõû</p>` : ''}
                ${recentJournals.length > 0 ? `<p><strong>‚úçÔ∏è „Ç∏„É£„Éº„Éä„É´:</strong> ${recentJournals.length}Âõû</p>` : ''}
            `;
            
            const behaviorPatternsHTML = topCategories.length > 0 ? `
                <p><strong>„Éà„ÉÉ„Éó3Ê¥ªÂãï:</strong></p>
                <ul>
                    ${topCategories.map(([name, count]) => `<li>${name}: ${count}Âõû</li>`).join('')}
                </ul>
                
                ${Object.keys(categoryTimes).length > 0 ? `
                    <p style="margin-top: 15px;"><strong>‚è±Ô∏è „Ç´„ÉÜ„Ç¥„É™Âà•„ÅÆÊôÇÈñì:</strong></p>
                    <ul>
                        ${Object.entries(categoryTimes).map(([name, time]) => {
                            let timeStr = '';
                            if (time.hours > 0 && time.minutes > 0) {
                                timeStr = `${time.hours}ÊôÇÈñì${time.minutes}ÂàÜ`;
                            } else if (time.hours > 0) {
                                timeStr = `${time.hours}ÊôÇÈñì`;
                            } else {
                                timeStr = `${time.minutes}ÂàÜ`;
                            }
                            return `<li>${time.emoji} ${name}: ${timeStr}</li>`;
                        }).join('')}
                    </ul>
                ` : ''}
            ` : '<p>„Åæ„Å†„Éá„Éº„Çø„ÅåÂ∞ë„Å™„ÅÑ„Åü„ÇÅ„ÄÅ„Éë„Çø„Éº„É≥„ÇíÂàÜÊûê„Åß„Åç„Åæ„Åõ„Çì„ÄÇ</p>';
            
            const moodTrendsHTML = totalMoods > 0 ? `
                <p><strong>Ê∞óÂàÜ„ÅÆÂÜÖË®≥:</strong></p>
                <ul>
                    ${moodCounts.great > 0 ? `<li>üòä ÊúÄÈ´ò: ${moodCounts.great}Âõû</li>` : ''}
                    ${moodCounts.good > 0 ? `<li>üôÇ ËâØ„ÅÑ: ${moodCounts.good}Âõû</li>` : ''}
                    ${moodCounts.normal > 0 ? `<li>üòê ÊôÆÈÄö: ${moodCounts.normal}Âõû</li>` : ''}
                    ${moodCounts.bad > 0 ? `<li>üòî ÊÇ™„ÅÑ: ${moodCounts.bad}Âõû</li>` : ''}
                    ${moodCounts.terrible > 0 ? `<li>üò¢ ÊúÄÊÇ™: ${moodCounts.terrible}Âõû</li>` : ''}
                </ul>
            ` : '<p>„Åæ„Å†„Ç∏„É£„Éº„Éä„É´„ÅÆË®òÈå≤„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇÊ∞óÂàÜ„ÇíË®òÈå≤„Åó„Å¶„Åø„Åæ„Åó„Çá„ÅÜÔºÅ</p>';
            
            const aiAdviceHTML = advice.length > 0 ? 
                advice.map(a => `<p>„Éª${a}</p>`).join('') : 
                '<p>„Éá„Éº„Çø„ÇíË®òÈå≤„Åó„Å¶„ÄÅAI„Åã„Çâ„ÅÆ„Ç¢„Éâ„Éê„Ç§„Çπ„ÇíÂèó„ÅëÂèñ„Çä„Åæ„Åó„Çá„ÅÜÔºÅ</p>';
            
            const weeklyGoalsHTML = goals.length > 0 ? `
                <ul>
                    ${goals.map(g => `<li>${g}</li>`).join('')}
                </ul>
            ` : '<p>Á¥†Êô¥„Çâ„Åó„ÅÑÔºÅ„Åô„Åπ„Å¶„ÅÆÁõÆÊ®ô„ÇíÈÅîÊàê„Åó„Å¶„ÅÑ„Åæ„ÅôÔºÅ</p>';
            
            document.getElementById('weeklyAnalysis').innerHTML = weeklyAnalysisHTML;
            document.getElementById('behaviorPatterns').innerHTML = behaviorPatternsHTML;
            document.getElementById('moodTrends').innerHTML = moodTrendsHTML;
            document.getElementById('aiAdvice').innerHTML = aiAdviceHTML;
            document.getElementById('weeklyGoals').innerHTML = weeklyGoalsHTML;
        }
        // „Ç´„ÉÜ„Ç¥„É™ÁÆ°ÁêÜ
        // „Çø„Ç§„Éû„ÉºÊ©üËÉΩ
        function toggleTimer() {
            if (timerRunning) {
                // ÂÅúÊ≠¢
                clearInterval(timerInterval);
                timerRunning = false;
                document.getElementById('timerButton').innerHTML = '‚ñ∂Ô∏è „Çø„Ç§„Éû„ÉºÂÜçÈñã';
                document.getElementById('timerButton').style.background = '#4CAF50';
            } else {
                // ÈñãÂßã
                if (timerStartTime === null) {
                    timerStartTime = Date.now() - (timerElapsedSeconds * 1000);
                } else {
                    timerStartTime = Date.now() - (timerElapsedSeconds * 1000);
                }
                
                timerRunning = true;
                document.getElementById('timerButton').innerHTML = '‚è∏Ô∏è ‰∏ÄÊôÇÂÅúÊ≠¢';
                document.getElementById('timerButton').style.background = '#FF9800';
                
                timerInterval = setInterval(() => {
                    timerElapsedSeconds = Math.floor((Date.now() - timerStartTime) / 1000);
                    updateTimerDisplay();
                }, 100);
            }
        }
        
        function updateTimerDisplay() {
            const hours = Math.floor(timerElapsedSeconds / 3600);
            const minutes = Math.floor((timerElapsedSeconds % 3600) / 60);
            const seconds = timerElapsedSeconds % 60;
            
            const display = 
                String(hours).padStart(2, '0') + ':' +
                String(minutes).padStart(2, '0') + ':' +
                String(seconds).padStart(2, '0');
            
            document.getElementById('timerDisplay').textContent = display;
        }
        
        function resetTimer() {
            clearInterval(timerInterval);
            timerStartTime = null;
            timerRunning = false;
            timerElapsedSeconds = 0;
            document.getElementById('timerDisplay').textContent = '00:00:00';
            document.getElementById('timerButton').innerHTML = '‚ñ∂Ô∏è „Çø„Ç§„Éû„ÉºÈñãÂßã';
            document.getElementById('timerButton').style.background = '#4CAF50';
        }
        
        // „Ç´„ÉÜ„Ç¥„É™ÁÆ°ÁêÜ
        function openCategoryManager() {
            document.getElementById('categoryModal').classList.add('active');
            renderCategoryList();
        }
        
        function closeCategoryManager() {
            document.getElementById('categoryModal').classList.remove('active');
        }
        
        function renderCategoryList() {
            const container = document.getElementById('categoryList');
            container.innerHTML = activityCategories.map((cat, index) => `
                <div class="log-item" style="display: flex; justify-content: space-between; align-items: center;">
                    <span>${cat.emoji} ${cat.name}</span>
                    <button onclick="deleteCategory(${index})" style="padding: 5px 10px; background: #ff4444; color: white; border: none; border-radius: 5px; cursor: pointer;">ÂâäÈô§</button>
                </div>
            `).join('');
        }
        
        function addCategory() {
            const nameInput = document.getElementById('newCategoryName');
            const emojiInput = document.getElementById('newCategoryEmoji');
            
            const name = nameInput.value.trim();
            const emoji = emojiInput.value.trim();
            
            if (!name || !emoji) {
                alert('ÂêçÂâç„Å®ÁµµÊñáÂ≠ó„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
            
            activityCategories.push({ name, emoji });
            localStorage.setItem('activityCategories', JSON.stringify(activityCategories));
            
            nameInput.value = '';
            emojiInput.value = '';
            
            renderCategoryList();
            renderActivityQuickButtons();
        }
        
        function deleteCategory(index) {
            if (confirm('„Åì„ÅÆ„Ç´„ÉÜ„Ç¥„É™„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')) {
                activityCategories.splice(index, 1);
                localStorage.setItem('activityCategories', JSON.stringify(activityCategories));
                renderCategoryList();
                renderActivityQuickButtons();
            }
        }
        
        // Èü≥Â£∞Ë™çË≠ò„Çª„ÉÉ„Éà„Ç¢„ÉÉ„Éó
// Èü≥Â£∞Ë™çË≠ò„ÅÆ‰∫åÈáçË®òÂÖ•„Éê„Ç∞‰øÆÊ≠£Áâà
// „Ç∏„É£„Éº„Éä„É´Â∞ÇÁî®Èü≥Â£∞Ë™çË≠òÔºàÂÜÖÂÆπ‰øùÊåÅÁâàÔºâ

// „Ç∏„É£„Éº„Éä„É´ÂÖ•Âäõ„Å´„É™„Ç¢„É´„Çø„Ç§„É†„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ„ÇíËøΩÂä†
function setupJournalInputListener() {
    const journalInput = document.getElementById('journalInput');
    if (!journalInput) {
        console.error('journalInputË¶ÅÁ¥†„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
        return;
    }
    
    let debounceTimer;
    
    journalInput.addEventListener('input', function() {
        clearTimeout(debounceTimer);
        
        const text = journalInput.value.trim();
        
        // 50ÊñáÂ≠ó‰ª•‰∏äÂÖ•Âäõ„Åï„Çå„Åü„ÇâË¶ÅÁ¥Ñ„ÇíË°®Á§∫
        if (text.length >= 50) {
            debounceTimer = setTimeout(() => {
                // ÊâãÂãï„Ç´„ÉÜ„Ç¥„É™„ÅåÂ≠òÂú®„Åô„ÇãÂ†¥Âêà„ÅØ„Åù„Çå„Çí‰ΩøÁî®
                const hasManualCategories = 
                    categoryVoiceInputs.good.length > 0 ||
                    categoryVoiceInputs.more.length > 0 ||
                    categoryVoiceInputs.worry.length > 0 ||
                    categoryVoiceInputs.taskMust.length > 0 ||
                    categoryVoiceInputs.taskWant.length > 0;
                
                let analysis;
                if (hasManualCategories) {
                    // ÊâãÂãï„Ç´„ÉÜ„Ç¥„É™„Çí‰ΩøÁî®
                    analysis = createManualCategoryAnalysis();
                } else {
                    // Ëá™ÂãïÂàÜÊûê„Çí‰ΩøÁî®ÔºàÊâãÂãïÂÖ•Âäõ„ÅÆÂ†¥ÂêàÔºâ
                    analysis = analyzJournal(text);
                }
                
                displaySummary(analysis);
            }, 1000); // 1ÁßíÂæÖ„Å£„Å¶„Åã„ÇâË¶ÅÁ¥Ñ
        } else {
            // Áü≠„ÅÑÂ†¥Âêà„ÅØË¶ÅÁ¥Ñ„Çª„ÇØ„Ç∑„Éß„É≥„ÇíÈùûË°®Á§∫
            const summarySection = document.getElementById('summarySection');
            if (summarySection) {
                summarySection.classList.remove('active');
            }
        }
    });
}
// „Ç∏„É£„Éº„Éä„É´Â∞ÇÁî®Èü≥Â£∞Ë™çË≠òÔºà„Éê„Ç∞‰øÆÊ≠£ÁâàÔºâ
// „Ç∏„É£„Éº„Éä„É´Â∞ÇÁî®Èü≥Â£∞Ë™çË≠òÔºàÂÆåÂÖ®‰øÆÊ≠£ÁâàÔºâ
// ÊâãÂãï„Ç´„ÉÜ„Ç¥„É™ÈÅ∏ÊäûÊ©üËÉΩ
window.selectedJournalCategory = null;
let categoryVoiceInputs = {
    good: [],
    more: [],
    worry: [],
    taskMust: [],
    taskWant: []
};

function selectJournalCategory(category) {
    console.log('„Ç´„ÉÜ„Ç¥„É™ÈÅ∏Êäû:', category);
    
    // Ââç„ÅÆ„Ç´„ÉÜ„Ç¥„É™„ÅÆÈÅ∏Êäû„ÇíËß£Èô§
    document.querySelectorAll('.category-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    
    // Êñ∞„Åó„ÅÑ„Ç´„ÉÜ„Ç¥„É™„ÇíÈÅ∏Êäû
    window.selectedJournalCategory = category;
    const btn = document.querySelector(`.category-btn[data-category="${category}"]`);
    if (btn) {
        btn.classList.add('active');
    }
    
    // ÈÅ∏ÊäûË°®Á§∫„ÇíÊõ¥Êñ∞
    const display = document.getElementById('selectedCategoryDisplay');
    const categoryNames = {
        good: 'üòä ËâØ„Åã„Å£„Åü„Åì„Å®',
        more: 'üìà „ÇÇ„Å£„Å®„Åß„Åç„Çã„Åì„Å®',
        worry: 'üòü ÊÇ©„Çì„Åß„ÅÑ„Çã„Åì„Å®',
        taskMust: '‚úÖ Must: „ÇÑ„Çâ„Å™„Åç„ÇÉ„ÅÑ„Åë„Å™„ÅÑ„Åì„Å®',
        taskWant: 'üí° Want: „ÇÑ„Çä„Åü„ÅÑ„Åì„Å®'
    };
    
    if (display) {
        display.textContent = `ÈÅ∏Êäû‰∏≠: ${categoryNames[category]}`;
        display.classList.add('has-selection');
    }
    
    window.selectJournalCategory = selectJournalCategory; // „Ç∞„É≠„Éº„Éê„É´„Å´ÊòéÁ§∫ÁöÑ„Å´ÂÖ¨Èñã
    // „Éí„É≥„ÉàÈùûË°®Á§∫
    const hint = document.getElementById('categoryRequiredHint');
    if (hint) {
        hint.classList.remove('show');
    }
}

// =================================================================
// Èü≥Â£∞ÂÖ•ÂäõÊ©üËÉΩ
// =================================================================

// „Ç∏„É£„Éº„Éä„É´Èü≥Â£∞ÂÖ•ÂäõÁî®„ÅÆ„Ç∞„É≠„Éº„Éê„É´Â§âÊï∞
window.journalRecognition = null;
window.isJournalRecording = false;
window.journalVoiceInputs = {}; // „Ç´„ÉÜ„Ç¥„É™Âà•„ÅÆÂÖ•Âäõ„Çí‰øùÂ≠ò

function startJournalVoice() {
    console.log('üéôÔ∏è startJournalVoice() Âëº„Å≥Âá∫„Åó');
    
    if (!('webkitSpeechRecognition' in window)) {
        alert('„Åì„ÅÆ„Éñ„É©„Ç¶„Ç∂„ÅØÈü≥Â£∞Ë™çË≠ò„Å´ÂØæÂøú„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì');
        return;
    }
    
    const button = document.getElementById('journalVoiceButton');
    const input = document.getElementById('journalInput');
    
    if (window.isJournalRecording) {
        // ÂÅúÊ≠¢
        console.log('‚èπÔ∏è Èü≥Â£∞Ë™çË≠ò„ÇíÂÅúÊ≠¢');
        if (window.journalRecognition) {
            window.journalRecognition.stop();
        }
        window.isJournalRecording = false;
        window.shouldRestartJournal = false;  // Ëá™ÂãïÂÜçÈñã„ÇíÁÑ°ÂäπÂåñ
        button.textContent = 'üé§ Èü≥Â£∞ÂÖ•Âäõ';
        button.style.background = '';
        return;
    }
    
    // ÈñãÂßã
    console.log('‚ñ∂Ô∏è Èü≥Â£∞Ë™çË≠ò„ÇíÈñãÂßã: „Ç´„ÉÜ„Ç¥„É™ =', window.selectedJournalCategory);
    window.journalRecognition = new webkitSpeechRecognition();
    window.journalRecognition.lang = 'ja-JP';
    window.journalRecognition.continuous = false;  // false „ÅÆ„Åæ„ÅæÔºà„Çπ„Éû„Éõ„ÅßÂÆâÂÆöÔºâ
    window.journalRecognition.interimResults = true;
    
    // Èü≥Â£∞Ë™çË≠òÈñãÂßãÊôÇ„ÅÆÂàùÊúü„ÉÜ„Ç≠„Çπ„Éà„Çí‰øùÂ≠ò
    const initialText = input.value || '';
    const processedResults = new Set();  // ÈáçË§áÈò≤Ê≠¢
    window.lastFinalText = window.lastFinalText || '';  // ÂâçÂõû„ÅÆÁ¢∫ÂÆö„ÉÜ„Ç≠„Çπ„Éà„Çí‰øùÂ≠ò
    let allText = '';
    
    window.journalRecognition.onresult = function(event) {
        console.log('üìù onresult:', event.results.length, 'ÂÄã„ÅÆÁµêÊûú');
        
        // event.resultIndex „Åã„ÇâÊúÄÂæå„Åæ„ÅßÂá¶ÁêÜÔºà„Çπ„Éû„ÉõÂØæÁ≠ñÔºâ
        for (let i = event.resultIndex; i < event.results.length; i++) {
            if (event.results[i].isFinal) {
                const text = event.results[i][0].transcript;
                
                // ÂâçÂõû„Å®Âêå„Åò„ÉÜ„Ç≠„Çπ„Éà„Å™„ÇâÁÑ°Ë¶ñÔºàÂá∫„Å†„ÅóÈáçË§áÂØæÁ≠ñÔºâ
                if (text === window.lastFinalText) {
                    console.log('üîÑ ÂâçÂõû„Å®Âêå„Åò„ÉÜ„Ç≠„Çπ„Éà„Çí„Çπ„Ç≠„ÉÉ„Éó:', text);
                    continue;
                }
                
                // Âêå„Åò„ÉÜ„Ç≠„Çπ„Éà„ÅØ1Âõû„Å†„ÅëËøΩÂä†Ôºà„Çπ„Éû„ÉõÂØæÁ≠ñÔºâ
                if (!processedResults.has(text)) {
                    processedResults.add(text);
                    allText += text;
                    window.lastFinalText = text;  // ÊúÄÊñ∞„ÅÆÁ¢∫ÂÆö„ÉÜ„Ç≠„Çπ„Éà„Çí‰øùÂ≠ò
                    console.log(`‚úÖ [${i}] ËøΩÂä†:`, text);
                } else {
                    console.log(`‚ùå [${i}] ÈáçË§á„Çπ„Ç≠„ÉÉ„Éó:`, text);
                }
            }
        }
        
        const separator = initialText && allText ? '\n' : '';
        input.value = initialText + separator + allText;
    };
    
    window.journalRecognition.onerror = function(event) {
        console.error("‚ùå Èü≥Â£∞Ë™çË≠ò„Ç®„É©„Éº:", event.error);
        
        if (event.error === 'no-speech') {
            console.log('‚ö†Ô∏è no-speech: Ëá™ÂãïÂÜçÈñã„Åó„Åæ„Åô');
            // no-speech „Ç®„É©„Éº„ÅØËá™ÂãïÂÜçÈñã
        } else {
            window.isJournalRecording = false;
            window.shouldRestartJournal = false;
            button.textContent = 'üé§ Èü≥Â£∞ÂÖ•Âäõ';
            button.style.background = '';
            
            if (event.error === 'not-allowed') {
                alert('„Éû„Ç§„ÇØ„ÅÆ‰ΩøÁî®„ÅåË®±ÂèØ„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì');
            } else if (event.error !== 'aborted') {
                alert('Èü≥Â£∞Ë™çË≠ò„Ç®„É©„Éº: ' + event.error);
            }
        }
    };
    
    window.journalRecognition.onend = function() {
        console.log('üîö Èü≥Â£∞Ë™çË≠ò„ÅåÁµÇ‰∫Ü');
        
        // Èå≤Èü≥‰∏≠„Éï„É©„Ç∞„ÅåON„Å™„ÇâËá™ÂãïÂÜçÈñãÔºà„É¶„Éº„Ç∂„Éº„ÅåÂÅúÊ≠¢„Éú„Çø„É≥„ÇíÊäº„Åô„Åæ„ÅßÁ∂ö„Åë„ÇãÔºâ
        if (window.isJournalRecording && window.shouldRestartJournal !== false) {
            console.log('üîÑ Ëá™ÂãïÂÜçÈñã„Åó„Åæ„ÅôÔºà600msÂæåÔºâ');
            setTimeout(function() {
                if (window.isJournalRecording) {
                    console.log('‚ñ∂Ô∏è ÂÜçÈñã');
                    window.journalRecognition.start();
                }
            }, 600);  // 600ms „ÅÆ„Éá„Ç£„É¨„Ç§Ôºà„Çπ„Éû„Éõ„ÅßÂÆâÂÆöÔºâ
        } else {
            // Êú¨ÂΩì„Å´ÁµÇ‰∫Ü
            window.isJournalRecording = false;
            button.textContent = 'üé§ Èü≥Â£∞ÂÖ•Âäõ';
            button.style.background = '';
        }
    };
    
    window.isJournalRecording = true;
    window.shouldRestartJournal = true;  // Ëá™ÂãïÂÜçÈñã„ÇíÊúâÂäπÂåñ
    button.textContent = '‚èπÔ∏è ÂÅúÊ≠¢';
    button.style.background = '#ef4444';
    window.journalRecognition.start();
}
// =================================================================

// Èü≥Â£∞ÂÖ•ÂäõÊ©üËÉΩ„Åì„Åì„Åæ„Åß

function setupManualCategoryVoiceRecognition(buttonId, inputId) {
    const button = document.getElementById(buttonId);
    const input = document.getElementById(inputId);
    
    if (!button || !input) {
        console.error('„Éú„Çø„É≥„Åæ„Åü„ÅØÂÖ•ÂäõÊ¨Ñ„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
        return;
    }
    
    let recognition = null;
    let isRecording = false;
    let silenceTimer = null;
    let finalTranscript = '';
    
    const clickHandler = function() {
    console.log("setupManualCategoryVoiceRecognition: buttonId=", buttonId, "inputId=", inputId, "button=", button, "input=", input);
        if (!selectedJournalCategory) {
        console.log("„Ç∏„É£„Éº„Éä„É´Èü≥Â£∞„Éú„Çø„É≥„Åå„ÇØ„É™„ÉÉ„ÇØ„Åï„Çå„Åæ„Åó„Åü„ÄÇselectedJournalCategory=", selectedJournalCategory);
            const hint = document.getElementById('categoryRequiredHint');
            if (hint) {
                hint.classList.add('show');
                setTimeout(() => hint.classList.remove('show'), 3000);
            }
            alert('„Åæ„Åö„Ç´„ÉÜ„Ç¥„É™„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
            return;
        }
        
        if (isRecording) {
            console.log('üõë ÊâãÂãïÂÅúÊ≠¢');
            if (recognition) {
                recognition.stop();
            }
            isRecording = false;
            button.textContent = 'üé§';
            button.style.background = '';
            if (silenceTimer) {
                clearTimeout(silenceTimer);
                silenceTimer = null;
            }
        } else {
            if (!('webkitSpeechRecognition' in window)) {
                alert('„Åì„ÅÆ„Éñ„É©„Ç¶„Ç∂„ÅØÈü≥Â£∞Ë™çË≠ò„Å´ÂØæÂøú„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì');
                return;
            }
            
            console.log('üé§ Èü≥Â£∞ÂÖ•Âäõ„ÇíÈñãÂßã: „Ç´„ÉÜ„Ç¥„É™ =', selectedJournalCategory);
            
            recognition = new webkitSpeechRecognition();
            recognition.lang = 'ja-JP';
            recognition.continuous = false;  // ‚≠ê continuous„Çífalse„Å´Â§âÊõ¥
            recognition.interimResults = true;
            
            finalTranscript = '';
            isRecording = true;
            button.textContent = '‚èπÔ∏è';
            button.style.background = '#ef4444';
            
            recognition.onresult = function(event) {
                console.log('üìù Èü≥Â£∞Ë™çË≠òÁµêÊûú„ÇíÂèó‰ø°');
                
                if (silenceTimer) {
                    clearTimeout(silenceTimer);
                }
                
                let interimTranscript = '';
                let newFinalTranscript = '';
                
                // ‚≠ê „Ç∑„É≥„Éó„É´„Å™„É´„Éº„ÉóÔºàcontinuous: false„Å™„ÅÆ„ÅßÈáçË§á„Å™„ÅóÔºâ
                for (let i = 0; i < event.results.length; i++) {
                    const transcript = event.results[i][0].transcript;
                    if (event.results[i].isFinal) {
                        newFinalTranscript += transcript;
                        console.log('‚úÖ Á¢∫ÂÆö„ÉÜ„Ç≠„Çπ„Éà:', transcript);
                    } else {
                        interimTranscript += transcript;
                    }
                }
                
                if (newFinalTranscript) {
                    finalTranscript = newFinalTranscript;  // ‚≠ê Á¥ØÁ©ç„Åß„ÅØ„Å™„ÅèÁΩÆ„ÅçÊèõ„Åà
                    console.log('üìå ÊúÄÁµÇ„ÉÜ„Ç≠„Çπ„Éà:', finalTranscript);
                }
                
                const displayText = finalTranscript + interimTranscript;
                input.value = displayText;
                
                // „É™„Ç¢„É´„Çø„Ç§„É†Ë¶ÅÁ¥ÑË°®Á§∫
                if (displayText.length > 30) {
                    const tempInputs = JSON.parse(JSON.stringify(categoryVoiceInputs));
                    tempInputs[selectedJournalCategory] = [displayText];
                    const tempAnalysis = {
                        good: tempInputs.good || [],
                        more: tempInputs.more || [],
                        worry: tempInputs.worry || [],
                        task: tempInputs.task || []
                    };
                    displaySummary(tempAnalysis);
                }
            };
            
            recognition.onend = function() {
                console.log('üèÅ Èü≥Â£∞Ë™çË≠ò„ÅåÁµÇ‰∫Ü (ÊúÄÁµÇ:', finalTranscript, ')');
                isRecording = false;
                button.textContent = 'üé§';
                button.style.background = '';
                
                if (silenceTimer) {
                    clearTimeout(silenceTimer);
                    silenceTimer = null;
                }
                
                if (finalTranscript && selectedJournalCategory) {
                    const trimmed = finalTranscript.trim();
                    const existing = categoryVoiceInputs[selectedJournalCategory];
                    
                    // ÈáçË§á„ÉÅ„Çß„ÉÉ„ÇØ
                    const isDuplicate = existing.some(text => {
                        return text === trimmed || text.includes(trimmed) || trimmed.includes(text);
                    });
                    
                    if (trimmed && !isDuplicate) {
                        categoryVoiceInputs[selectedJournalCategory].push(trimmed);
                        console.log('‚úÖ „Ç´„ÉÜ„Ç¥„É™„Å´ËøΩÂä†:', selectedJournalCategory, trimmed);
                        
                        updateJournalInputFromCategories();
                        
                        const analysis = createManualCategoryAnalysis();
                        displaySummary(analysis);
                        
                        input.value = '';
                    } else if (isDuplicate) {
                        console.log('‚ö†Ô∏è ÈáçË§á„ÉÜ„Ç≠„Çπ„Éà„ÅÆ„Åü„ÇÅËøΩÂä†„Åó„Åæ„Åõ„Çì„Åß„Åó„Åü:', trimmed);
                        input.value = '';
                    } else {
                        console.log('‚ö†Ô∏è Á©∫„ÅÆ„ÉÜ„Ç≠„Çπ„Éà„ÅÆ„Åü„ÇÅËøΩÂä†„Åó„Åæ„Åõ„Çì„Åß„Åó„Åü');
                        input.value = '';
                    }
                    
                    finalTranscript = '';
                }
            };
            
            recognition.onerror = function(event) {
                console.error('‚ùå Èü≥Â£∞Ë™çË≠ò„Ç®„É©„Éº:', event.error);
                isRecording = false;
                button.textContent = 'üé§';
                button.style.background = '';
                
                if (silenceTimer) {
                    clearTimeout(silenceTimer);
                    silenceTimer = null;
                }
                
                if (event.error === 'no-speech') {
                    alert('Èü≥Â£∞„ÅåÊ§úÂá∫„Åï„Çå„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇ„ÇÇ„ÅÜ‰∏ÄÂ∫¶„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ„ÄÇ');
                } else if (event.error === 'network') {
                    alert('„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„ÄÇ„Ç§„É≥„Çø„Éº„Éç„ÉÉ„ÉàÊé•Á∂ö„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                } else if (event.error !== 'aborted') {
                    alert('Èü≥Â£∞Ë™çË≠ò„Ç®„É©„Éº: ' + event.error);
                }
                
                finalTranscript = '';
            };
            
            recognition.start();
        }
    };
    
    button.removeEventListener('click', clickHandler);
    button.addEventListener('click', clickHandler);
}

function updateJournalInputFromCategories() {
    const input = document.getElementById('journalInput');
    if (!input) return;
    
    let fullText = [];
    
    if (categoryVoiceInputs.good.length > 0) {
        fullText.push('„ÄêËâØ„Åã„Å£„Åü„Åì„Å®„Äë');
        fullText.push(...categoryVoiceInputs.good);
    }
    
    if (categoryVoiceInputs.more.length > 0) {
        fullText.push('„Äê„ÇÇ„Å£„Å®„Åß„Åç„Çã„Åì„Å®„Äë');
        fullText.push(...categoryVoiceInputs.more);
    }
    
    if (categoryVoiceInputs.worry.length > 0) {
        fullText.push('„ÄêÊÇ©„Çì„Åß„ÅÑ„Çã„Åì„Å®„Äë');
        fullText.push(...categoryVoiceInputs.worry);
    }
    
    if (categoryVoiceInputs.taskMust.length > 0) {
        fullText.push('„ÄêMust: „ÇÑ„Çâ„Å™„Åç„ÇÉ„ÅÑ„Åë„Å™„ÅÑ„Åì„Å®„Äë');
        fullText.push(...categoryVoiceInputs.taskMust);
    }
    
    if (categoryVoiceInputs.taskWant.length > 0) {
        fullText.push('„ÄêWant: „ÇÑ„Çä„Åü„ÅÑ„Åì„Å®„Äë');
        fullText.push(...categoryVoiceInputs.taskWant);
    }
    
    input.value = fullText.join('\n');
}

function createManualCategoryAnalysis() {
    return {
        good: categoryVoiceInputs.good.slice(),
        more: categoryVoiceInputs.more.slice(),
        worry: categoryVoiceInputs.worry.slice(),
        taskMust: categoryVoiceInputs.taskMust.slice(),
        taskWant: categoryVoiceInputs.taskWant.slice()
    };
}

function resetCategorySelection() {
    selectedJournalCategory = null;
    document.querySelectorAll('.category-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    
    const display = document.getElementById('selectedCategoryDisplay');
    if (display) {
        display.textContent = '„Ç´„ÉÜ„Ç¥„É™„ÇíÈÅ∏Êäû„Åó„Å¶„Åã„ÇâÈü≥Â£∞ÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ';
        display.classList.remove('has-selection');
    }
}

function clearCategoryVoiceInputs() {
    categoryVoiceInputs = {
        good: [],
        more: [],
        worry: [],
        taskMust: [],
        taskWant: []
    };
    resetCategorySelection();
}
function setupJournalVoiceRecognition(buttonId, inputId) {
    const button = document.getElementById(buttonId);
    const input = document.getElementById(inputId);
    
    if (!button || !input) return;
    
    if (!('webkitSpeechRecognition' in window)) {
        button.disabled = true;
        button.textContent = 'Èü≥Â£∞Ë™çË≠ò„ÅØÈùûÂØæÂøú„Åß„Åô';
        return;
    }
    
    const recognition = new webkitSpeechRecognition();
    recognition.lang = 'ja-JP';
    recognition.continuous = false;  // ÈáçË¶Å: false „Å´Â§âÊõ¥
    recognition.interimResults = true;
    recognition.maxAlternatives = 1;
    
    let isListening = false;
    let finalTranscript = '';
    let shouldRestart = false;  // ÂÜçÈñã„Éï„É©„Ç∞
    let restartTimer = null;
    
    button.addEventListener('click', () => {
        if (isListening) {
            // ÂÅúÊ≠¢
            shouldRestart = false;
            clearTimeout(restartTimer);
            recognition.stop();
            button.classList.remove('listening');
            button.textContent = button.textContent.replace('üî¥ ÂÅúÊ≠¢', 'üé§ Èü≥Â£∞ÂÖ•Âäõ');
            isListening = false;
        } else {
            // ÈñãÂßã
            finalTranscript = input.value || '';
            shouldRestart = true;
            startRecognition();
        }
    });
    
    function startRecognition() {
        try {
            recognition.start();
            button.classList.add('listening');
            button.textContent = button.textContent.replace('üé§ Èü≥Â£∞ÂÖ•Âäõ', 'üî¥ ÂÅúÊ≠¢');
            isListening = true;
        } catch (e) {
            console.error('Èü≥Â£∞Ë™çË≠ò„ÅÆÈñãÂßã„Å´Â§±Êïó:', e);
            // Êó¢„Å´ÈñãÂßã„Åï„Çå„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅØÁÑ°Ë¶ñ
            if (e.name !== 'InvalidStateError') {
                isListening = false;
                shouldRestart = false;
            }
        }
    }
    
    recognition.onstart = () => {
        console.log('Èü≥Â£∞Ë™çË≠òÈñãÂßã');
    };
    
    recognition.onresult = (event) => {
        let interimTranscript = '';
        
        // ÂÖ®„Å¶„ÅÆÁµêÊûú„ÇíÂá¶ÁêÜÔºàcontinuous=false„Å™„ÅÆ„ÅßÂïèÈ°å„Å™„ÅÑÔºâ
        for (let i = 0; i < event.results.length; i++) {
            const transcript = event.results[i][0].transcript;
            
            if (event.results[i].isFinal) {
                // Á¢∫ÂÆö„Åó„Åü„ÉÜ„Ç≠„Çπ„Éà„ÇíËøΩÂä†ÔºàÈáçË§á„ÉÅ„Çß„ÉÉ„ÇØÔºâ
                if (!finalTranscript.includes(transcript)) {
                    finalTranscript += transcript;
                }
            } else {
                interimTranscript += transcript;
            }
        }
        
        // Ë°®Á§∫„ÇíÊõ¥Êñ∞
        input.value = finalTranscript + interimTranscript;
        
        // Ë¶ÅÁ¥Ñ„ÇíÊõ¥Êñ∞
        const fullText = finalTranscript + interimTranscript;
        if (fullText.trim().length >= 50) {
            const analysis = analyzJournal(fullText);
            displaySummary(analysis);
        }
    };
    
    recognition.onerror = (event) => {
        console.error('Èü≥Â£∞Ë™çË≠ò„Ç®„É©„Éº:', event.error);
        
        if (event.error === 'no-speech') {
            // ÁÑ°Èü≥Ê§úÂá∫ - Ëá™ÂãïÂÜçÈñã
            console.log('ÁÑ°Èü≥„ÇíÊ§úÂá∫„ÄÅÂÜçÈñã„Åó„Åæ„Åô');
            // ‰Ωï„ÇÇ„Åó„Å™„ÅÑÔºàonend„ÅßÂÜçÈñã„Åï„Çå„ÇãÔºâ
        } else if (event.error === 'aborted') {
            // ‰∏≠Êñ≠„Åï„Çå„Åü - ÂÜçÈñã„Åó„Å™„ÅÑ
            shouldRestart = false;
        } else {
            // „Åù„ÅÆ‰ªñ„ÅÆ„Ç®„É©„Éº
            console.log('„Ç®„É©„Éº„ÅÆ„Åü„ÇÅÂÅúÊ≠¢');
            shouldRestart = false;
            button.classList.remove('listening');
            button.textContent = button.textContent.replace('üî¥ ÂÅúÊ≠¢', 'üé§ Èü≥Â£∞ÂÖ•Âäõ');
            isListening = false;
        }
    };
    
    recognition.onend = () => {
        console.log('Èü≥Â£∞Ë™çË≠òÁµÇ‰∫Ü');
        
        if (shouldRestart && isListening) {
            // 500msÂæÖ„Å£„Å¶„Åã„ÇâÂÜçÈñãÔºàÈáçË§á„ÇíÈò≤„ÅêÔºâ
            clearTimeout(restartTimer);
            restartTimer = setTimeout(() => {
                if (shouldRestart && isListening) {
                    console.log('Ëá™ÂãïÂÜçÈñã');
                    startRecognition();
                }
            }, 500);
        } else {
            button.classList.remove('listening');
            button.textContent = button.textContent.replace('üî¥ ÂÅúÊ≠¢', 'üé§ Èü≥Â£∞ÂÖ•Âäõ');
            isListening = false;
        }
    };
}
function setupVoiceRecognition(buttonId, inputId, isJournal = false, isActivity = false) {
    const button = document.getElementById(buttonId);
    const input = document.getElementById(inputId);
    
    if (!button || !input) return;
    
    if (!('webkitSpeechRecognition' in window)) {
        button.disabled = true;
        button.textContent = 'Èü≥Â£∞Ë™çË≠ò„ÅØÈùûÂØæÂøú„Åß„Åô';
        return;
    }
    
    const recognition = new webkitSpeechRecognition();
    recognition.lang = 'ja-JP';
    recognition.continuous = false;  // continuous „Çí false „Å´Â§âÊõ¥
    recognition.interimResults = true;
    
    let isListening = false;
    let finalTranscript = '';
    let isProcessing = false;  // Âá¶ÁêÜ‰∏≠„Éï„É©„Ç∞„ÇíËøΩÂä†
    
    button.addEventListener('click', () => {
        if (isListening) {
            recognition.stop();
            button.classList.remove('listening');
            button.textContent = button.textContent.replace('üî¥ ÂÅúÊ≠¢', 'üé§ Èü≥Â£∞ÂÖ•Âäõ');
            isListening = false;
        } else {
            if (isProcessing) return;  // Âá¶ÁêÜ‰∏≠„Å™„ÇâÁÑ°Ë¶ñ
            finalTranscript = '';
            recognition.start();
            button.classList.add('listening');
            button.textContent = button.textContent.replace('üé§ Èü≥Â£∞ÂÖ•Âäõ', 'üî¥ ÂÅúÊ≠¢');
            isListening = true;
        }
    });
    
    recognition.onresult = (event) => {
        if (isProcessing) return;  // Âá¶ÁêÜ‰∏≠„Å™„ÇâÁÑ°Ë¶ñ
        
        let interimTranscript = '';
        
        for (let i = event.resultIndex; i < event.results.length; i++) {
            const transcript = event.results[i][0].transcript;
            if (event.results[i].isFinal) {
                finalTranscript += transcript;
            } else {
                interimTranscript += transcript;
            }
        }
        
        const fullText = finalTranscript + interimTranscript;
        input.value = fullText;
        
        // Ë°åÂãï„Çø„Éñ„ÅÆÂ†¥Âêà„ÅØËá™ÂãïÁöÑ„Å´„Ç´„ÉÜ„Ç¥„É™„ÇíÊ§úÂá∫„Åó„Å¶ÈÅ∏Êäû
        if (isActivity && fullText) {
            autoSelectActivityCategory(fullText);
        }
        
        // „Ç∏„É£„Éº„Éä„É´„ÅÆÂ†¥Âêà„ÅØËá™ÂãïË¶ÅÁ¥Ñ„ÇíË°®Á§∫
        if (isJournal && finalTranscript) {
            const analysis = analyzJournal(fullText);
            displaySummary(analysis);
        }
    };
    
    recognition.onerror = (event) => {
        console.error('Èü≥Â£∞Ë™çË≠ò„Ç®„É©„Éº:', event.error);
        button.classList.remove('listening');
        button.textContent = button.textContent.replace('üî¥ ÂÅúÊ≠¢', 'üé§ Èü≥Â£∞ÂÖ•Âäõ');
        isListening = false;
        isProcessing = false;  // „Ç®„É©„ÉºÊôÇ„Å´„Éï„É©„Ç∞„Çí„É™„Çª„ÉÉ„Éà
    };
    
    recognition.onend = () => {
        if (isProcessing) return;  // „Åô„Åß„Å´Âá¶ÁêÜ‰∏≠„Å™„ÇâÁÑ°Ë¶ñ
        
        isProcessing = true;  // Âá¶ÁêÜÈñãÂßã
        
        button.classList.remove('listening');
        button.textContent = button.textContent.replace('üî¥ ÂÅúÊ≠¢', 'üé§ Èü≥Â£∞ÂÖ•Âäõ');
        isListening = false;
        
        // Â∞ë„ÅóÂæÖ„Å£„Å¶„Åã„Çâ„Éï„É©„Ç∞„Çí„É™„Çª„ÉÉ„ÉàÔºà‰∫åÈáçÂÆüË°å„ÇíÈò≤„ÅêÔºâ
        setTimeout(() => {
            isProcessing = false;
        }, 500);
    };
}
        
        // Èü≥Â£∞ÂÖ•Âäõ„ÅßËá™ÂãïÁöÑ„Å´„Ç´„ÉÜ„Ç¥„É™„ÇíÈÅ∏Êäû
        function autoSelectActivityCategory(text) {
            // „ÉÜ„Ç≠„Çπ„Éà„ÇíÂ∞èÊñáÂ≠óÂåñ
            const lowerText = text.toLowerCase();
            
            // ÂêÑ„Ç´„ÉÜ„Ç¥„É™„ÅÆ„Éû„ÉÉ„ÉÅ„É≥„Ç∞„Çπ„Ç≥„Ç¢„ÇíË®àÁÆó
            let bestMatch = null;
            let bestMatchEmoji = null;
            let bestScore = 0;
            
            activityCategories.forEach(category => {
                const categoryName = category.name.toLowerCase();
                let score = 0;
                
                // „Ç´„ÉÜ„Ç¥„É™Âêç„ÅåÁõ¥Êé•Âê´„Åæ„Çå„Å¶„ÅÑ„Çã„Åã
                if (lowerText.includes(categoryName)) {
                    score += 10;
                }
                
                // Èñ¢ÈÄ£„Ç≠„Éº„ÉØ„Éº„Éâ„Çí„ÉÅ„Çß„ÉÉ„ÇØ
                const keywords = getCategoryKeywords(category.name);
                keywords.forEach(keyword => {
                    if (lowerText.includes(keyword)) {
                        score += 5;
                    }
                });
                
                if (score > bestScore) {
                    bestScore = score;
                    bestMatch = category.name;
                    bestMatchEmoji = category.emoji;
                }
            });
            
            // „Éû„ÉÉ„ÉÅ„Åó„Åü„Ç´„ÉÜ„Ç¥„É™„Åå„ÅÇ„Çå„Å∞„ÄÅselectCategoryÈñ¢Êï∞„ÇíÂëº„Å≥Âá∫„Åó
            if (bestMatch && bestScore >= 5) {
                selectCategory(bestMatch, bestMatchEmoji);
            }
        }
        function getCategoryKeywords(categoryName) {
            const keywordMap = {
                '‰ªï‰∫ã': ['‰ºöË≠∞', '„Éü„Éº„ÉÜ„Ç£„É≥„Ç∞', '„Éó„É¨„Çº„É≥', 'Ë≥áÊñô', '„Éó„É≠„Ç∏„Çß„ÇØ„Éà', 'Ê•≠Âãô', '„Ç™„Éï„Ç£„Çπ', '‰ºÅÁîª', 'Â†±Âëä', '„É°„Éº„É´'],
                'ÂãâÂº∑': ['Â≠¶Áøí', 'ÂãâÂº∑', 'Ë™≠Êõ∏', 'Êú¨', '„Ç≥„Éº„Çπ', 'Ë¨õÂ∫ß', '„Çª„Éü„Éä„Éº', 'Ë©¶È®ì', 'Á†îÁ©∂', 'Âæ©Áøí'],
                'ÈÅãÂãï': ['„Ç∏„É†', '„É©„É≥„Éã„É≥„Ç∞', '„Ç∏„Éß„ÇÆ„É≥„Ç∞', 'Á≠ã„Éà„É¨', '„É®„Ç¨', '„Çπ„Éù„Éº„ÉÑ', 'Êï£Ê≠©', '„Éà„É¨„Éº„Éã„É≥„Ç∞', '„Çπ„Éà„É¨„ÉÉ„ÉÅ'],
                'È£ü‰∫ã': ['ÊúùÈ£ü', 'Êò®È£ü', 'Â§ïÈ£ü', 'È£ü„Åπ', '„É©„É≥„ÉÅ', '„Éá„Ç£„Éä„Éº', 'ÊñôÁêÜ', 'È£ü‰∫ã', '„É¨„Çπ„Éà„É©„É≥', '„Ç´„Éï„Çß'],
                'Áù°Áú†': ['Áú†', 'ÂØù', '‰ªï‰∫ã', 'Ëµ∑', '‰ºëÊÅØ', 'Êò®ÂØù', 'Êúù', 'Áñ≤„Çå'],
                'Ë™≠Êõ∏': ['Êú¨', 'Â∞èË™¨', 'Êº´Áîª', 'Ë™≠„Çì', 'ÈõëË™å', 'Ë®ò‰∫ã', '„Éñ„ÉÉ„ÇØ'],
                'ÂÆ∂‰∫ã': ['ÊéÉÈô§', 'Ê¥óÊøØ', 'ÊñôÁêÜ', 'Áâá‰ªò„Åë', 'Ë≤∑„ÅÑÁâ©', '„ÇØ„É™„Éº„Éã„É≥„Ç∞', 'Êï¥ÁêÜ'],
                'Ë∂£Âë≥': ['Ë∂£Âë≥', '„Ç≤„Éº„É†', 'Èü≥Ê•Ω', 'Êò†Áîª', '„Éâ„É©„Éû', '„Ç¢„Éã„É°', 'Áµµ', 'ÂÜôÁúü', '„Ç´„É©„Ç™„Ç±']
            };
            
            return keywordMap[categoryName] || [];
        }
        
        // „ÇØ„Ç§„ÉÉ„ÇØ„Éú„Çø„É≥„Çí„Éè„Ç§„É©„Ç§„Éà
        
        // Ë¶ÅÁ¥Ñ„ÇíË°®Á§∫
        function displaySummary(analysis) {
            const summarySection = document.getElementById('summarySection');
            summarySection.classList.add('active');
            
            // Good
            const goodEl = document.getElementById('summaryGood');
            const goodCommentEl = document.getElementById('commentGood');
            if (analysis.good.length > 0) {
                goodEl.textContent = analysis.good.map(s => '„Éª' + s).join('\n');
                goodCommentEl.textContent = generateAIComment('good', analysis.good);
            } else {
                goodEl.textContent = 'Ôºà„Å™„ÅóÔºâ';
                goodCommentEl.textContent = '';
            }
            
            // More
            const moreEl = document.getElementById('summaryMore');
            const moreCommentEl = document.getElementById('commentMore');
            if (analysis.more.length > 0) {
                moreEl.textContent = analysis.more.map(s => '„Éª' + s).join('\n');
                moreCommentEl.textContent = generateAIComment('more', analysis.more);
            } else {
                moreEl.textContent = 'Ôºà„Å™„ÅóÔºâ';
                moreCommentEl.textContent = '';
            }
            
            // Worry
            const worryEl = document.getElementById('summaryWorry');
            const worryCommentEl = document.getElementById('commentWorry');
            if (analysis.worry.length > 0) {
                worryEl.textContent = analysis.worry.map(s => '„Éª' + s).join('\n');
                worryCommentEl.textContent = generateAIComment('worry', analysis.worry);
            } else {
                worryEl.textContent = 'Ôºà„Å™„ÅóÔºâ';
                worryCommentEl.textContent = '';
            }
            
            // Task Must
            const taskMustEl = document.getElementById('summaryTaskMust');
            const taskMustCommentEl = document.getElementById('commentTaskMust');
            if (analysis.taskMust && analysis.taskMust.length > 0) {
                taskMustEl.textContent = analysis.taskMust.map(s => '„Éª' + s).join('\n');
                taskMustCommentEl.textContent = generateAIComment('taskMust', analysis.taskMust);
            } else {
                taskMustEl.textContent = 'Ôºà„Å™„ÅóÔºâ';
                taskMustCommentEl.textContent = '';
            }
            
            // Task Want
            const taskWantEl = document.getElementById('summaryTaskWant');
            const taskWantCommentEl = document.getElementById('commentTaskWant');
            if (analysis.taskWant && analysis.taskWant.length > 0) {
                taskWantEl.textContent = analysis.taskWant.map(s => '„Éª' + s).join('\n');
                taskWantCommentEl.textContent = generateAIComment('taskWant', analysis.taskWant);
            } else {
                taskWantEl.textContent = 'Ôºà„Å™„ÅóÔºâ';
                taskWantCommentEl.textContent = '';
            }
        }
        
        // ================================
        // AI Backend Integration
        // ================================
        
        const BACKEND_URL = 'https://lifelog-backend.vercel.app';
        
        // „Éê„ÉÉ„ÇØ„Ç®„É≥„ÉâAPIÊé•Á∂ö„ÉÜ„Çπ„Éà
        async function testBackendAPI() {
            try {
                const response = await fetch(`${BACKEND_URL}/api/test`);
                const data = await response.json();
                console.log('‚úÖ Backend API connection successful:', data);
                return data.success;
            } catch (error) {
                console.error('‚ùå Backend API connection failed:', error);
                return false;
            }
        }
        
        // AIÂàÜÊûêÊ©üËÉΩ
        async function analyzeWithAI(text, category, type = 'journal') {
            try {
                const response = await fetch(`${BACKEND_URL}/api/analyze`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        text: text,
                        category: category,
                        type: type
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('‚úÖ AI Analysis result:', data);
                return data;
            } catch (error) {
                console.error('‚ùå AI Analysis failed:', error);
                return null;
            }
        }
        
        // AIÂàÜÊûê‰ªò„Åç„Ç∏„É£„Éº„Éä„É´‰øùÂ≠ò
        async function saveJournalWithAI() {
            const text = document.getElementById('journalInput').value.trim();
            const category = window.selectedJournalCategory || 'Êó•Ë®ò';
            
            if (!text) {
                alert('ÂÜÖÂÆπ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
            
            // „Éú„Çø„É≥„ÇíAIÂàÜÊûê‰∏≠„Å´Â§âÊõ¥
            const saveBtn = document.querySelector('.add-button[onclick="saveJournalWithAI()"]');
            const originalText = saveBtn.textContent;
            saveBtn.textContent = 'ü§ñ AIÂàÜÊûê‰∏≠...';
            saveBtn.disabled = true;
            
            try {
                // AIÂàÜÊûê„ÇíÂÆüË°å
                const aiResult = await analyzeWithAI(text, category, 'journal');
                
                // „Ç∏„É£„Éº„Éä„É´„Éá„Éº„Çø„Çí‰ΩúÊàê
                const journal = {
                    id: Date.now(),
                    timestamp: new Date().toISOString(),
                    category: category,
                    text: text,
                    aiAnalysis: aiResult ? aiResult.analysis : null
                };
                
                // LocalStorage„Å´‰øùÂ≠ò
                const journals = JSON.parse(localStorage.getItem('journals') || '[]');
                journals.push(journal);
                localStorage.setItem('journals', JSON.stringify(journals));
                
                // ÂÖ•ÂäõÊ¨Ñ„Çí„ÇØ„É™„Ç¢
                document.getElementById('journalInput').value = '';
                window.selectedJournalCategory = 'Êó•Ë®ò';
                
                // „Ç´„ÉÜ„Ç¥„É™„Éú„Çø„É≥„ÅÆÈÅ∏Êäû„ÇíËß£Èô§
                document.querySelectorAll('.journal-category-btn').forEach(btn => {
                    btn.classList.remove('selected');
                });
                
                // „Ç∏„É£„Éº„Éä„É´„É≠„Ç∞„ÇíÂÜç„É¨„É≥„ÉÄ„É™„É≥„Ç∞
                renderJournalLogs();
                
                // AIÂàÜÊûêÁµêÊûú„ÇíË°®Á§∫
                if (aiResult && aiResult.analysis) {
                    showAIAnalysisResult(aiResult.analysis);
                } else {
                    alert('‚úÖ „Ç∏„É£„Éº„Éä„É´„Çí‰øùÂ≠ò„Åó„Åæ„Åó„ÅüÔºÅ');
                }
                
            } catch (error) {
                console.error('‚ùå Error saving journal:', error);
                alert('‚ùå „Ç∏„É£„Éº„Éä„É´„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            } finally {
                // „Éú„Çø„É≥„ÇíÂÖÉ„Å´Êàª„Åô
                saveBtn.textContent = originalText;
                saveBtn.disabled = false;
            }
        }
        
        // AIÂàÜÊûêÁµêÊûúË°®Á§∫„É¢„Éº„ÉÄ„É´
        function showAIAnalysisResult(analysis) {
            const sentiment = analysis.sentiment || '‰∏çÊòé';
            const summary = analysis.summary || '„Çµ„Éû„É™„Éº„Å™„Åó';
            const keywords = analysis.keywords || [];
            const suggestions = analysis.suggestions || [];
            
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'flex';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 600px;">
                    <h3>ü§ñ AIÂàÜÊûêÁµêÊûú</h3>
                    
                    <div style="margin-bottom: 15px;">
                        <strong>üòä ÊÑüÊÉÖ:</strong> ${sentiment}
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <strong>üìù Ë¶ÅÁ¥Ñ:</strong><br>
                        ${summary}
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <strong>üîë „Ç≠„Éº„ÉØ„Éº„Éâ:</strong><br>
                        ${keywords.map(k => `<span style="display: inline-block; background: #e3f2fd; padding: 5px 10px; border-radius: 15px; margin: 3px;">${k}</span>`).join('')}
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <strong>üí° ÊèêÊ°à:</strong><br>
                        ${suggestions.map(s => `<div style="padding: 5px 0;">„Éª${s}</div>`).join('')}
                    </div>
                    
                    <div class="modal-actions">
                        <button type="button" onclick="this.closest('.modal').remove()" class="primary">Èñâ„Åò„Çã</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // „É¢„Éº„ÉÄ„É´Â§ñ„ÇØ„É™„ÉÉ„ÇØ„ÅßÈñâ„Åò„Çã
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }
        
        // „Éö„Éº„Ç∏„É≠„Éº„ÉâÊôÇ„Å´„Éê„ÉÉ„ÇØ„Ç®„É≥„ÉâÊé•Á∂ö„ÉÜ„Çπ„Éà
        testBackendAPI();
        
        // ÂàùÊúüÂåñ
        loadMoneyCategories();
        renderActivityQuickButtons();
        renderActivityLogs();
        renderTodayTasks();
        updateGoalsMonthDisplay();
        renderGoals();
        updateReportMonthDisplay('activity');
        updateReportMonthDisplay('money');
        renderActivityReport();
        renderMoneyReport();
        initializeReportMonths();
        renderMoneyLogs();
        renderWeightLogs();
        renderJournalLogs();
        renderCalendar();
        
        // „Éá„Éï„Ç©„É´„Éà„ÅÆÊ∞óÂàÜ„ÇíÈÅ∏ÊäûÁä∂ÊÖã„Å´
        selectMood('normal');
        
        setupVoiceRecognition('activityVoiceButton', 'activityInput', false, true);
        setupVoiceRecognition('moneyVoiceButton', 'moneyInput');
        setupVoiceRecognition('weightVoiceButton', 'weightInput');
        setupManualCategoryVoiceRecognition('journalVoiceButton', 'journalInput');
        setupJournalInputListener();
    </script>
    <!-- Ë°åÂãïÁ∑®ÈõÜ„É¢„Éº„ÉÄ„É´ -->
    <div id="editActivityModal" class="modal">
        <div class="modal-content">
            <h3>‚úèÔ∏è Ë°åÂãï„ÇíÁ∑®ÈõÜ</h3>
            
            <label>ÂÜÖÂÆπ</label>
            <input type="text" id="editActivityText" placeholder="Ë°åÂãïÂÜÖÂÆπ">
            
            <label>„Ç´„ÉÜ„Ç¥„É™</label>
            <select id="editActivityCategory">
                <!-- „Ç´„ÉÜ„Ç¥„É™„ÅØÂãïÁöÑ„Å´ÁîüÊàê -->
            </select>
            
            <label>ÈñãÂßãÊôÇÂàª</label>
            <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                <input type="datetime-local" id="editActivityStartTime" style="flex: 1;">
                <button type="button" onclick="setCurrentTimeToStart()" class="quick-time-btn">ÁèæÂú®ÊôÇÂàª</button>
            </div>
            
            <label>ÁµÇ‰∫ÜÊôÇÂàª</label>
            <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                <input type="datetime-local" id="editActivityEndTime" style="flex: 1;">
                <button type="button" onclick="setCurrentTimeToEnd()" class="quick-time-btn">ÁèæÂú®ÊôÇÂàª</button>
            </div>
            
            <!-- „ÇØ„Ç§„ÉÉ„ÇØÊôÇÈñìË™øÊï¥ -->
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px;">„ÇØ„Ç§„ÉÉ„ÇØË™øÊï¥</label>
                <div style="display: flex; gap: 5px; flex-wrap: wrap;">
                    <button type="button" onclick="adjustEndTime(5)" class="quick-adjust-btn">+5ÂàÜ</button>
                    <button type="button" onclick="adjustEndTime(15)" class="quick-adjust-btn">+15ÂàÜ</button>
                    <button type="button" onclick="adjustEndTime(30)" class="quick-adjust-btn">+30ÂàÜ</button>
                    <button type="button" onclick="adjustEndTime(60)" class="quick-adjust-btn">+1ÊôÇÈñì</button>
                    <button type="button" onclick="adjustEndTime(-5)" class="quick-adjust-btn">-5ÂàÜ</button>
                    <button type="button" onclick="adjustEndTime(-15)" class="quick-adjust-btn">-15ÂàÜ</button>
                </div>
            </div>
            
            <!-- ÊâÄË¶ÅÊôÇÈñìË°®Á§∫ -->
            <div id="durationDisplay" style="padding: 10px; background: #f0f0f0; border-radius: 5px; margin-bottom: 15px; text-align: center; font-weight: bold;">
                ÊâÄË¶ÅÊôÇÈñì: <span id="calculatedDuration">--</span>
            </div>
            
            <div class="modal-actions">
                <button type="button" onclick="closeEditActivityModal()">„Ç≠„É£„É≥„Çª„É´</button>
                <button type="button" onclick="saveEditActivity()" class="primary">‰øùÂ≠ò</button>
            </div>
        </div>
    </div>
<!-- „ÅäÈáëÁ∑®ÈõÜ„É¢„Éº„ÉÄ„É´ -->
<div id="editMoneyModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>üí∞ „ÅäÈáë„ÅÆË®òÈå≤„ÇíÁ∑®ÈõÜ</h3>
            <button class="modal-close" onclick="closeEditMoneyModal()">√ó</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label>ÂÜÖÂÆπ</label>
                <input type="text" id="editMoneyText" class="input-field" />
            </div>
            
            <div class="form-group">
                <label>„Ç´„ÉÜ„Ç¥„É™</label>
                <select id="editMoneyCategory" class="input-field">
                    <!-- „Ç´„ÉÜ„Ç¥„É™„ÅåÂãïÁöÑ„Å´ËøΩÂä†„Åï„Çå„Çã -->
                </select>
            </div>
            
            <div class="form-group">
                <label>ÈáëÈ°ç</label>
                <input type="number" id="editMoneyAmount" class="input-field" placeholder="ÂèéÂÖ•„ÅØÊ≠£„ÅÆÊï∞„ÄÅÊîØÂá∫„ÅØË≤†„ÅÆÊï∞" />
            </div>
            
            <div class="form-group">
                <label>Ë®òÈå≤Êó•ÊôÇ</label>
                <input type="datetime-local" id="editMoneyTimestamp" class="input-field" />
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn-secondary" onclick="closeEditMoneyModal()">„Ç≠„É£„É≥„Çª„É´</button>
            <button class="btn-primary" onclick="saveMoneyEdit()">üíæ ‰øùÂ≠ò</button>
        </div>
    </div>
</div>

    <style>
        .quick-time-btn, .quick-adjust-btn {
            padding: 8px 12px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
        }

        .quick-time-btn:hover, .quick-adjust-btn:hover {
            background: #45a049;
        }

        .quick-adjust-btn {
            background: #2196F3;
        }

        .quick-adjust-btn:hover {
            background: #0b7dda;
        }
    </style>
<!-- „ÅäÈáë„Ç´„ÉÜ„Ç¥„É™Á∑®ÈõÜ„É¢„Éº„ÉÄ„É´ -->
<div id="moneyCategoryEditModal" class="modal">
    <div class="modal-content">
        <h3>üí∏ „Ç´„ÉÜ„Ç¥„É™Á∑®ÈõÜ</h3>
        
        <div class="category-edit-list" id="categoryEditList">
            <!-- „Ç´„ÉÜ„Ç¥„É™„É™„Çπ„Éà„ÅØJavaScript„ÅßÁîüÊàê -->
        </div>
        
        <div class="add-category-section">
            <h4>Êñ∞„Åó„ÅÑ„Ç´„ÉÜ„Ç¥„É™„ÇíËøΩÂä†</h4>
            <div class="form-row">
                <input type="text" id="newCategoryEmoji" class="input-field-small" placeholder="ÁµµÊñáÂ≠ó" maxlength="2">
                <input type="text" id="newCategoryName" class="input-field" placeholder="„Ç´„ÉÜ„Ç¥„É™Âêç">
                <button class="btn-primary-small" onclick="addMoneyCategory()">‚ûï ËøΩÂä†</button>
            </div>
        </div>
        
        <div class="modal-buttons">
            <button class="btn-secondary" onclick="closeMoneyCategoryEditModal()">Èñâ„Åò„Çã</button>
        </div>
    </div>
</div>

<script>
// „Éö„Éº„Ç∏Ë™≠„ÅøËæº„ÅøÊôÇ„ÅÆÂàùÊúüÂåñÂá¶ÁêÜ
window.addEventListener('DOMContentLoaded', function() {
    console.log('üì± „Ç¢„Éó„É™ÂàùÊúüÂåñÈñãÂßã');
    
    // „Ç∏„É£„Éº„Éä„É´Â±•Ê≠¥„ÇíË°®Á§∫
    renderJournalLogs();
    console.log('‚úÖ „Ç∏„É£„Éº„Éä„É´Â±•Ê≠¥„ÇíÂàùÊúüÂåñ„Åó„Åæ„Åó„Åü');
    
    // „ÅäÈáë„ÅÆÂ±•Ê≠¥„ÇíË°®Á§∫
    renderMoneyLogs();
    console.log('‚úÖ „ÅäÈáëÂ±•Ê≠¥„ÇíÂàùÊúüÂåñ„Åó„Åæ„Åó„Åü');
    
    // „Éá„Éï„Ç©„É´„Éà„Çø„Éñ„ÇíË®≠ÂÆö
    switchTab('activity');
    console.log('‚úÖ „Éá„Éï„Ç©„É´„Éà„Çø„Éñ„ÇíË®≠ÂÆö„Åó„Åæ„Åó„Åü');
    
    // „Éê„ÉÉ„ÇØ„Ç®„É≥„ÉâAPI„ÉÜ„Çπ„Éà
    testBackendAPI();
});
</script>

<script>
// Ë°åÂãï„Ç´„ÉÜ„Ç¥„É™ÈÅ∏Êäû
window.selectedActivityCategoryName = '';

function selectActivityCategory(category) {
    console.log('Ë°åÂãï„Ç´„ÉÜ„Ç¥„É™ÈÅ∏Êäû:', category);
    window.selectedActivityCategoryName = category;
    
    // Ââç„ÅÆÈÅ∏Êäû„ÇíËß£Èô§
    document.querySelectorAll('.category-selection-section .category-btn').forEach(btn => {
        btn.style.background = 'white';
        btn.style.borderColor = '#ddd';
        btn.style.fontWeight = 'normal';
    });
    
    // Êñ∞„Åó„ÅÑÈÅ∏Êäû„ÇíÂº∑Ë™ø
    const btn = document.querySelector(`.category-selection-section .category-btn[data-category="${category}"]`);
    if (btn) {
        btn.style.background = '#e3f2fd';
        btn.style.borderColor = '#2196f3';
        btn.style.fontWeight = 'bold';
    }
    
    // ÈÅ∏ÊäûË°®Á§∫„ÇíÊõ¥Êñ∞
    const display = document.getElementById('selectedActivityCategory');
    if (display) {
        display.textContent = `ÈÅ∏Êäû‰∏≠: ${category}`;
        display.style.color = '#2196f3';
        display.style.fontWeight = 'bold';
    }
}
window.selectActivityCategory = selectActivityCategory;


</script>
</body>
</html>
                                                                                                                                                                                                                                                                                                                                                                                                                                       